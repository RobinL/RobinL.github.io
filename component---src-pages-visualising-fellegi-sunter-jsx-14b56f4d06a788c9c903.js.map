{"version":3,"sources":["webpack://gatsby-starter-hello-world/./node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js","webpack://gatsby-starter-hello-world/./src/components/linkage_footer.jsx","webpack://gatsby-starter-hello-world/./src/components/prob_linkage_page.jsx","webpack://gatsby-starter-hello-world/./node_modules/@robinl/visualising-fellegi-sunter/379dba93f4bb9357@1122.js","webpack://gatsby-starter-hello-world/./node_modules/@robinl/visualising-fellegi-sunter/79750b3b8e929d9d@209.js","webpack://gatsby-starter-hello-world/./node_modules/@robinl/visualising-fellegi-sunter/d25176b0fe784ad0@488.js","webpack://gatsby-starter-hello-world/./node_modules/@robinl/visualising-fellegi-sunter/ecf81050a24329e5@163.js","webpack://gatsby-starter-hello-world/./node_modules/@robinl/visualising-fellegi-sunter/060a32b021a09f92@1011.js","webpack://gatsby-starter-hello-world/./src/pages/visualising_fellegi_sunter.jsx"],"names":["_taggedTemplateLiteral","strings","raw","slice","Object","freeze","defineProperties","value","mar","flex","order_of_articles","props","path","current_path","this_index","indexOf","previous_article","next_article","undefined","to","css","post","define","output_order","className","title","post_frontmatter","description","_templateObject","_templateObject2","_templateObject3","_templateObject4","_templateObject5","runtime","observer","main","module","variable","md","inputs","default_settings","textarea","rows","G","_","input","settings","num_levels","length","range","step","label","plot_treemap","max_depth_1","generate_treemap_data","treemap","html","d3","width","DOM","box_html","max_depth","height","data_generated","root","container","tooltip","select","append","attr","style","svg","grouped_data","filter","d","depth","group","node","selectAll","data","join","concat","x0","y0","nodeUid","uid","id","x1","y1","rgb","colour","col","hex","opacity","children","i","nodes","on","event","top","left","this_data","this","datum","b_html","getBoundingClientRect","tt_width","offsetY","layerX","offsetX","visible","console","log","layerY","children_to_add","add_children_from_column","subtree","column","match","forEach","c","items_to_add","color_match","color_non_match","parent","probabilities","this_colour","prob","name","child","name_list","prob_list","push","lam","start_template","matches","non_matches","format_perc","text","map","k","final_prob","reduce","a","b","contents","innerHTML","settings_raw","JSON","parse","tile","treemapSquarify","size","paddingOuter","paddingTop","paddingInner","round","hierarchy","sum","sort","format","scaleOrdinal","schemeCategory10","colours","brighter","require","_templateObject6","_templateObject7","_templateObject8","_templateObject9","_templateObject10","_templateObject11","_templateObject12","_templateObject13","_templateObject14","_templateObject15","_templateObject16","_templateObject17","_templateObject18","_templateObject19","_templateObject20","_templateObject21","_templateObject22","_templateObject23","_templateObject24","_templateObject25","_templateObject26","_templateObject27","_templateObject28","_templateObject29","_templateObject30","_templateObject31","_templateObject32","_templateObject33","_templateObject34","_templateObject35","_templateObject36","_templateObject37","_templateObject38","_templateObject39","_templateObject40","_templateObject41","_templateObject42","_templateObject43","_templateObject44","_templateObject45","_templateObject46","_templateObject47","_templateObject48","_templateObject49","_templateObject50","_templateObject51","_templateObject52","_templateObject53","_templateObject54","_templateObject55","_templateObject56","_templateObject57","_templateObject58","_templateObject59","_templateObject60","_templateObject61","_templateObject62","_templateObject63","_templateObject64","_templateObject65","_templateObject66","_templateObject67","_templateObject68","_templateObject69","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","sym","getOwnPropertyDescriptor","enumerable","apply","_objectSpread","target","arguments","source","key","getOwnPropertyDescriptors","defineProperty","_ref","_callee","aq_version","aq_packages","toView","aq","_context","prev","next","sent","Promise","all","pkg","addPackage","addTableMethod","override","abrupt","stop","_x","_x2","_x3","_x4","op","table","dt","derive","month","row_number","diff","Seattle","Chicago","orderby","view","rollup","corr_sf","corr","corr_chi","fold","as","groupby","min","sun","max","avg","average","med","median","skew","_ref2","s","mean","stdev","objects","DEFAULT_NULL","tableStyle","cellStyle","opt","limit","color","columnNames","_loop","td","index","row","maxCellWidth","null","th","toHTML","fname","sname","dob","town","records_r","from","proportion_of_matches","comparison_columns","col_name","u_probabilities","m_probabilities","case_expression","fname_l","fname_r","sname_l","sname_r","dob_l","dob_r","town_l","town_r","get_df_comparison","records_l","df_comparison","get_df_gammas","splink_settings","df_gammas","get_df_e","term_freqs","get_match_probability","df_e","df","relocate","after","prob_to_log2_bf","log2_bf_to_prob","prior_log2_bg","log2_bayes","cc","gamma_col_name","gamma","m","u","l_val","toLowerCase","r_val","tfs","u_l","u_r","u_new","Math","log2","num_columns","comparison_vector","gamma_symbols","m_values","u_values","m_symbols","u_symbols","bayes_factors","log2_bayes_factors","col_names","match_probability","col_name_escaped","replace","bf","get_match_probability_components","toPrecision","lam_m","lam_u","m_tex","u_tex","p","m_part","u_part","tex","get_m_u_formula_symbols","joined","joined2","get_comparison_vector_symbols_and_numbers","get_m_u_formula_numbers","records_as_dict_l","records_as_dict_r","df_l","df_r","suffix","colname_no_suffix","cols_ordered","col_order","bayes_factor_to_prob","pow","prob_to_bayes_factor","child1","import","csv","autoType","then","csv_file","lookup","firstname","freq","surname","first_name_lookup","surname_lookup","rad_value","rad1","radio","u0","u1","m0","m1","form","get_value","gamma_value","querySelector","checked","onclick","oninput","my_interface","fname_val","sname_val","dob_val","town_val","texd","nm","$0","choice_text","dict_as_md_table_row","get_row_no_gammas","get_m_u_text","get_row","options","displayMode","fleqn","values","gamma_name","includes","new_object","child2","dict","row1","row2","row3","child3","styles","child4","form_styles","colname","m_or_u","matches_text","match_or_non_match","gamma_tex","percentage","parseFloat","toFixed","frontmatter","post_date","code_url","post_type","post_category","css_override"],"mappings":"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","file":"component---src-pages-visualising-fellegi-sunter-jsx-14b56f4d06a788c9c903.js","sourcesContent":["export default function _taggedTemplateLiteral(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  return Object.freeze(Object.defineProperties(strings, {\n    raw: {\n      value: Object.freeze(raw)\n    }\n  }));\n}","import React from 'react'\nimport { css } from \"@emotion/core\"\nimport { rhythm } from \"../utils/typography\"\nimport { Link } from \"gatsby\"\n\n\nconst foot = css`\nmargin-left: auto;\n  margin-right: auto;\n  width: 80%;\n  max-width: 640px;\n  `\n\nconst cen = css`\n  text-align: center;\n`\n\nconst mar = css`\n  margin-top: 1rem;\n  margin-bottom: 0.5rem;\n`\n\nconst flex = css`\n\n\n    display: flex;\n    justify-content: space-between;\n\n`\n\nconst order_of_articles = [\n  \"/intro_to_probabilistic_linkage/\",\n  \"/maths_of_fellegi_sunter/\",\n  \"/visualising_fellegi_sunter/\",\n  \"/understanding_match_weights/\",\n  \"/match_weight_dependencies/\",\n  \"/m_u_generator/\",\n]\n\nconst LinkageFooter = (props) => {\n\n  let path = props.current_path\n\n  let this_index = order_of_articles.indexOf(path)\n\n  let previous_article = order_of_articles[this_index - 1]\n  let next_article = order_of_articles[this_index + 1]\n\n  if (previous_article === undefined) {\n    previous_article = <div></div>\n  } else {\n    previous_article = <div><Link to={previous_article}> &lt; Previous article</Link></div>\n  }\n\n  if (next_article === undefined) {\n    next_article = <div></div>\n  } else {\n    next_article = <div><Link to={next_article}> Next article &gt;</Link></div>\n  }\n\n  return (\n    <div>\n      <hr css={mar} />\n      <div css={flex}>\n        {previous_article}\n        <div><Link to=\"/probabilistic_linkage\">Probabilistic linkage home</Link></div>\n        {next_article}\n      </div>\n\n    </div >)\n}\n\nexport default LinkageFooter","import React from 'react'\nimport Layout from \"../layouts/layout\"\nimport LinkageFooter from './linkage_footer'\nimport ObeservableNotebookDiv from \"./observable_div\"\nimport PostFrontMatter from \"./post_frontmatter\"\nimport SEO from \"./seo\"\n\n\nfunction ProbLinkagePage(props) {\n\n\n  // let post\n\n\n  let post = <ObeservableNotebookDiv define={props.define} output_order={props.output_order} />\n\n\n  return (\n    <Layout css={props.className}>\n      <SEO title={props.post_frontmatter.title} description={props.post_frontmatter.description} />\n      <PostFrontMatter post_frontmatter={props.post_frontmatter} />\n      {post}\n      <LinkageFooter current_path={props.current_path}\n      />\n    </Layout>\n  )\n\n}\n\nexport default ProbLinkagePage","import _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5;\n\n// https://observablehq.com/@robinl/treemap-for-bayes-intuition@1122\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Treemap for Bayes Intuition\"])));\n  });\n  main.variable(observer(\"viewof settings_raw\")).define(\"viewof settings_raw\", [\"inputs\", \"default_settings\"], function (inputs, default_settings) {\n    return inputs.textarea({\n      value: default_settings,\n      rows: 29\n    });\n  });\n  main.variable(observer(\"settings_raw\")).define(\"settings_raw\", [\"Generators\", \"viewof settings_raw\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"viewof max_depth_1\")).define(\"viewof max_depth_1\", [\"settings\", \"inputs\"], function (settings, inputs) {\n    var num_levels = settings[\"comparison_columns\"].length;\n    return inputs.range([0, num_levels], {\n      step: 1,\n      label: \"How many columns to take account of?\"\n    });\n  });\n  main.variable(observer(\"max_depth_1\")).define(\"max_depth_1\", [\"Generators\", \"viewof max_depth_1\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"In the following diagram, the outermost rectangle represents the space all pairwise record comparisons.  \\n\\nThis can then be recursively split into subsets, beginning with spliting between record pairs that match and those that do not match, then further splitting these rectangles based on comparisons of the values in columns.\\n\"])));\n  });\n  main.variable(observer()).define([\"plot_treemap\", \"settings\", \"max_depth_1\"], function (plot_treemap, settings, max_depth_1) {\n    return plot_treemap(settings, max_depth_1, 600);\n  });\n  main.variable(observer(\"plot_treemap\")).define(\"plot_treemap\", [\"generate_treemap_data\", \"treemap\", \"html\", \"d3\", \"width\", \"DOM\", \"box_html\"], function (generate_treemap_data, treemap, html, d3, width, DOM, box_html) {\n    return function (settings, max_depth, height) {\n      var data_generated = generate_treemap_data(settings);\n      var root = treemap(data_generated, height);\n      var container = html(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"<div class=\\\"treemap_container\\\">\"])));\n      var tooltip = d3.select(container).append(\"div\").attr(\"class\", \"svg-tooltip\").style(\"position\", \"absolute\").style(\"display\", \"inline-block\").style(\"visibility\", \"hidden\").attr(\"pointer-events\", \"none\");\n      var svg = d3.select(container).append(\"svg\").attr(\"height\", height).attr(\"width\", width);\n      var grouped_data = d3.filter(root, function (d) {\n        return d.depth <= max_depth + 1;\n      });\n      grouped_data = d3.group(grouped_data, function (d) {\n        return d.height;\n      });\n      var node = svg.selectAll(\"g\").data(grouped_data).join(\"g\").selectAll(\"g\").data(function (d) {\n        return d[1];\n      }).join(\"g\").attr(\"transform\", function (d) {\n        return \"translate(\".concat(d.x0, \",\").concat(d.y0, \")\");\n      });\n      node.append(\"rect\").attr(\"id\", function (d) {\n        return (d.nodeUid = DOM.uid(\"node\")).id;\n      }).attr(\"width\", function (d) {\n        return d.x1 - d.x0;\n      }).attr(\"height\", function (d) {\n        return d.y1 - d.y0;\n      }).attr(\"stroke-width\", \"1px\").attr(\"stroke\", \"black\").attr(\"fill\", function (d) {\n        if (d.depth == max_depth + 1) {\n          return d3.rgb(d.data.colour);\n        } else {\n          var col = d3.rgb(d.data.colour);\n\n          if (col.hex() != \"#ffffff\") {\n            if (d.depth == 1) {\n              col.opacity = 0.3;\n            } else {\n              col.opacity = 0.0;\n            }\n          }\n\n          return col;\n        }\n      });\n      node.append(\"foreignObject\").attr(\"pointer-events\", \"none\").attr(\"width\", function (d) {\n        return d.x1 - d.x0;\n      }).attr(\"height\", function (d) {\n        return d.y1 - d.y0;\n      }).attr(\"xmlns\", \"http://www.w3.org/1999/xhtml\").append(\"xhtml:div\").attr(\"class\", \"wrap-info\").append(\"div\").html(function (d) {\n        return box_html(d, max_depth);\n      });\n      node.filter(function (d) {\n        return d.children;\n      }).selectAll(\"tspan\").attr(\"dx\", 3).attr(\"y\", 13);\n      node.filter(function (d) {\n        return !d.children;\n      }).selectAll(\"tspan\").attr(\"x\", 3).attr(\"y\", function (d, i, nodes) {\n        return \"\".concat((i === nodes.length - 1) * 0.3 + 1.1 + i * 0.9, \"em\");\n      });\n      svg.selectAll(\"rect\").on(\"mouseover\", function (event) {\n        return tooltip.style(\"visibility\", \"visible\");\n      }).on(\"mousemove\", function (event) {\n        var this_data = d3.select(this).datum();\n        var b_html = box_html(this_data, max_depth);\n        tooltip.html(b_html);\n        var top;\n        var left;\n        var tt_height = tooltip.node().getBoundingClientRect().height;\n        var tt_width = tooltip.node().getBoundingClientRect().width;\n        top = event.offsetY + 10 + \"px\";\n\n        if (width - event.layerX > tt_width) {\n          left = event.offsetX + 10 + \"px\";\n        } else {\n          left = event.offsetX - tt_width - 10 + \"px\";\n        }\n\n        var visible = \"visible\";\n\n        if (b_html == \"\") {\n          visible = \"hidden\";\n        }\n\n        return tooltip.style(\"top\", top).style(\"left\", left).style(\"visibility\", visible);\n      }).on(\"click\", function (event) {\n        console.log(\"height: \".concat(height));\n        console.log(\"event.layerY: \".concat(event.layerY));\n      }).on(\"mouseout\", function () {\n        return tooltip.style(\"visibility\", \"hidden\");\n      });\n      return container;\n    };\n  });\n  main.variable(observer(\"add_children_from_column\")).define(\"add_children_from_column\", [\"children_to_add\"], function (children_to_add) {\n    return function add_children_from_column(subtree, column, match) {\n      // We want to find all current leaves.\n      if (\"children\" in subtree) {\n        subtree[\"children\"].forEach(function (c) {\n          add_children_from_column(c, column, match);\n        });\n      } // When a leaf is found, add children\n      else {\n          var items_to_add = children_to_add(column, subtree, match);\n          subtree[\"children\"] = items_to_add;\n        }\n\n      delete subtree[\"value\"];\n    };\n  });\n  main.variable(observer(\"children_to_add\")).define(\"children_to_add\", [\"color_match\", \"color_non_match\", \"d3\"], function (color_match, color_non_match, d3) {\n    return function children_to_add(col, parent, match) {\n      var children = [];\n      var probabilities;\n      var this_colour;\n\n      if (match) {\n        probabilities = col[\"m_probabilities\"];\n        this_colour = color_match;\n      } else {\n        probabilities = col[\"u_probabilities\"];\n        this_colour = color_non_match;\n      }\n\n      probabilities.forEach(function (prob, i) {\n        var name = \"gamma_\" + col[\"col_name\"] + \" = \" + i;\n        var child = {\n          name: name,\n          name_list: parent[\"name_list\"].concat(name),\n          value: parent[\"value\"] * prob,\n          prob: prob,\n          prob_list: parent[\"prob_list\"].concat(prob)\n        };\n\n        if (col[\"gamma_value\"] == i && parent[\"colour\"] == this_colour) {\n          child[\"colour\"] = this_colour;\n        } else {\n          child[\"colour\"] = d3.rgb(255, 255, 255);\n        }\n\n        children.push(child);\n      });\n      return children;\n    };\n  });\n  main.variable(observer(\"generate_treemap_data\")).define(\"generate_treemap_data\", [\"d3\", \"color_match\", \"color_non_match\", \"add_children_from_column\"], function (d3, color_match, color_non_match, add_children_from_column) {\n    return function (settings) {\n      var lam = settings[\"proportion_of_matches\"];\n      var start_template = {\n        name: \"All comparisons\",\n        name_list: [],\n        prob_list: [],\n        prob: 1.0,\n        colour: d3.rgb(255, 255, 255),\n        children: [{\n          name: \"matches\",\n          name_list: [\"match\"],\n          prob_list: [lam],\n          prob: lam,\n          value: lam,\n          colour: color_match\n        }, {\n          name: \"non-match\",\n          name_list: [\"non-match\"],\n          prob_list: [1 - lam],\n          prob: 1 - lam,\n          value: 1 - lam,\n          colour: color_non_match\n        }]\n      };\n      var matches = start_template[\"children\"][0];\n      var non_matches = start_template[\"children\"][1];\n      settings[\"comparison_columns\"].forEach(function (c, i) {\n        add_children_from_column(matches, c, true);\n        add_children_from_column(non_matches, c, false);\n      });\n      return start_template;\n    };\n  });\n  main.variable(observer(\"box_html\")).define(\"box_html\", [\"format_perc\", \"html\"], function (format_perc, html) {\n    return function box_html(d, max_depth) {\n      var name_list = d.data.name_list;\n      var prob_list = d.data.prob_list;\n      var zipped = name_list.map(function (k, i) {\n        return [k, prob_list[i]];\n      });\n      var elems = zipped.map(function (d) {\n        return \"<p>\".concat(d[0], \" (\").concat(format_perc(d[1]), \")\");\n      });\n      var text = elems.join(\" and \");\n      var final_prob = prob_list.reduce(function (a, b) {\n        return a * b;\n      }, 1);\n      text = text + \"<p>Proportion of all comparisons: \".concat(format_perc(final_prob));\n      var contents = html(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\", \"\"])), text);\n\n      if (d.depth == max_depth + 1) {\n        return contents.innerHTML;\n      } else {\n        return \"\";\n      }\n    };\n  });\n  main.variable(observer(\"settings\")).define(\"settings\", [\"settings_raw\"], function (settings_raw) {\n    return JSON.parse(settings_raw);\n  });\n  main.variable(observer(\"styles\")).define(\"styles\", [\"html\"], function (html) {\n    return html(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"\\n<style>\\n.wrap-info {\\n  padding: 5px;\\n  font-family: monospace;\\n  font-size: 0.6em;\\n  line-height: 1.3em;\\n}\\n.wrap-info p {\\n  margin-top: 0px;\\n  margin-bottom: 0.1rem;\\n  \\n}\\ntextarea {\\n    max-height: 1000em !important\\n}\\n\\n.svg-tooltip {\\n\\n    background: rgba(69,77,93,.9);\\n    border-radius: .1rem;\\n    color: #fff;\\n    display: inline-block;\\n    max-width: 500px;\\n    padding: .2rem .4rem;\\n    position: absolute;\\n    text-overflow: ellipsis;\\n    white-space: pre;\\n    z-index: 300;\\n    visibility: hidden;\\n  }\\n\\n.svg-tooltip p {\\nfont-family: sans-serif;\\n    padding: 0;\\n    margin: 0.2rem;\\n      font-size: 0.8em;\\n    line-height: 1.0em;\\n  }\\n</style>\"])));\n  });\n  main.variable(observer(\"treemap\")).define(\"treemap\", [\"d3\", \"width\"], function (d3, width) {\n    return function (data, height) {\n      return d3.treemap().tile(d3.treemapSquarify).size([width, height]).paddingOuter(5).paddingTop(5).paddingInner(5).round(true)(d3.hierarchy(data).sum(function (d) {\n        return d.value;\n      }).sort(function (a, b) {\n        return b.value - a.value;\n      }));\n    };\n  });\n  main.variable(observer(\"default_settings\")).define(\"default_settings\", function () {\n    return \"{\\n    \\\"proportion_of_matches\\\": 0.4,\\n    \\\"comparison_columns\\\": [\\n        {\\n            \\\"col_name\\\": \\\"fname\\\",\\n            \\\"m_probabilities\\\": [0.25, 0.75],\\n            \\\"u_probabilities\\\": [0.7,  0.3],\\n            \\\"gamma_value\\\": 1\\n        },\\n        {\\n            \\\"col_name\\\": \\\"sname\\\",\\n            \\\"m_probabilities\\\": [0.2, 0.8],\\n            \\\"u_probabilities\\\": [0.8,  0.2],\\n            \\\"gamma_value\\\": 0\\n        },\\n        {\\n            \\\"col_name\\\": \\\"dob\\\",\\n            \\\"m_probabilities\\\": [0.2, 0.8],\\n            \\\"u_probabilities\\\": [0.8,  0.2],\\n            \\\"gamma_value\\\": 1\\n        },\\n        {\\n            \\\"col_name\\\": \\\"town\\\",\\n            \\\"m_probabilities\\\": [0.2, 0.8],\\n            \\\"u_probabilities\\\": [0.8,  0.2],\\n            \\\"gamma_value\\\": 1\\n        }\\n    ]\\n}\";\n  });\n  main.variable(observer(\"format_perc\")).define(\"format_perc\", [\"d3\"], function (d3) {\n    return d3.format(\".1%\");\n  });\n  main.variable(observer(\"colours\")).define(\"colours\", [\"d3\"], function (d3) {\n    return d3.scaleOrdinal(d3.schemeCategory10);\n  });\n  main.variable(observer(\"color_match\")).define(\"color_match\", [\"d3\", \"colours\"], function (d3, colours) {\n    return d3.rgb(colours(2)).brighter(2.5);\n  });\n  main.variable(observer(\"color_non_match\")).define(\"color_non_match\", [\"d3\", \"colours\"], function (d3, colours) {\n    return d3.rgb(colours(1)).brighter(1.5);\n  });\n  main.variable(observer(\"d3\")).define(\"d3\", [\"require\"], function (require) {\n    return require(\"d3@6\");\n  });\n  main.variable(observer(\"inputs\")).define(\"inputs\", [\"require\"], function (require) {\n    return require(\"@observablehq/inputs\");\n  });\n  main.variable(observer()).define(function () {\n    return \"Links:\\n\\nx times more likely: \\nhttps://betterexplained.com/articles/understanding-bayes-theorem-with-ratios/\\nhttps://rss.onlinelibrary.wiley.com/doi/pdf/10.1111/j.1740-9713.2006.00204.x\\n\\nOdds are not quite the same as bayes factors:  https://ocw.mit.edu/courses/mathematics/18-05-introduction-to-probability-and-statistics-spring-2014/readings/MIT18_05S14_Reading12b.pdf\\n\\nhttps://cran.r-project.org/web/packages/BayesFactor/vignettes/odds_probs.html#:~:text=The%20Bayes%20factor%20represents%20the,are%20what%20are%20being%20changed.&text=Further%2C%20these%20odds%20can%20be,models%20sum%20to%20known%20probability.\\nThe Bayes factor represents the relative evidence between two models \\u2013 that is, the change in the model odds due to the data \\u2013 but the odds are what are being changed. \\n\\n\\nhttps://bookdown.org/kevin_davisross/bayesian-reasoning-and-methods/bayes-factor.html\\nRepresenting bayes theorem using bf\\n\\n\";\n  });\n  return main;\n}","import _defineProperty from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6, _templateObject7, _templateObject8, _templateObject9, _templateObject10, _templateObject11, _templateObject12, _templateObject13;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport _regeneratorRuntime from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/regenerator\";\n// https://observablehq.com/@uwdata/arquero@209\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Arquero\\n\\nArquero is a library for query processing and transformation of array-backed data tables. Following the [relational algebra](https://en.wikipedia.org/wiki/Relational_algebra) and inspired by the design of [dplyr](https://dplyr.tidyverse.org/), Arquero provides a fluent API for manipulating column-oriented data frames. Arquero supports a range of data transformation tasks, including filter, sample, aggregation, window, join, and reshaping operations. Arquero is Spanish for \\\"archer\\\": if datasets are [arrows](https://observablehq.com/@theneuralbit/introduction-to-apache-arrow), Arquero helps their aim stay true.\"])));\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"Import Arquero and extend it to print HTML tables in Observable:\"])));\n  });\n  main.variable(observer(\"aq\")).define(\"aq\", [\"require\", \"aq_version\", \"aq_packages\", \"toView\"], /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(require, aq_version, aq_packages, toView) {\n      var aq;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return require(\"arquero@\".concat(aq_version));\n\n            case 2:\n              aq = _context.sent;\n              _context.next = 5;\n              return Promise.all(aq_packages.map(function (pkg) {\n                return require(pkg);\n              }));\n\n            case 5:\n              _context.sent.forEach(function (pkg) {\n                return aq.addPackage(pkg);\n              });\n\n              // Add HTML table view method to tables\n              aq.addTableMethod('view', toView, {\n                override: true\n              });\n              return _context.abrupt(\"return\", aq);\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x, _x2, _x3, _x4) {\n      return _ref.apply(this, arguments);\n    };\n  }());\n  main.variable(observer(\"aq_version\")).define(\"aq_version\", function () {\n    return '4.2.0';\n  });\n  main.variable(observer(\"aq_packages\")).define(\"aq_packages\", function () {\n    return [];\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"Export a global reference to Arquero operations:\"])));\n  });\n  main.variable(observer(\"op\")).define(\"op\", [\"aq\"], function (aq) {\n    return aq.op;\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"To use the same setup in your own notebooks, add a cell with the following code:\\n~~~ js\\nimport { aq, op } from '@uwdata/arquero'\\n~~~\\n\"])));\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"To get started, see the [Introducing Arquero](https://observablehq.com/@uwdata/introducing-arquero) and [Arquero Cookbook](https://observablehq.com/@uwdata/arquero-cookbook) notebooks.\"])));\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"To use Arquero outside of Observable, see [https://github.com/uwdata/arquero](https://github.com/uwdata/arquero).\"])));\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"<hr>\\n## Examples\\n\\nThe core abstractions in Arquero are *data tables*, which model each column as an array of values, and *verbs* that transform data and return new tables. Verbs are table methods, allowing method chaining for multi-step transformations. Though each table is unique, many verbs reuse the underlying columns to limit duplication.\\n\"])));\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject8 || (_templateObject8 = _taggedTemplateLiteral([\"Average hours of sunshine per month, from [https://usclimatedata.com/](https://usclimatedata.com/):\"])));\n  });\n  main.variable(observer(\"dt\")).define(\"dt\", [\"aq\"], function (aq) {\n    return aq.table({\n      'Seattle': [69, 108, 178, 207, 253, 268, 312, 281, 221, 142, 72, 52],\n      'Chicago': [135, 136, 187, 215, 281, 311, 318, 283, 226, 193, 113, 106],\n      'San Francisco': [165, 182, 251, 281, 314, 330, 300, 272, 267, 243, 189, 156]\n    });\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject9 || (_templateObject9 = _taggedTemplateLiteral([\"Sorted differences between Seattle and Chicago:\"])));\n  });\n  main.variable(observer()).define([\"dt\", \"op\"], function (dt, op) {\n    return dt.derive({\n      month: function month(d) {\n        return op.row_number();\n      },\n      diff: function diff(d) {\n        return d.Seattle - d.Chicago;\n      }\n    }).select('month', 'diff').orderby('month').view({\n      height: 400\n    });\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject10 || (_templateObject10 = _taggedTemplateLiteral([\"Is Seattle more correlated with San Francisco or Chicago?\"])));\n  });\n  main.variable(observer()).define([\"dt\", \"op\"], function (dt, op) {\n    return dt.rollup({\n      corr_sf: op.corr('Seattle', 'San Francisco'),\n      corr_chi: op.corr('Seattle', 'Chicago')\n    }).view();\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject11 || (_templateObject11 = _taggedTemplateLiteral([\"Summary statistics per city, as output objects:\"])));\n  });\n  main.variable(observer()).define([\"dt\", \"aq\", \"op\"], function (dt, aq, op) {\n    return dt.fold(aq.all(), {\n      as: ['city', 'sun']\n    }).groupby('city').rollup({\n      min: function min(d) {\n        return op.min(d.sun);\n      },\n      // functional form of op.min('sun')\n      max: function max(d) {\n        return op.max(d.sun);\n      },\n      avg: function avg(d) {\n        return op.average(d.sun);\n      },\n      med: function med(d) {\n        return op.median(d.sun);\n      },\n      // functional forms permit flexible table expressions\n      skew: function skew(_ref2) {\n        var s = _ref2.sun;\n        return (op.mean(s) - op.median(s)) / op.stdev(s) || 0;\n      }\n    }).objects();\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject12 || (_templateObject12 = _taggedTemplateLiteral([\"<hr>\\n## Utilities\\n\"])));\n  });\n  main.variable(observer(\"toView\")).define(\"toView\", [\"html\"], function (html) {\n    var DEFAULT_LIMIT = 100;\n\n    var DEFAULT_NULL = function DEFAULT_NULL(value) {\n      return \"<span style=\\\"color: #999;\\\">\".concat(value, \"</span>\");\n    };\n\n    var tableStyle = 'margin: 0; border-collapse: collapse; width: initial;';\n    var cellStyle = 'padding: 1px 5px; white-space: nowrap; overflow-x: hidden; text-overflow: ellipsis; font-variant-numeric: tabular-nums;'; // extend table prototype to provide an HTML table view\n\n    return function (dt) {\n      var opt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      // permit shorthand for limit\n      if (typeof opt === 'number') opt = {\n        limit: opt\n      }; // marshal cell color options\n\n      var color = _objectSpread({}, opt.color);\n\n      if (typeof opt.color === 'function') {\n        // if function, apply to all columns\n        dt.columnNames().forEach(function (name) {\n          return color[name] = opt.color;\n        });\n      } else {\n        var _loop = function _loop(key) {\n          var value = color[key];\n          color[key] = typeof value === 'function' ? value : function () {\n            return value;\n          };\n        };\n\n        // otherwise, gather per-column color options\n        for (var key in color) {\n          _loop(key);\n        }\n      } // marshal CSS styles as toHTML() options\n\n\n      var table = \"\".concat(tableStyle);\n\n      var td = function td(name, index, row) {\n        return \"\".concat(cellStyle, \" max-width: \").concat(+opt.maxCellWidth || 300, \"px;\") + (color[name] ? \" background-color: \".concat(color[name](index, row), \";\") : '');\n      };\n\n      opt = _objectSpread(_objectSpread({\n        limit: DEFAULT_LIMIT,\n        null: DEFAULT_NULL\n      }, opt), {}, {\n        style: {\n          table: table,\n          td: td,\n          th: td\n        }\n      }); // return container div, bind table value to support viewof operator\n\n      var size = \"max-height: \".concat(+opt.height || 270, \"px\");\n      var style = \"\".concat(size, \"; overflow-x: auto; overflow-y: auto;\");\n      var view = html(_templateObject13 || (_templateObject13 = _taggedTemplateLiteral([\"<div style=\\\"\", \"\\\">\", \"</div>\"])), style, dt.toHTML(opt));\n      view.value = dt;\n      return view;\n    };\n  });\n  return main;\n}","import _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5;\n\nimport define1 from \"./79750b3b8e929d9d@209.js\";\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Fellegi Sunter utils\"])));\n  });\n  main.variable(observer(\"records_l\")).define(\"records_l\", function () {\n    return [{\n      uid: \"1_l\",\n      fname: \"John\",\n      sname: \"Smith\",\n      dob: \"1989-03-02\",\n      town: \"Bristol\"\n    }, {\n      uid: \"2_l\",\n      fname: \"Tom\",\n      sname: \"Hanks\",\n      dob: \"1956-07-09\",\n      town: \"Concord\"\n    }, {\n      uid: \"3_l\",\n      fname: \"David\",\n      sname: \"Smith\",\n      dob: \"1981-08-21\",\n      town: \"London\"\n    }];\n  });\n  main.variable(observer(\"records_r\")).define(\"records_r\", function () {\n    return [{\n      uid: \"1_r\",\n      fname: \"Jonathan\",\n      sname: \"Smith\",\n      dob: \"1989-03-02\",\n      town: \"Bristol\"\n    }, {\n      uid: \"2_r\",\n      fname: \"David\",\n      sname: \"Smith\",\n      dob: \"1981-08-21\",\n      town: \"Peckham\"\n    }];\n  });\n  main.variable(observer(\"df_r\")).define(\"df_r\", [\"aq\", \"records_r\"], function (aq, records_r) {\n    return aq.from(records_r);\n  });\n  main.variable(observer(\"splink_settings\")).define(\"splink_settings\", function () {\n    return {\n      proportion_of_matches: 1 / 100,\n      comparison_columns: [{\n        num_levels: 3,\n        col_name: \"fname\",\n        u_probabilities: [0.8, 0.2],\n        m_probabilities: [0.2, 0.8],\n        case_expression: function case_expression(row) {\n          if (row.fname_l == row.fname_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      }, {\n        num_levels: 3,\n        col_name: \"sname\",\n        u_probabilities: [0.9, 0.1],\n        m_probabilities: [0.2, 0.8],\n        case_expression: function case_expression(row) {\n          if (row.sname_l == row.sname_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      }, {\n        col_name: \"dob\",\n        u_probabilities: [0.99, 0.01],\n        m_probabilities: [0.2, 0.8],\n        case_expression: function case_expression(row) {\n          if (row.dob_l == row.dob_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      }, {\n        col_name: \"town\",\n        u_probabilities: [0.7, 0.3],\n        m_probabilities: [0.3, 0.7],\n        case_expression: function case_expression(row) {\n          if (row.town_l == row.town_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      }]\n    };\n  });\n  main.variable(observer(\"df_comparison\")).define(\"df_comparison\", [\"get_df_comparison\", \"records_l\", \"records_r\"], function (get_df_comparison, records_l, records_r) {\n    return get_df_comparison(records_l, records_r);\n  });\n  main.variable(observer()).define([\"df_comparison\"], function (df_comparison) {\n    return df_comparison.view();\n  });\n  main.variable(observer(\"df_gammas\")).define(\"df_gammas\", [\"get_df_gammas\", \"df_comparison\", \"splink_settings\"], function (get_df_gammas, df_comparison, splink_settings) {\n    return get_df_gammas(df_comparison, splink_settings);\n  });\n  main.variable(observer()).define([\"df_gammas\"], function (df_gammas) {\n    return df_gammas.view();\n  });\n  main.variable(observer()).define([\"get_df_e\", \"df_gammas\", \"splink_settings\", \"term_freqs\"], function (get_df_e, df_gammas, splink_settings, term_freqs) {\n    return get_df_e(df_gammas, splink_settings, term_freqs).view();\n  });\n  main.variable(observer(\"get_df_e\")).define(\"get_df_e\", [\"get_match_probability\", \"aq\"], function (get_match_probability, aq) {\n    return function get_df_e(df_gammas, splink_settings) {\n      var term_freqs = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var df_e = df_gammas.objects().map(function (row) {\n        row[\"match_probability\"] = get_match_probability(row, splink_settings, term_freqs);\n        return row;\n      });\n      var df = aq.from(df_e);\n      df = df.relocate([\"match_probability\"], {\n        after: \"uid_r\"\n      });\n      return df;\n    };\n  });\n  main.variable(observer(\"get_match_probability\")).define(\"get_match_probability\", [\"prob_to_log2_bf\", \"log2_bf_to_prob\"], function (prob_to_log2_bf, log2_bf_to_prob) {\n    return function (row, settings) {\n      var term_freqs = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var comparison_columns = settings.comparison_columns;\n      var prior_log2_bg = prob_to_log2_bf(settings.proportion_of_matches);\n      var log2_bayes = comparison_columns.reduce(function (a, cc) {\n        var gamma_col_name = \"_\" + cc.col_name;\n        var gamma = row[gamma_col_name]; // gamma = -1 means one side of the comparison is null\n\n        if (gamma == -1) {\n          return a;\n        }\n\n        var m = cc[\"m_probabilities\"][gamma];\n        var u = cc[\"u_probabilities\"][gamma]; // If TF lookup provided, attempt to use to overwrite u\n\n        var l_val = row[cc.col_name + \"_l\"].toLowerCase();\n        var r_val = row[cc.col_name + \"_r\"].toLowerCase();\n\n        if (l_val == r_val) {\n          if (cc.col_name in term_freqs) {\n            var tfs = term_freqs[cc.col_name];\n            var u_l = tfs[l_val] || 0;\n            var u_r = tfs[r_val] || 0;\n            var u_new = Math.max(u_l, u_r);\n\n            if (u_new > 0) {\n              u = u_new;\n            }\n          }\n        }\n\n        return a + Math.log2(m / u);\n      }, prior_log2_bg);\n      return log2_bf_to_prob(log2_bayes);\n    };\n  });\n  main.variable(observer(\"get_match_probability_components\")).define(\"get_match_probability_components\", [\"prob_to_log2_bf\", \"log2_bf_to_prob\"], function (prob_to_log2_bf, log2_bf_to_prob) {\n    return function (row, settings, num_columns) {\n      if (num_columns == undefined) {\n        num_columns = settings.comparison_columns.length;\n      }\n\n      var comparison_columns = settings.comparison_columns.slice(0, num_columns);\n      var prior_log2_bg = prob_to_log2_bf(settings.proportion_of_matches);\n      var d = {\n        comparison_vector: [],\n        gamma_symbols: [],\n        m_values: [],\n        u_values: [],\n        m_symbols: [],\n        u_symbols: [],\n        bayes_factors: [],\n        log2_bayes_factors: [],\n        col_names: [],\n        match_probability: null,\n        lam: settings.proportion_of_matches\n      };\n      comparison_columns.forEach(function (cc) {\n        var col_name = \"_\" + cc.col_name;\n        var gamma = row[col_name];\n        var m = cc[\"m_probabilities\"][gamma];\n        var u = cc[\"u_probabilities\"][gamma];\n        var col_name_escaped = cc.col_name.replace(\"_\", \"\\\\_\");\n        d[\"comparison_vector\"].push(gamma);\n        d[\"gamma_symbols\"].push(\"\\\\gamma_\\\\text{\".concat(col_name_escaped, \"}\"));\n        d[\"col_names\"].push(col_name);\n        d[\"m_values\"].push(m);\n        d[\"m_symbols\"].push(\"m_{\\\\text{\".concat(col_name_escaped, \"},\").concat(gamma, \"}\"));\n        d[\"u_values\"].push(u);\n        d[\"u_symbols\"].push(\"u_{\\\\text{\".concat(col_name_escaped, \"},\").concat(gamma, \"}\"));\n        d[\"bayes_factors\"].push(m / u);\n        d[\"log2_bayes_factors\"].push(Math.log2(m / u));\n      });\n      var log2_bayes = d[\"log2_bayes_factors\"].reduce(function (a, bf) {\n        return a + bf;\n      }, prior_log2_bg);\n      d[\"match_probability\"] = log2_bf_to_prob(log2_bayes);\n      var lam = settings.proportion_of_matches;\n      d[\"size_of_match_portion\"] = lam * d[\"m_values\"].reduce(function (a, b) {\n        return a * b;\n      }, 1);\n      d[\"size_of_non_match_portion\"] = (1 - lam) * d[\"u_values\"].reduce(function (a, b) {\n        return a * b;\n      }, 1);\n      return d;\n    };\n  });\n  main.variable(observer(\"get_m_u_formula_numbers\")).define(\"get_m_u_formula_numbers\", [\"get_match_probability_components\"], function (get_match_probability_components) {\n    return function (row, settings, num_columns) {\n      var d = get_match_probability_components(row, settings, num_columns);\n      var m = d[\"m_values\"].map(function (d) {\n        return d.toPrecision(3);\n      });\n      var u = d[\"u_values\"].map(function (d) {\n        return d.toPrecision(3);\n      });\n      var lam = d[\"lam\"].toPrecision(3);\n      var lam_m = [lam].concat(m);\n      var lam_u = [\"(1 - \".concat(lam, \")\")].concat(u);\n      var m_tex = lam_m.join(\" \\\\times \");\n      var u_tex = lam_u.join(\" \\\\times \");\n      var p = d[\"match_probability\"].toPrecision(3);\n      var m_part = d[\"size_of_match_portion\"].toPrecision(3);\n      var u_part = d[\"size_of_non_match_portion\"].toPrecision(3);\n      return \"\\\\frac{\".concat(m_tex, \"}{(\").concat(m_tex, \") + (\").concat(u_tex, \")}  \\\\newline[10pt] = \\\\frac{\").concat(m_part, \"}{\").concat(m_part, \" + \").concat(u_part, \"}  \\\\newline[10pt] = \").concat(p);\n    };\n  });\n  main.variable(observer(\"get_m_u_formula_symbols\")).define(\"get_m_u_formula_symbols\", [\"get_match_probability_components\"], function (get_match_probability_components) {\n    return function (row, settings) {\n      var d = get_match_probability_components(row, settings);\n      var m = d[\"m_symbols\"];\n      var u = d[\"u_symbols\"];\n      var lam = d[\"lam\"];\n      var lam_m = [\"\\\\lambda\"].concat(m);\n      var lam_u = [\"(1 - \\\\lambda)\"].concat(u);\n      var m_tex = lam_m.join(\" \");\n      var u_tex = lam_u.join(\" \");\n      return \"\\\\frac{\".concat(m_tex, \"}{\").concat(m_tex, \") + \").concat(u_tex, \"}\");\n    };\n  });\n  main.variable(observer()).define([\"tex\", \"get_m_u_formula_symbols\", \"df_gammas\", \"splink_settings\"], function (tex, get_m_u_formula_symbols, df_gammas, splink_settings) {\n    return tex(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\", \"\\n\"])), get_m_u_formula_symbols(df_gammas.objects()[0], splink_settings));\n  });\n  main.variable(observer(\"get_comparison_vector_symbols_and_numbers\")).define(\"get_comparison_vector_symbols_and_numbers\", [\"get_match_probability_components\"], function (get_match_probability_components) {\n    return function (row, settings, num_columns) {\n      var d = get_match_probability_components(row, settings, num_columns);\n      var joined = d[\"gamma_symbols\"].join(\", \");\n      var joined2 = d[\"comparison_vector\"].join(\", \");\n      return \"\\\\bm{\\\\gamma} = [\".concat(joined, \"]= [\").concat(joined2, \"]\");\n    };\n  });\n  main.variable(observer()).define([\"tex\", \"get_comparison_vector_symbols_and_numbers\", \"df_gammas\", \"splink_settings\"], function (tex, get_comparison_vector_symbols_and_numbers, df_gammas, splink_settings) {\n    return tex(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\", \"\\n\"])), get_comparison_vector_symbols_and_numbers(df_gammas.objects()[0], splink_settings));\n  });\n  main.variable(observer()).define([\"tex\"], function (tex) {\n    return tex(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\\bm{gamma} = [gamma_\\text{fname}, gamma_\\text{sname}]\"], [\"\\\\bm{\\\\gamma} = [\\\\gamma_\\\\text{fname}, \\\\gamma_\\\\text{sname}]\"])));\n  });\n  main.variable(observer()).define([\"tex\", \"get_m_u_formula_numbers\", \"df_gammas\", \"splink_settings\"], function (tex, get_m_u_formula_numbers, df_gammas, splink_settings) {\n    return tex(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"\", \"\"])), get_m_u_formula_numbers(df_gammas.objects()[0], splink_settings));\n  });\n  main.variable(observer()).define([\"get_match_probability_components\", \"df_gammas\", \"splink_settings\"], function (get_match_probability_components, df_gammas, splink_settings) {\n    return get_match_probability_components(df_gammas.objects()[0], splink_settings);\n  });\n  main.variable(observer(\"get_df_comparison\")).define(\"get_df_comparison\", [\"aq\"], function (aq) {\n    return function (records_as_dict_l, records_as_dict_r) {\n      var df_l = aq.from(records_as_dict_l);\n      var df_r = aq.from(records_as_dict_r);\n      var df_comparison = df_l.join(df_r, function (a, b) {\n        return true;\n      }, null, {\n        suffix: [\"_l\", \"_r\"]\n      }); // Group columns\n\n      var colname_no_suffix = df_l.columnNames();\n      var cols_ordered = [];\n      colname_no_suffix.forEach(function (d) {\n        cols_ordered.push(d + \"_l\");\n        cols_ordered.push(d + \"_r\");\n      });\n      df_comparison = df_comparison.select(cols_ordered);\n      return df_comparison;\n    };\n  });\n  main.variable(observer(\"get_df_gammas\")).define(\"get_df_gammas\", [\"aq\"], function (aq) {\n    return function get_df_gammas(df_comparison, splink_settings) {\n      var comparison_columns = splink_settings[\"comparison_columns\"]; // let df_gammas = df_comparison;\n      // let derivation = {};\n      // comparison_columns.forEach(function (cc) {\n      //   derivation[\"_\" + cc.col_name] = cc.case_expression;\n      // });\n      // df_gammas = df_gammas.derive(derivation);\n      // Since we want function calls like double metaphone in our comparison columns, we need to\n      // roundtrip from aq -> object -> aq\n\n      var df_gammas = df_comparison.objects();\n      comparison_columns.forEach(function (cc) {\n        df_gammas.forEach(function (row) {\n          row[\"_\" + cc.col_name] = cc.case_expression(row);\n        });\n      });\n      df_gammas = aq.from(df_gammas); // Put columns in order\n\n      var col_order = [\"uid_l\", \"uid_r\"];\n      comparison_columns.forEach(function (cc) {\n        col_order.push(cc.col_name + \"_l\");\n        col_order.push(cc.col_name + \"_r\");\n        col_order.push(\"_\" + cc.col_name);\n      });\n      df_gammas = df_gammas.select(col_order);\n      return df_gammas;\n    };\n  });\n  main.variable(observer(\"bayes_factor_to_prob\")).define(\"bayes_factor_to_prob\", function () {\n    return function bayes_factor_to_prob(b) {\n      return b / (b + 1);\n    };\n  });\n  main.variable(observer(\"log2_bf_to_prob\")).define(\"log2_bf_to_prob\", [\"bayes_factor_to_prob\"], function (bayes_factor_to_prob) {\n    return function log2_bf_to_prob(b) {\n      return bayes_factor_to_prob(Math.pow(2, b));\n    };\n  });\n  main.variable(observer(\"prob_to_bayes_factor\")).define(\"prob_to_bayes_factor\", function () {\n    return function prob_to_bayes_factor(p) {\n      return p / (1 - p);\n    };\n  });\n  main.variable(observer(\"prob_to_log2_bf\")).define(\"prob_to_log2_bf\", [\"prob_to_bayes_factor\"], function (prob_to_bayes_factor) {\n    return function prob_to_log2_bf(p) {\n      return Math.log2(prob_to_bayes_factor(p));\n    };\n  });\n  var child1 = runtime.module(define1);\n  main.import(\"aq\", child1);\n  main.import(\"op\", child1);\n  main.variable(observer(\"first_name_lookup\")).define(\"first_name_lookup\", [\"d3\"], function (d3) {\n    return d3.csv(\"https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/first_name_noyear.csv\", d3.autoType).then(function (csv_file) {\n      var lookup = {};\n      csv_file.forEach(function (row) {\n        lookup[row.firstname] = row.freq;\n      });\n      return lookup;\n    });\n  });\n  main.variable(observer(\"surname_lookup\")).define(\"surname_lookup\", [\"d3\"], function (d3) {\n    return d3.csv(\"https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/last_name.csv\", d3.autoType).then(function (csv_file) {\n      var lookup = {};\n      csv_file.forEach(function (row) {\n        lookup[row.surname] = row.freq;\n      });\n      return lookup;\n    });\n  });\n  main.variable(observer(\"term_freqs\")).define(\"term_freqs\", [\"first_name_lookup\", \"surname_lookup\"], function (first_name_lookup, surname_lookup) {\n    return {\n      fname: first_name_lookup,\n      sname: surname_lookup\n    };\n  });\n  main.variable(observer()).define([\"term_freqs\"], function (term_freqs) {\n    return term_freqs.fname[\"joshua\"];\n  });\n  main.variable(observer()).define([\"term_freqs\"], function (term_freqs) {\n    return term_freqs.sname[\"linacre\"];\n  });\n  return main;\n}","import _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6, _templateObject7, _templateObject8;\n\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Fellegi-Sunter visualisation interface\"])));\n  });\n  main.variable(observer(\"my_interface\")).define(\"my_interface\", [\"inputs\", \"tex\", \"html\"], function (inputs, tex, html) {\n    return function my_interface(col) {\n      var rad_value = col[\"gamma_value\"] == 1 ? \"match\" : \"mismatch\";\n      var rad1 = inputs.radio([\"match\", \"mismatch\"], {\n        label: \"Comparison of \".concat(col[\"col_name\"], \" is a:\"),\n        value: rad_value\n      });\n      var u0 = inputs.range([0, 1], {\n        label: tex(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"u_\\text{\", \",level_0}\"], [\"u_\\\\text{\", \",level\\\\_0}\"])), col[\"col_name\"]),\n        value: col[\"u_probabilities\"][0]\n      });\n      var u1 = inputs.range([0, 1], {\n        label: tex(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"u_\\text{\", \",level_1}\"], [\"u_\\\\text{\", \",level\\\\_1}\"])), col[\"col_name\"]),\n        value: col[\"u_probabilities\"][1]\n      });\n      var m0 = inputs.range([0, 1], {\n        label: tex(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"m_\\text{\", \",level_0}\"], [\"m_\\\\text{\", \",level\\\\_0}\"])), col[\"col_name\"]),\n        value: col[\"m_probabilities\"][0]\n      });\n      var m1 = inputs.range([0, 1], {\n        label: tex(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"m_\\text{\", \",level_1}\"], [\"m_\\\\text{\", \",level\\\\_1}\"])), col[\"col_name\"]),\n        value: col[\"m_probabilities\"][1]\n      });\n      var form = html(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"\\n    <h4>Choose value and parameters for \", \"</h4>\\n    \", \"\\n    <div class=\\\"container\\\">\\n      <div class=\\\"item-0\\\">\", \"\", \"</div>\\n      <div class=\\\"item-1\\\">\", \"\", \"</div>\\n    </div>\\n  \"])), col[\"col_name\"], rad1, u0, m0, u1, m1);\n\n      var get_value = function get_value() {\n        return {\n          col_name: col[\"col_name\"],\n          gamma_value: rad1.querySelector(\"input\").checked ? 1 : 0,\n          u_probabilities: [u0.value, u1.value],\n          m_probabilities: [m0.value, m1.value]\n        };\n      };\n\n      rad1.onclick = function () {\n        // form.dispatchEvent(new CustomEvent(\"input\"));\n        console.log(rad1.value);\n        form.value = get_value();\n      };\n\n      u0.oninput = function () {\n        u1.value = 1.0 - u0.value;\n        form.value = get_value(); // form.dispatchEvent(new CustomEvent(\"input\"));\n      };\n\n      u1.oninput = function () {\n        u0.value = 1.0 - u1.value;\n        form.value = get_value(); // form.dispatchEvent(new CustomEvent(\"input\"));\n      };\n\n      m0.oninput = function () {\n        m1.value = 1.0 - m0.value;\n        form.value = get_value(); // form.dispatchEvent(new CustomEvent(\"input\"));\n      };\n\n      m1.oninput = function () {\n        m0.value = 1.0 - m1.value;\n        form.value = get_value(); // form.dispatchEvent(new CustomEvent(\"input\"));\n      };\n\n      form.value = get_value();\n      return form;\n    };\n  });\n  main.variable(observer(\"viewof fname_val\")).define(\"viewof fname_val\", [\"my_interface\"], function (my_interface) {\n    return my_interface({\n      col_name: \"fname\",\n      gamma_value: 1,\n      m_probabilities: [0.3, 0.7],\n      u_probabilities: [0.75, 0.25]\n    });\n  });\n  main.variable(observer(\"fname_val\")).define(\"fname_val\", [\"Generators\", \"viewof fname_val\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer()).define([\"fname_val\"], function (fname_val) {\n    return fname_val;\n  });\n  main.variable(observer(\"viewof sname_val\")).define(\"viewof sname_val\", [\"my_interface\"], function (my_interface) {\n    return my_interface({\n      col_name: \"sname\",\n      gamma_value: 0,\n      m_probabilities: [0.2, 0.8],\n      u_probabilities: [0.85, 0.15]\n    });\n  });\n  main.variable(observer(\"sname_val\")).define(\"sname_val\", [\"Generators\", \"viewof sname_val\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"viewof dob_val\")).define(\"viewof dob_val\", [\"my_interface\"], function (my_interface) {\n    return my_interface({\n      col_name: \"dob\",\n      gamma_value: 1,\n      m_probabilities: [0.2, 0.8],\n      u_probabilities: [0.8, 0.2]\n    });\n  });\n  main.variable(observer(\"dob_val\")).define(\"dob_val\", [\"Generators\", \"viewof dob_val\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"viewof town_val\")).define(\"viewof town_val\", [\"my_interface\"], function (my_interface) {\n    return my_interface({\n      col_name: \"town\",\n      gamma_value: 1,\n      m_probabilities: [0.3, 0.7],\n      u_probabilities: [0.9, 0.1]\n    });\n  });\n  main.variable(observer(\"town_val\")).define(\"town_val\", [\"Generators\", \"viewof town_val\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"viewof lam\")).define(\"viewof lam\", [\"inputs\", \"tex\"], function (inputs, tex) {\n    return inputs.range([0, 1], {\n      label: tex(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"lambda\"], [\"\\\\lambda\"]))),\n      value: 0.3\n    });\n  });\n  main.variable(observer(\"lam\")).define(\"lam\", [\"Generators\", \"viewof lam\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"splink_settings\")).define(\"splink_settings\", [\"lam\", \"fname_val\", \"sname_val\", \"dob_val\", \"town_val\"], function (lam, fname_val, sname_val, dob_val, town_val) {\n    return {\n      proportion_of_matches: lam,\n      comparison_columns: [fname_val, sname_val, dob_val, town_val]\n    };\n  });\n  main.variable(observer(\"form_styles\")).define(\"form_styles\", [\"html\"], function (html) {\n    return html(_templateObject8 || (_templateObject8 = _taggedTemplateLiteral([\"<style>.container {\\n  display: flex;\\nflex-wrap: wrap;\\n  gap: 12px;\\n}\\n</style>\\n\"])));\n  });\n  main.variable(observer(\"inputs\")).define(\"inputs\", [\"require\"], function (require) {\n    return require(\"@observablehq/inputs\");\n  });\n  return main;\n}","import _defineProperty from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6, _templateObject7, _templateObject8, _templateObject9, _templateObject10, _templateObject11, _templateObject12, _templateObject13, _templateObject14, _templateObject15, _templateObject16, _templateObject17, _templateObject18, _templateObject19, _templateObject20, _templateObject21, _templateObject22, _templateObject23, _templateObject24, _templateObject25, _templateObject26, _templateObject27, _templateObject28, _templateObject29, _templateObject30, _templateObject31, _templateObject32, _templateObject33, _templateObject34, _templateObject35, _templateObject36, _templateObject37, _templateObject38, _templateObject39, _templateObject40, _templateObject41, _templateObject42, _templateObject43, _templateObject44, _templateObject45, _templateObject46, _templateObject47, _templateObject48, _templateObject49, _templateObject50, _templateObject51, _templateObject52, _templateObject53, _templateObject54, _templateObject55, _templateObject56, _templateObject57, _templateObject58, _templateObject59, _templateObject60, _templateObject61, _templateObject62, _templateObject63, _templateObject64, _templateObject65, _templateObject66, _templateObject67, _templateObject68, _templateObject69;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// https://observablehq.com/@robinl/visualising-fellegi-sunter@1011\nimport define1 from \"./379dba93f4bb9357@1122.js\";\nimport define2 from \"./d25176b0fe784ad0@488.js\";\nimport define3 from \"./ecf81050a24329e5@163.js\";\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer(\"title\")).define(\"title\", [\"md\"], function (md) {\n    return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Visualising the Fellegi Sunter model \"])));\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"*A final version of this notebook can be viewed on my blog [here](https://www.robinlinacre.com/visualising_fellegi_sunter/).*\"])));\n  });\n  main.variable(observer(\"para_1\")).define(\"para_1\", [\"md\", \"texd\"], function (md, texd) {\n    return md(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"The [previous article](https://www.robinlinacre.com/maths_of_fellegi_sunter/) presented an implementation of the Fellegi Sunter model.  We showed that match probability could be represented by Equation 1 - which is reproduced below:\\n\", \"\\n\\n\"])), texd(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\\noperatorname{Pr}(\\text{records match}|gamma_{1},gamma_{2},ldots,gamma_{K})  \\newline [10pt] = \\frac{lambda m_{1ell}m_{2ell}ldots m_{Kell}}{lambda m_{1ell}m_{2ell}ldots m_{Kell}+ (1-lambda)u_{1ell}u_{1ell} ldots u_{Kell}} \"], [\"\\n\\\\operatorname{Pr}(\\\\text{records match}|\\\\gamma_{1},\\\\gamma_{2},\\\\ldots,\\\\gamma_{K})  \\\\newline [10pt] = \\\\frac{\\\\lambda m_{1\\\\ell}m_{2\\\\ell}\\\\ldots m_{K\\\\ell}}{\\\\lambda m_{1\\\\ell}m_{2\\\\ell}\\\\ldots m_{K\\\\ell}+ (1-\\\\lambda)u_{1\\\\ell}u_{1\\\\ell} \\\\ldots u_{K\\\\ell}} \"]))));\n  });\n  main.variable(observer(\"para_2\")).define(\"para_2\", [\"md\"], function (md) {\n    return md(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"This article presents a way to understand and visualise this formula.\"])));\n  });\n  main.variable(observer(\"para_3\")).define(\"para_3\", [\"md\"], function (md) {\n    return md(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"In our visualisation, we are going to take each piece of evidence into account in turn. This is possible due to our assumption of conditional independence of comparison columns given the match status.\\n\\nThe means Equation 1 is equivalent to a repeated application of Bayes' Theorem (see annex). See [here](https://www.youtube.com/watch?v=HZGCoVF3YvM) is more in depth video about Bayes Theorem.\\n\"])));\n  });\n  main.variable(observer(\"para_4\")).define(\"para_4\", [\"md\"], function (md) {\n    return md(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"## Example\\n\\nWe are going to compute match probability for a record comparison with the following comparison columns:\\n\\n- `fname` (first name)\\n- `sname` (surname)\\n- `dob` (date of birth)\\n- `town` \\n\\n\\nThe default parameter values are a bit unrealistic, but help make sure the diagrams are legible.\\n\"], [\"## Example\\n\\nWe are going to compute match probability for a record comparison with the following comparison columns:\\n\\n- \\\\`fname\\\\` (first name)\\n- \\\\`sname\\\\` (surname)\\n- \\\\`dob\\\\` (date of birth)\\n- \\\\`town\\\\` \\n\\n\\nThe default parameter values are a bit unrealistic, but help make sure the diagrams are legible.\\n\"])));\n  });\n  main.variable(observer(\"subhead_1\")).define(\"subhead_1\", [\"md\"], function (md) {\n    return md(_templateObject8 || (_templateObject8 = _taggedTemplateLiteral([\"## Step 1\"])));\n  });\n  main.variable(observer(\"para_5\")).define(\"para_5\", [\"md\", \"m\", \"nm\", \"tex\"], function (md, m, nm, tex) {\n    return md(_templateObject9 || (_templateObject9 = _taggedTemplateLiteral([\"We begin by visualising the space of all pairwise record comparisons, splitting the overall comparison space into \", \" and \", \" using our prior, \", \"\"])), m(_templateObject10 || (_templateObject10 = _taggedTemplateLiteral([\"matches\"]))), nm(_templateObject11 || (_templateObject11 = _taggedTemplateLiteral([\"non-matches\"]))), tex(_templateObject12 || (_templateObject12 = _taggedTemplateLiteral([\"operatorname{Pr}(\\text{records match}) =  lambda\"], [\"\\\\operatorname{Pr}(\\\\text{records match}) =  \\\\lambda\"]))));\n  });\n  main.variable(observer(\"lam_view\")).define(\"lam_view\", [\"viewof lam\"], function ($0) {\n    return $0;\n  });\n  main.variable(observer(\"treemap_1\")).define(\"treemap_1\", [\"plot_treemap\", \"splink_settings\"], function (plot_treemap, splink_settings) {\n    return plot_treemap(splink_settings, 0, 300);\n  });\n  main.variable(observer(\"para_6\")).define(\"para_6\", [\"md\", \"texd\", \"color_match\", \"color_non_match\", \"splink_settings\"], function (md, texd, color_match, color_non_match, splink_settings) {\n    return md(_templateObject13 || (_templateObject13 = _taggedTemplateLiteral([\"Using only this information, our estimate of match probability is just the prior:\\n\\n\", \"\\n\\n\"])), texd(_templateObject14 || (_templateObject14 = _taggedTemplateLiteral([\"\\text{match probability} =  \\frac{lambda }{lambda + (1-lambda)}  \\newline [10pt] = \\frac{colorbox{\", \"}{\\text{yellow area}}}{colorbox{\", \"}{\\text{yellow area}} + colorbox{\", \"}{\\text{blue area}} }= \", \" \"], [\"\\\\text{match probability} =  \\\\frac{\\\\lambda }{\\\\lambda + (1-\\\\lambda)}  \\\\newline [10pt] = \\\\frac{\\\\colorbox{\", \"}{\\\\text{yellow area}}}{\\\\colorbox{\", \"}{\\\\text{yellow area}} + \\\\colorbox{\", \"}{\\\\text{blue area}} }= \", \" \"])), color_match.hex(), color_match.hex(), color_non_match.hex(), splink_settings[\"proportion_of_matches\"].toPrecision(4)));\n  });\n  main.variable(observer(\"subhead_2\")).define(\"subhead_2\", [\"md\"], function (md) {\n    return md(_templateObject15 || (_templateObject15 = _taggedTemplateLiteral([\"## Step 2 - First name\"])));\n  });\n  main.variable(observer(\"para_7\")).define(\"para_7\", [\"md\"], function (md) {\n    return md(_templateObject16 || (_templateObject16 = _taggedTemplateLiteral([\"We will now choose the parameters of the model for the first name field, and then take this information into account in the diagram.\"])));\n  });\n  main.variable(observer(\"fname_view\")).define(\"fname_view\", [\"viewof fname_val\"], function ($0) {\n    return $0;\n  });\n  main.variable(observer(\"para_8\")).define(\"para_8\", [\"md\", \"choice_text\", \"splink_settings\", \"dict_as_md_table_row\", \"get_row_no_gammas\", \"get_m_u_text\", \"get_row\", \"m\", \"nm\"], function (md, choice_text, splink_settings, dict_as_md_table_row, get_row_no_gammas, get_m_u_text, get_row, m, nm) {\n    return md(_templateObject17 || (_templateObject17 = _taggedTemplateLiteral([\" \", \"\\nAn example of the data would be:\\n\", \"\\n\\nAccording to the model parameters you've chosen:\\n\\n\\n- \", \"\\n- \", \"\\n\\n\\n\\nGiven this observation, we can subdivide the comparison space, and we know we must be in the \", \" or \", \" part of the following diagram:\\n\"])), choice_text(\"fname\", splink_settings), dict_as_md_table_row(get_row_no_gammas(1)), get_m_u_text(\"fname\", get_row(1), splink_settings, \"m\"), get_m_u_text(\"fname\", get_row(1), splink_settings, \"u\"), m(_templateObject18 || (_templateObject18 = _taggedTemplateLiteral([\"yellow\"]))), nm(_templateObject19 || (_templateObject19 = _taggedTemplateLiteral([\"blue\"]))));\n  });\n  main.variable(observer(\"treemap_2\")).define(\"treemap_2\", [\"plot_treemap\", \"splink_settings\"], function (plot_treemap, splink_settings) {\n    return plot_treemap(splink_settings, 1, 300);\n  });\n  main.variable(observer(\"para_9\")).define(\"para_9\", [\"md\", \"m\", \"texd\", \"color_match\", \"color_non_match\", \"tex\", \"get_m_u_formula_numbers\", \"get_row\", \"splink_settings\"], function (md, m, texd, color_match, color_non_match, tex, get_m_u_formula_numbers, get_row, splink_settings) {\n    return md(_templateObject20 || (_templateObject20 = _taggedTemplateLiteral([\" What's the probability we're in the \", \" area?  This must be:\\n\\n\", \"\\n\\nFrom this diagram we can see that the \", \" and the \\n\", \".\\n\\nSo:\\n\\n\", \"\\n\\nWhich, in numbers is:\\n\\n\", \"\\n\"])), m(_templateObject21 || (_templateObject21 = _taggedTemplateLiteral([\"yellow\"]))), texd(_templateObject22 || (_templateObject22 = _taggedTemplateLiteral([\"\\text{match probability} = \\frac{colorbox{\", \"}{\\text{yellow area}}}{colorbox{\", \"}{\\text{yellow area}} + colorbox{\", \"}{\\text{blue area}} } \"], [\"\\\\text{match probability} = \\\\frac{\\\\colorbox{\", \"}{\\\\text{yellow area}}}{\\\\colorbox{\", \"}{\\\\text{yellow area}} + \\\\colorbox{\", \"}{\\\\text{blue area}} } \"])), color_match.hex(), color_match.hex(), color_non_match.hex()), tex(_templateObject23 || (_templateObject23 = _taggedTemplateLiteral([\"colorbox{\", \"}{$\\text{yellow area} = lambda m_{1ell}$}\"], [\"\\\\colorbox{\", \"}{$\\\\text{yellow area} = \\\\lambda m_{1\\\\ell}$}\"])), color_match.hex()), tex(_templateObject24 || (_templateObject24 = _taggedTemplateLiteral([\"colorbox{\", \"}{$\\text{blue area} = (1-lambda) u_{1ell}$}\"], [\"\\\\colorbox{\", \"}{$\\\\text{blue area} = (1-\\\\lambda) u_{1\\\\ell}$}\"])), color_non_match.hex()), texd(_templateObject25 || (_templateObject25 = _taggedTemplateLiteral([\"\\text{match probability} =  \\frac{lambda m_{1ell}}{lambda m_{1ell}+ (1-lambda)u_{1ell}}\"], [\"\\\\text{match probability} =  \\\\frac{\\\\lambda m_{1\\\\ell}}{\\\\lambda m_{1\\\\ell}+ (1-\\\\lambda)u_{1\\\\ell}}\"]))), tex(_templateObject26 || (_templateObject26 = _taggedTemplateLiteral([\"\", \"\"])), get_m_u_formula_numbers(get_row(2), splink_settings, 1)));\n  });\n  main.variable(observer(\"subhead_3\")).define(\"subhead_3\", [\"md\"], function (md) {\n    return md(_templateObject27 || (_templateObject27 = _taggedTemplateLiteral([\"## Step 3 - Surname\"])));\n  });\n  main.variable(observer(\"para_10\")).define(\"para_10\", [\"md\"], function (md) {\n    return md(_templateObject28 || (_templateObject28 = _taggedTemplateLiteral([\"Let's also choose parameters for `sname`, the surname field:\"], [\"Let's also choose parameters for \\\\`sname\\\\`, the surname field:\"])));\n  });\n  main.variable(observer(\"sname_view\")).define(\"sname_view\", [\"viewof sname_val\"], function ($0) {\n    return $0;\n  });\n  main.variable(observer(\"para_11\")).define(\"para_11\", [\"md\", \"choice_text\", \"splink_settings\", \"dict_as_md_table_row\", \"get_row_no_gammas\", \"get_m_u_text\", \"get_row\", \"m\", \"nm\"], function (md, choice_text, splink_settings, dict_as_md_table_row, get_row_no_gammas, get_m_u_text, get_row, m, nm) {\n    return md(_templateObject29 || (_templateObject29 = _taggedTemplateLiteral([\"\", \"\\nAn example of the data would be:\\n\", \"\\n\\nAccording to the model parameters you've chosen:\\n\\n\\n- \", \"\\n- \", \"\\n\\n\\n\\nGiven this observation, we can subdivide the comparison space, and we know we must be in the \", \" or \", \" part of the following diagram:\"])), choice_text(\"sname\", splink_settings), dict_as_md_table_row(get_row_no_gammas(2)), get_m_u_text(\"sname\", get_row(2), splink_settings, \"m\"), get_m_u_text(\"sname\", get_row(2), splink_settings, \"u\"), m(_templateObject30 || (_templateObject30 = _taggedTemplateLiteral([\"yellow\"]))), nm(_templateObject31 || (_templateObject31 = _taggedTemplateLiteral([\"blue\"]))));\n  });\n  main.variable(observer(\"treemap_3\")).define(\"treemap_3\", [\"plot_treemap\", \"splink_settings\"], function (plot_treemap, splink_settings) {\n    return plot_treemap(splink_settings, 2, 300);\n  });\n  main.variable(observer(\"para_12\")).define(\"para_12\", [\"md\", \"texd\", \"color_match\", \"color_non_match\", \"get_m_u_formula_numbers\", \"get_row\", \"splink_settings\"], function (md, texd, color_match, color_non_match, get_m_u_formula_numbers, get_row, splink_settings) {\n    return md(_templateObject32 || (_templateObject32 = _taggedTemplateLiteral([\"We now have:\\n\\n\", \"\\n\\n\", \"\\n\\nWhich, in numbers is:\\n\\n\", \"\\n\"])), texd(_templateObject33 || (_templateObject33 = _taggedTemplateLiteral([\"\\text{match probability} = \\frac{colorbox{\", \"}{\\text{yellow area}}}{colorbox{\", \"}{\\text{yellow area}} + colorbox{\", \"}{\\text{blue area}} } \"], [\"\\\\text{match probability} = \\\\frac{\\\\colorbox{\", \"}{\\\\text{yellow area}}}{\\\\colorbox{\", \"}{\\\\text{yellow area}} + \\\\colorbox{\", \"}{\\\\text{blue area}} } \"])), color_match.hex(), color_match.hex(), color_non_match.hex()), texd(_templateObject34 || (_templateObject34 = _taggedTemplateLiteral([\"= \\frac{lambda m_{1ell}m_{2ell}}{lambda m_{1ell}m_{2ell}+ (1-lambda)u_{1ell}u_{2ell}}\"], [\"= \\\\frac{\\\\lambda m_{1\\\\ell}m_{2\\\\ell}}{\\\\lambda m_{1\\\\ell}m_{2\\\\ell}+ (1-\\\\lambda)u_{1\\\\ell}u_{2\\\\ell}}\"]))), texd(_templateObject35 || (_templateObject35 = _taggedTemplateLiteral([\"\", \"\"])), get_m_u_formula_numbers(get_row(2), splink_settings, 2)));\n  });\n  main.variable(observer(\"subhead_4\")).define(\"subhead_4\", [\"md\"], function (md) {\n    return md(_templateObject36 || (_templateObject36 = _taggedTemplateLiteral([\"## Step 4 - Date of birth\"])));\n  });\n  main.variable(observer(\"dob_view\")).define(\"dob_view\", [\"viewof dob_val\"], function ($0) {\n    return $0;\n  });\n  main.variable(observer(\"para_13\")).define(\"para_13\", [\"md\", \"choice_text\", \"splink_settings\", \"dict_as_md_table_row\", \"get_row_no_gammas\", \"get_m_u_text\", \"get_row\", \"m\", \"nm\"], function (md, choice_text, splink_settings, dict_as_md_table_row, get_row_no_gammas, get_m_u_text, get_row, m, nm) {\n    return md(_templateObject37 || (_templateObject37 = _taggedTemplateLiteral([\" \", \"\\nAn example of the data would be:\\n\", \"\\n\\nAccording to the model parameters you've chosen:\\n\\n\\n- \", \"\\n- \", \"\\n\\n\\n\\nGiven this observation, we can subdivide the comparison space, and we know we must be in the \", \" or \", \" part of the following diagram:\\n\"])), choice_text(\"dob\", splink_settings), dict_as_md_table_row(get_row_no_gammas(3)), get_m_u_text(\"dob\", get_row(3), splink_settings, \"m\"), get_m_u_text(\"dob\", get_row(3), splink_settings, \"u\"), m(_templateObject38 || (_templateObject38 = _taggedTemplateLiteral([\"yellow\"]))), nm(_templateObject39 || (_templateObject39 = _taggedTemplateLiteral([\"blue\"]))));\n  });\n  main.variable(observer(\"treemap_4\")).define(\"treemap_4\", [\"plot_treemap\", \"splink_settings\"], function (plot_treemap, splink_settings) {\n    return plot_treemap(splink_settings, 3, 300);\n  });\n  main.variable(observer(\"para_14\")).define(\"para_14\", [\"md\", \"texd\", \"get_m_u_formula_numbers\", \"get_row\", \"splink_settings\"], function (md, texd, get_m_u_formula_numbers, get_row, splink_settings) {\n    return md(_templateObject40 || (_templateObject40 = _taggedTemplateLiteral([\"We now have:\\n\\n\", \"\\n\\n\", \"\\n\"])), texd(_templateObject41 || (_templateObject41 = _taggedTemplateLiteral([\"\\text{match probability} =  \\frac{lambda m_{1ell}m_{2ell}m_{3ell}}{lambda m_{1ell}m_{2ell}m_{3ell}+ (1-lambda)u_{1ell}u_{2ell}u_{3ell}}\"], [\"\\\\text{match probability} =  \\\\frac{\\\\lambda m_{1\\\\ell}m_{2\\\\ell}m_{3\\\\ell}}{\\\\lambda m_{1\\\\ell}m_{2\\\\ell}m_{3\\\\ell}+ (1-\\\\lambda)u_{1\\\\ell}u_{2\\\\ell}u_{3\\\\ell}}\"]))), texd(_templateObject42 || (_templateObject42 = _taggedTemplateLiteral([\"\", \"\"])), get_m_u_formula_numbers(get_row(3), splink_settings, 3)));\n  });\n  main.variable(observer(\"subhead_5\")).define(\"subhead_5\", [\"md\"], function (md) {\n    return md(_templateObject43 || (_templateObject43 = _taggedTemplateLiteral([\"## Step 5: Town\"])));\n  });\n  main.variable(observer(\"town_view\")).define(\"town_view\", [\"viewof town_val\"], function ($0) {\n    return $0;\n  });\n  main.variable(observer(\"para_15\")).define(\"para_15\", [\"md\", \"choice_text\", \"splink_settings\", \"dict_as_md_table_row\", \"get_row_no_gammas\", \"get_m_u_text\", \"get_row\", \"m\", \"nm\"], function (md, choice_text, splink_settings, dict_as_md_table_row, get_row_no_gammas, get_m_u_text, get_row, m, nm) {\n    return md(_templateObject44 || (_templateObject44 = _taggedTemplateLiteral([\"The final column is town.\\n\\n\", \"\\nAn example of the final data would be:\\n\", \"\\n\\nAccording to the model parameters you've chosen:\\n\\n\\n- \", \"\\n- \", \"\\n\\n\\n\\nGiven this observation, we can subdivide the comparison space, and we know we must be in the \", \" or \", \" part of the following diagram:\\n\"])), choice_text(\"town\", splink_settings), dict_as_md_table_row(get_row_no_gammas(4)), get_m_u_text(\"town\", get_row(4), splink_settings, \"m\"), get_m_u_text(\"town\", get_row(4), splink_settings, \"u\"), m(_templateObject45 || (_templateObject45 = _taggedTemplateLiteral([\"yellow\"]))), nm(_templateObject46 || (_templateObject46 = _taggedTemplateLiteral([\"blue\"]))));\n  });\n  main.variable(observer(\"treemap_5\")).define(\"treemap_5\", [\"plot_treemap\", \"splink_settings\"], function (plot_treemap, splink_settings) {\n    return plot_treemap(splink_settings, 4, 300);\n  });\n  main.variable(observer(\"para_16\")).define(\"para_16\", [\"md\", \"texd\", \"tex\", \"get_m_u_formula_numbers\", \"get_row\", \"splink_settings\"], function (md, texd, tex, get_m_u_formula_numbers, get_row, splink_settings) {\n    return md(_templateObject47 || (_templateObject47 = _taggedTemplateLiteral([\"The final match probability is therefore:\\n\\n\", \"\\n\\nWhich, in numbers is:\\n\\n\\n\", \"\\n\"])), texd(_templateObject48 || (_templateObject48 = _taggedTemplateLiteral([\"\\text{match probability} =  \\frac{lambda m_{1ell}m_{2ell}m_{3ell}m_{4ell}}{lambda m_{1ell}m_{2ell}m_{3ell}m_{4ell}+ (1-lambda)u_{1ell}u_{2ell}u_{3ell}u_{4ell}}\"], [\"\\\\text{match probability} =  \\\\frac{\\\\lambda m_{1\\\\ell}m_{2\\\\ell}m_{3\\\\ell}m_{4\\\\ell}}{\\\\lambda m_{1\\\\ell}m_{2\\\\ell}m_{3\\\\ell}m_{4\\\\ell}+ (1-\\\\lambda)u_{1\\\\ell}u_{2\\\\ell}u_{3\\\\ell}u_{4\\\\ell}}\"]))), tex(_templateObject49 || (_templateObject49 = _taggedTemplateLiteral([\"\", \"\"])), get_m_u_formula_numbers(get_row(4), splink_settings)));\n  });\n  main.variable(observer(\"annex\")).define(\"annex\", [\"md\", \"tex\", \"texd\"], function (md, tex, texd) {\n    return md(_templateObject50 || (_templateObject50 = _taggedTemplateLiteral([\"## Annex:  Mathematical representation\\n\\nThis annex shows why it's possible to represent the calculation of match probability as a step-by-step computation.  \\n\\nIn particular, we will show that we can calculate match probability using a repeated application of Bayes Theorem.  In pseudocode, our algorithm will be:\\n\\n```\\nprior = lambda\\nfor col in compaison_columns:\\n  posterior = bayes(col, prior)\\n  prior = posterior\\n```\\n\\n\\nWhere the final value of the posterior is equal to \", \".\\n\\nTo demonstrate why this works, consider equation 1, for the case of two columns:\\n\\n\", \"\\n\\nWe start by applying Bayes Theorem once, accounting for the first comparison column:\\n\\n\", \"\\n\\nThis posterior, \", \", becomes the new prior, which we now use instead of lambda:\\n\", \"\\n\\nNote that:\\n\\n\", \"\\n\\nBut \", \" shows that  the term \", \" appears on both top and bottom of \", \" and therefore cancels, leaving \", \"  as desired.\\n\\n\"], [\"## Annex:  Mathematical representation\\n\\nThis annex shows why it's possible to represent the calculation of match probability as a step-by-step computation.  \\n\\nIn particular, we will show that we can calculate match probability using a repeated application of Bayes Theorem.  In pseudocode, our algorithm will be:\\n\\n\\\\`\\\\`\\\\`\\nprior = lambda\\nfor col in compaison_columns:\\n  posterior = bayes(col, prior)\\n  prior = posterior\\n\\\\`\\\\`\\\\`\\n\\n\\nWhere the final value of the posterior is equal to \", \".\\n\\nTo demonstrate why this works, consider equation 1, for the case of two columns:\\n\\n\", \"\\n\\nWe start by applying Bayes Theorem once, accounting for the first comparison column:\\n\\n\", \"\\n\\nThis posterior, \", \", becomes the new prior, which we now use instead of lambda:\\n\", \"\\n\\nNote that:\\n\\n\", \"\\n\\nBut \", \" shows that  the term \", \" appears on both top and bottom of \", \" and therefore cancels, leaving \", \"  as desired.\\n\\n\"])), tex(_templateObject51 || (_templateObject51 = _taggedTemplateLiteral([\"\\noperatorname{Pr}(\\text{records match}|gamma_{1},gamma_{2},ldots,gamma_{K})\"], [\"\\n\\\\operatorname{Pr}(\\\\text{records match}|\\\\gamma_{1},\\\\gamma_{2},\\\\ldots,\\\\gamma_{K})\"]))), texd(_templateObject52 || (_templateObject52 = _taggedTemplateLiteral([\"\\noperatorname{Pr}(\\text{records match}|gamma_{1},gamma_{2}) = \\frac{lambda m_{1ell}m_{2ell}}{lambda m_{1ell}m_{2ell}+ (1-lambda)u_{1ell}u_{1ell}} \\tag{2.1}\"], [\"\\n\\\\operatorname{Pr}(\\\\text{records match}|\\\\gamma_{1},\\\\gamma_{2}) = \\\\frac{\\\\lambda m_{1\\\\ell}m_{2\\\\ell}}{\\\\lambda m_{1\\\\ell}m_{2\\\\ell}+ (1-\\\\lambda)u_{1\\\\ell}u_{1\\\\ell}} \\\\tag{2.1}\"]))), texd(_templateObject53 || (_templateObject53 = _taggedTemplateLiteral([\"\\noperatorname{Pr}(\\text{records match}|gamma_{1}) = t = \\frac{lambda m_{1ell}}{lambda m_{1ell}+ (1-lambda)u_{1ell}}\"], [\"\\n\\\\operatorname{Pr}(\\\\text{records match}|\\\\gamma_{1}) = t = \\\\frac{\\\\lambda m_{1\\\\ell}}{\\\\lambda m_{1\\\\ell}+ (1-\\\\lambda)u_{1\\\\ell}}\"]))), tex(_templateObject54 || (_templateObject54 = _taggedTemplateLiteral([\"t\"]))), texd(_templateObject55 || (_templateObject55 = _taggedTemplateLiteral([\"\\n\\text{posterior} = operatorname{Pr}(\\text{records match}|gamma_{1},gamma_{2}) = \\frac{t m_{2ell}}{t m_{2ell}+ (1-t)u_{2ell}}\\tag{2.2}\"], [\"\\n\\\\text{posterior} = \\\\operatorname{Pr}(\\\\text{records match}|\\\\gamma_{1},\\\\gamma_{2}) = \\\\frac{t m_{2\\\\ell}}{t m_{2\\\\ell}+ (1-t)u_{2\\\\ell}}\\\\tag{2.2}\"]))), texd(_templateObject56 || (_templateObject56 = _taggedTemplateLiteral([\"\\n1- t = 1 - \\frac{lambda m_{1ell}}{lambda m_{1ell}+ (1-lambda)u_{1ell}} = \\frac{lambda m_{1ell}+ (1-lambda)u_{1ell} - lambda m_{1ell}}{lambda m_{1ell}+ (1-lambda)u_{1ell}} = \\frac{(1-lambda)u_{1ell} }{lambda m_{1ell}+ (1-lambda)u_{1ell}}\\tag{2.3}\"], [\"\\n1- t = 1 - \\\\frac{\\\\lambda m_{1\\\\ell}}{\\\\lambda m_{1\\\\ell}+ (1-\\\\lambda)u_{1\\\\ell}} = \\\\frac{\\\\lambda m_{1\\\\ell}+ (1-\\\\lambda)u_{1\\\\ell} - \\\\lambda m_{1\\\\ell}}{\\\\lambda m_{1\\\\ell}+ (1-\\\\lambda)u_{1\\\\ell}} = \\\\frac{(1-\\\\lambda)u_{1\\\\ell} }{\\\\lambda m_{1\\\\ell}+ (1-\\\\lambda)u_{1\\\\ell}}\\\\tag{2.3}\"]))), tex(_templateObject57 || (_templateObject57 = _taggedTemplateLiteral([\"(2.3)\"]))), tex(_templateObject58 || (_templateObject58 = _taggedTemplateLiteral([\"(lambda m_{1ell}+ (1-lambda)u_{1ell})\"], [\"(\\\\lambda m_{1\\\\ell}+ (1-\\\\lambda)u_{1\\\\ell})\"]))), tex(_templateObject59 || (_templateObject59 = _taggedTemplateLiteral([\"(2.2)\"]))), tex(_templateObject60 || (_templateObject60 = _taggedTemplateLiteral([\"(2.1)\"]))));\n  });\n  main.variable(observer(\"texd\")).define(\"texd\", [\"tex\"], function (tex) {\n    return tex.options({\n      displayMode: true,\n      fleqn: true\n    });\n  });\n  main.variable(observer(\"css_styles\")).define(\"css_styles\", [\"html\", \"color_match\", \"color_non_match\"], function (html, color_match, color_non_match) {\n    return html(_templateObject61 || (_templateObject61 = _taggedTemplateLiteral([\"<style>\\n.katex-display>.katex { font-size: 1em}\\n\\n\\ntextarea {\\n    max-height: 1000em !important;\\n    font-family: monospace !important;\\n}\\n\\n.katex-display>.katex>.katex-html>.tag {right: unset; padding-left:4em}\\n\\n.hl_m {\\nbackground-color: \", \";\\ndisplay:inline-block;\\n}\\n\\n.hl_nm {\\nbackground-color: \", \";\\ndisplay:inline-block;\\n}\\n\\n</style>\"])), color_match.hex(), color_non_match.hex());\n  });\n  var child1 = runtime.module(define1);\n  main.import(\"default_settings\", child1);\n  main.variable(observer(\"get_row\")).define(\"get_row\", [\"splink_settings\"], function (splink_settings) {\n    return function get_row(depth) {\n      var row = {};\n      var lookup = {\n        fname: [{\n          fname_l: \"John\",\n          fname_r: \"Tom\"\n        }, {\n          fname_l: \"John\",\n          fname_r: \"John\"\n        }],\n        sname: [{\n          sname_l: \"Smith\",\n          sname_r: \"Hanks\"\n        }, {\n          sname_l: \"Smith\",\n          sname_r: \"Smith\"\n        }],\n        dob: [{\n          dob_l: \"1989-03-02\",\n          dob_r: \"1981-08-21\"\n        }, {\n          dob_l: \"1989-03-02\",\n          dob_r: \"1989-03-02\"\n        }],\n        town: [{\n          town_l: \"Bristol\",\n          town_r: \"Peckham\"\n        }, {\n          town_l: \"Bristol\",\n          town_r: \"Bristol\"\n        }]\n      };\n      var ccs = splink_settings.comparison_columns.slice(0, depth);\n      ccs.forEach(function (cc) {\n        var values = lookup[cc.col_name][cc.gamma_value];\n        row = _objectSpread(_objectSpread({}, row), values);\n        var gamma_name = \"_\" + cc.col_name;\n        row[gamma_name] = cc.gamma_value;\n      });\n      return row;\n    };\n  });\n  main.variable(observer(\"get_row_no_gammas\")).define(\"get_row_no_gammas\", [\"get_row\"], function (get_row) {\n    return function get_row_no_gammas(depth) {\n      var row = get_row(depth);\n      var keys = Object.keys(row).filter(function (d) {\n        return !d.includes(\"_\");\n      });\n      var new_object = {};\n      keys.forEach(function (k) {\n        new_object[k] = row[k];\n      });\n      return new_object;\n    };\n  });\n  var child2 = runtime.module(define2);\n  main.import(\"get_m_u_formula_symbols\", child2);\n  main.import(\"get_m_u_formula_numbers\", child2);\n  main.import(\"get_comparison_vector_symbols_and_numbers\", child2);\n  main.import(\"get_match_probability_components\", child2);\n  main.variable(observer(\"dict_as_md_table_row\")).define(\"dict_as_md_table_row\", [\"md\"], function (md) {\n    return function dict_as_md_table_row(dict) {\n      var row1 = Object.keys(dict).join(\" | \");\n      var row2 = Object.keys(dict).map(function (d) {\n        return \"-\";\n      }).join(\" | \");\n      var row3 = Object.values(dict).join(\" | \");\n      return md(_templateObject62 || (_templateObject62 = _taggedTemplateLiteral([\"\", \" \\n \", \" \\n \", \" \\n\"], [\"\", \" \\\\n \", \" \\\\n \", \" \\\\n\"])), row1, row2, row3);\n    };\n  });\n  var child3 = runtime.module(define1);\n  main.import(\"styles\", child3);\n  main.import(\"plot_treemap\", child3);\n  main.import(\"color_match\", child3);\n  main.import(\"color_non_match\", child3);\n  main.variable(observer(\"additional_styles\")).define(\"additional_styles\", [\"styles\"], function (styles) {\n    return styles;\n  });\n  main.variable(observer(\"nm\")).define(\"nm\", [\"html\"], function (html) {\n    return function nm(text) {\n      return html(_templateObject63 || (_templateObject63 = _taggedTemplateLiteral([\"<span class=\\\"hl_nm\\\">\", \"</span>\"])), text);\n    };\n  });\n  main.variable(observer(\"m\")).define(\"m\", [\"html\"], function (html) {\n    return function m(text) {\n      return html(_templateObject64 || (_templateObject64 = _taggedTemplateLiteral([\"<span class=\\\"hl_m\\\">\", \"</span>\"])), text);\n    };\n  });\n  var child4 = runtime.module(define3);\n  main.import(\"splink_settings\", child4);\n  main.import(\"viewof lam\", child4);\n  main.import(\"lam\", child4);\n  main.import(\"viewof fname_val\", child4);\n  main.import(\"fname_val\", child4);\n  main.import(\"viewof sname_val\", child4);\n  main.import(\"sname_val\", child4);\n  main.import(\"viewof dob_val\", child4);\n  main.import(\"dob_val\", child4);\n  main.import(\"viewof town_val\", child4);\n  main.import(\"town_val\", child4);\n  main.import(\"form_styles\", child4);\n  main.variable(observer(\"styles2\")).define(\"styles2\", [\"form_styles\"], function (form_styles) {\n    return form_styles;\n  });\n  main.variable(observer(\"get_m_u_text\")).define(\"get_m_u_text\", [\"m\", \"nm\", \"md\"], function (m, nm, md) {\n    return function get_m_u_text(colname, row, settings, m_or_u) {\n      var cc = settings.comparison_columns.filter(function (cc) {\n        return cc.col_name == colname;\n      })[0];\n      var gamma_value = row[\"_\" + colname];\n      var matches_text;\n\n      if (gamma_value == 1) {\n        matches_text = \"matches\";\n      } else if (gamma_value == 0) {\n        matches_text = \"does not match\";\n      }\n\n      var col_name_escaped = colname.replace(\"_\", \"\\\\_\");\n      var gamma_tex = \"The column `\".concat(colname, \"` \").concat(matches_text);\n      var percentage = cc[\"\".concat(m_or_u, \"_probabilities\")][gamma_value] * 100;\n      percentage = parseFloat(percentage).toFixed(0) + \"%\";\n      var match_or_non_match;\n\n      if (m_or_u == \"m\") {\n        match_or_non_match = m(_templateObject65 || (_templateObject65 = _taggedTemplateLiteral([\"matching records\"])));\n      } else {\n        match_or_non_match = nm(_templateObject66 || (_templateObject66 = _taggedTemplateLiteral([\"non-matching records\"])));\n      }\n\n      return md(_templateObject67 || (_templateObject67 = _taggedTemplateLiteral([\"\", \" in \", \" of \", \"\"])), gamma_tex, percentage, match_or_non_match);\n    };\n  });\n  main.variable(observer(\"choice_text\")).define(\"choice_text\", [\"md\", \"tex\"], function (md, tex) {\n    return function choice_text(col_name, splink_settings) {\n      var cc;\n      splink_settings.comparison_columns.forEach(function (d) {\n        if (d.col_name == col_name) {\n          cc = d;\n        }\n      });\n      var matches_text;\n      var gamma_value = cc[\"gamma_value\"];\n\n      if (gamma_value == 0) {\n        matches_text = \"does not match\";\n      } else {\n        matches_text = \"matches\";\n      }\n\n      return md(_templateObject68 || (_templateObject68 = _taggedTemplateLiteral([\"You have chosen that the column `\", \"` \", \", i.e. that \", \" = \", \".\"], [\"You have chosen that the column \\\\`\", \"\\\\` \", \", i.e. that \", \" = \", \".\"])), col_name, matches_text, tex(_templateObject69 || (_templateObject69 = _taggedTemplateLiteral([\"gamma_\\text{\", \"}\"], [\"\\\\gamma_\\\\text{\", \"}\"])), col_name), gamma_value);\n    };\n  });\n  main.variable(observer(\"inputs\")).define(\"inputs\", [\"require\"], function (require) {\n    return require(\"@observablehq/inputs\");\n  });\n  return main;\n}","import React from 'react'\nimport define from \"@robinl/visualising-fellegi-sunter\"\n\nimport ProbLinkagePage from \"../components/prob_linkage_page\"\nimport { css } from \"@emotion/core\"\n\nexport const frontmatter = {\n    title: \"Visualising the Fellegi Sunter model\",\n    post_date: \"2021-05-07\",\n    code_url: \"https://observablehq.com/@robinl/visualising-fellegi-sunter\",\n    post_type: \"obs\",\n    post_category: \"probabilistic_linkage\",\n    description: \"An set of interactive, explorable explanations of the Fellegi Sunter model of probabilistic record linkage.  This article presents a way of visualising how the model works.\"\n}\n\nlet output_order = [\n    \"additional_styles\",\n    \"title\",\n    \"para_1\",\n    \"para_2\",\n    \"para_3\",\n    \"para_4\",\n    \"subhead_1\",\n    \"para_5\",\n    \"lam_view\",\n    \"treemap_1\",\n    \"para_6\",\n    \"subhead_2\",\n    \"para_7\",\n    \"fname_view\",\n    \"para_8\",\n    \"treemap_2\",\n    \"para_9\",\n    \"subhead_3\",\n    \"para_10\",\n    \"sname_view\",\n    \"para_11\",\n    \"treemap_3\",\n    \"para_12\",\n\n    \"subhead_4\",\n    \"dob_view\",\n    \"para_13\",\n    \"treemap_4\",\n    \"para_14\",\n\n    \"subhead_5\",\n    \"town_view\",\n    \"para_15\",\n    \"treemap_5\",\n    \"para_16\",\n    \"annex\",\n\n\n    \"additional_styles\",\n    \"styles2\",\n    \"css_styles\"\n\n\n]\n\nconst css_override = css`\nmargin-left: auto;\nmargin-right: auto;\nwidth: 90%;\nmax-width: 800px;\ntable {font-size: 0.8rem;\n line-height: 1rem;}\n div {position: relative}\n .wrap-info {\n     font-size: 0.7rem;\n }\nrem;\n`\n\n\n\n\n\nexport default (props) => {\n\n    return (<ProbLinkagePage\n        define={define}\n        output_order={output_order}\n        post_frontmatter={frontmatter}\n        css={css_override}\n        current_path={props.path}\n    />)\n\n\n}\n"],"sourceRoot":""}