{"version":3,"sources":["webpack://gatsby-starter-hello-world/./node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js","webpack://gatsby-starter-hello-world/./src/components/linkage_footer.jsx","webpack://gatsby-starter-hello-world/./src/components/prob_linkage_page.jsx","webpack://gatsby-starter-hello-world/./node_modules/@robinl/interactive-fellegi-sunter-model/79750b3b8e929d9d@209.js","webpack://gatsby-starter-hello-world/./node_modules/@robinl/interactive-fellegi-sunter-model/d25176b0fe784ad0@488.js","webpack://gatsby-starter-hello-world/./node_modules/@robinl/interactive-fellegi-sunter-model/843cb6e82d7c3d9b@474.js","webpack://gatsby-starter-hello-world/./node_modules/@robinl/interactive-fellegi-sunter-model/9534e8e74053c14e@441.js","webpack://gatsby-starter-hello-world/./src/pages/interactive_fellegi_sunter.jsx"],"names":["_taggedTemplateLiteral","strings","raw","slice","Object","freeze","defineProperties","value","mar","flex","order_of_articles","props","path","current_path","this_index","indexOf","previous_article","next_article","undefined","to","css","post","define","output_order","className","title","post_frontmatter","description","_templateObject","_templateObject2","_templateObject3","_templateObject4","_templateObject5","_templateObject6","_templateObject7","_templateObject8","_templateObject9","_templateObject10","_templateObject11","_templateObject12","_templateObject13","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperty","runtime","observer","main","module","variable","md","_ref","_callee","require","aq_version","aq_packages","toView","aq","_context","prev","next","concat","sent","Promise","all","map","pkg","addPackage","addTableMethod","override","abrupt","stop","_x","_x2","_x3","_x4","this","op","table","dt","derive","month","d","row_number","diff","Seattle","Chicago","select","orderby","view","height","rollup","corr_sf","corr","corr_chi","fold","as","groupby","min","sun","max","avg","average","med","median","skew","_ref2","s","mean","stdev","objects","html","DEFAULT_NULL","tableStyle","cellStyle","opt","limit","color","columnNames","name","_loop","td","index","row","maxCellWidth","null","style","th","size","toHTML","uid","fname","sname","dob","town","records_r","from","proportion_of_matches","comparison_columns","num_levels","col_name","u_probabilities","m_probabilities","case_expression","fname_l","fname_r","sname_l","sname_r","dob_l","dob_r","town_l","town_r","get_df_comparison","records_l","df_comparison","get_df_gammas","splink_settings","df_gammas","get_df_e","term_freqs","get_match_probability","df_e","df","relocate","after","prob_to_log2_bf","log2_bf_to_prob","settings","prior_log2_bg","log2_bayes","reduce","a","cc","gamma_col_name","gamma","m","u","l_val","toLowerCase","r_val","tfs","u_l","u_r","u_new","Math","log2","num_columns","comparison_vector","gamma_symbols","m_values","u_values","m_symbols","u_symbols","bayes_factors","log2_bayes_factors","col_names","match_probability","lam","col_name_escaped","replace","bf","b","get_match_probability_components","toPrecision","lam_m","lam_u","m_tex","join","u_tex","p","m_part","u_part","tex","get_m_u_formula_symbols","joined","joined2","get_comparison_vector_symbols_and_numbers","get_m_u_formula_numbers","records_as_dict_l","records_as_dict_r","df_l","df_r","suffix","colname_no_suffix","cols_ordered","col_order","bayes_factor_to_prob","pow","prob_to_bayes_factor","child1","import","d3","csv","autoType","then","csv_file","lookup","firstname","freq","surname","first_name_lookup","surname_lookup","first_name_l","first_name_r","surname_l","surname_r","date_of_birth_l","get_waterfall_chart","overrides","get_waterfall_chart_data","embed","get_chart_spec","chart_overrides","simplified","data","get_waterfall_data_lambda_row","get_waterfall_data_other_rows","get_waterfall_data_final_row","lambda_row","waterfall_data_other_rows","rows_except_final","final_row","cumulative_log2_bayes_factor","get_comparison_column_lookup","gamma_key","u_probability","m_probability","gamma_value","this_cc","value_l","value_r","bayes_factor","column_name","gamma_column_name","gamma_index","level_name","log2_bayes_factor","prob_to_log2_bayes_factor","get_waterfall_row_gamma","includes","base_spec","base_spec_2","JSON","parse","stringify","values","spec","type","field","condition","test","expr","format","config","continuousHeight","continuousWidth","text","subtitle","transform","window","frame","calculate","layer","mark","encoding","y","width","opacity","tooltip","x","axis","labelExpr","labelAlign","labelPadding","grid","tickBand","sort","orient","y2","fontWeight","labelAngle","baseline","dy","strokeWidth","x2Offset","xOffset","x2","scale","zero","resolve","step","$schema","log2_b","first_name","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","minLen","_arrayLikeToArray","n","prototype","toString","call","constructor","_unsupportedIterableToArray","F","done","e","_e","f","TypeError","err","normalCompletion","didErr","_e2","return","arr","len","arr2","match_prob","inputs","toggle","label","G","_","input","show_complex","Generators","parseTableData","observe","notify","keyinput","event","addEventListener","removeEventListener","querySelectorAll","_step","row_data","_iterator","cells","innerText","trim","accumulator","properties","rowObject","rename_dict_keys","tableData","mname","pc","dm_intersect","distance","mname_l","mname_r","date_l","date_r","d_l","Date","d_r","abs","levenshtein","abs_date_diff_in_years","pc_l","pc_r","fname_case_stmt","mname_case_stmt","sname_case_stmt","dob_case_stmt","pc_case_stmt","child2","dm","val_l","val_r","arr_l","doubleMetaphone","arr_r","j","matrix","charAt","frontmatter","post_date","code_url","post_type","post_category","css_override"],"mappings":"6IAAe,SAASA,EAAuBC,EAASC,GAKtD,OAJKA,IACHA,EAAMD,EAAQE,MAAM,IAGfC,OAAOC,OAAOD,OAAOE,iBAAiBL,EAAS,CACpDC,IAAK,CACHK,MAAOH,OAAOC,OAAOH,O,qJCD3B,IAWMM,EAAG,+DAKHC,EAAI,qEAQJC,EAAoB,CACxB,mCACA,4BACA,+BACA,gCACA,8BACA,mBAoCF,EAjCsB,SAACC,GAErB,IAAIC,EAAOD,EAAME,aAEbC,EAAaJ,EAAkBK,QAAQH,GAEvCI,EAAmBN,EAAkBI,EAAa,GAClDG,EAAeP,EAAkBI,EAAa,GAclD,OAXEE,OADuBE,IAArBF,GACiB,qBAEA,oBAAK,QAAC,KAAD,CAAMG,GAAIH,GAAV,wBAIxBC,OADmBC,IAAjBD,GACa,qBAEA,oBAAK,QAAC,KAAD,CAAME,GAAIF,GAAV,qBAIpB,oBACE,cAAIG,IAAKZ,KACT,eAAKY,IAAKX,GACPO,GACD,oBAAK,QAAC,KAAD,CAAMG,GAAG,0BAAT,+BACJF,K,8BCrCT,MArBA,SAAyBN,GAMvB,IAAIU,GAAO,QAAC,IAAD,CAAwBC,OAAQX,EAAMW,OAAQC,aAAcZ,EAAMY,eAG7E,OACE,QAAC,IAAD,CAAQH,IAAKT,EAAMa,YACjB,QAAC,IAAD,CAAKC,MAAOd,EAAMe,iBAAiBD,MAAOE,YAAahB,EAAMe,iBAAiBC,eAC9E,QAAC,IAAD,CAAiBD,iBAAkBf,EAAMe,mBACxCL,GACD,QAAC,EAAD,CAAeR,aAAcF,EAAME,kB,4HClBrCe,EAAiBC,EAAkBC,EAAkBC,EAAkBC,EAAkBC,EAAkBC,EAAkBC,EAAkBC,EAAkBC,EAAmBC,EAAmBC,EAAmBC,ECF1N,EAAiB,EAAkB,EAAkB,EAAkB,ECCvE,EAAiB,EAAkB,EAAkB,ECDrD,EAAiB,EAAkB,EAAkB,EAAkB,EAAkB,E,iDHI7F,SAASC,EAAQC,EAAQC,GAAkB,IAAIC,EAAOxC,OAAOwC,KAAKF,GAAS,GAAItC,OAAOyC,sBAAuB,CAAE,IAAIC,EAAU1C,OAAOyC,sBAAsBH,GAAaC,IAAkBG,EAAUA,EAAQC,QAAO,SAAUC,GAAO,OAAO5C,OAAO6C,yBAAyBP,EAAQM,GAAKE,eAAkBN,EAAKO,KAAKC,MAAMR,EAAME,GAAY,OAAOF,EAElV,SAASS,EAAcC,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAAyB,MAAhBF,UAAUD,GAAaC,UAAUD,GAAK,GAAQA,EAAI,EAAKd,EAAQrC,OAAOsD,IAAS,GAAMC,SAAQ,SAAUC,IAAO,OAAgBN,EAAQM,EAAKF,EAAOE,OAAsBxD,OAAOyD,0BAA6BzD,OAAOE,iBAAiBgD,EAAQlD,OAAOyD,0BAA0BH,IAAmBjB,EAAQrC,OAAOsD,IAASC,SAAQ,SAAUC,GAAOxD,OAAO0D,eAAeR,EAAQM,EAAKxD,OAAO6C,yBAAyBS,EAAQE,OAAe,OAAON,EAI9f,SAAS,EAAOS,EAASC,GACtC,IAAIC,EAAOF,EAAQG,SAsMnB,OArMAD,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAGxC,IAAoBA,GAAkB,OAAuB,CAAC,+nBAE1EqC,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAGvC,IAAqBA,GAAmB,OAAuB,CAAC,0EAE5EoC,EAAKE,SAASH,EAAS,OAAO1C,OAAO,KAAM,CAAC,UAAW,aAAc,cAAe,UAAwB,WAC1G,IAAI+C,GAAO,OAAgC,UAAyB,SAASC,EAAQC,EAASC,EAAYC,EAAaC,GACrH,IAAIC,EACJ,OAAO,UAAyB,SAAkBC,GAChD,OACE,OAAQA,EAASC,KAAOD,EAASE,MAC/B,KAAK,EAEH,OADAF,EAASE,KAAO,EACTP,EAAQ,WAAWQ,OAAOP,IAEnC,KAAK,EAGH,OAFAG,EAAKC,EAASI,KACdJ,EAASE,KAAO,EACTG,QAAQC,IAAIT,EAAYU,KAAI,SAAUC,GAC3C,OAAOb,EAAQa,OAGnB,KAAK,EASH,OARAR,EAASI,KAAKrB,SAAQ,SAAUyB,GAC9B,OAAOT,EAAGU,WAAWD,MAIvBT,EAAGW,eAAe,OAAQZ,EAAQ,CAChCa,UAAU,IAELX,EAASY,OAAO,SAAUb,GAEnC,KAAK,EACL,IAAK,MACH,OAAOC,EAASa,UAGrBnB,OAGL,OAAO,SAAUoB,EAAIC,EAAKC,EAAKC,GAC7B,OAAOxB,EAAKjB,MAAM0C,KAAMtC,YArCgF,IAwC5GS,EAAKE,SAASH,EAAS,eAAe1C,OAAO,cAAc,WACzD,MAAO,WAET2C,EAAKE,SAASH,EAAS,gBAAgB1C,OAAO,eAAe,WAC3D,MAAO,MAET2C,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAGtC,IAAqBA,GAAmB,OAAuB,CAAC,0DAE5EmC,EAAKE,SAASH,EAAS,OAAO1C,OAAO,KAAM,CAAC,OAAO,SAAUqD,GAC3D,OAAOA,EAAGoB,MAEZ9B,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAGrC,IAAqBA,GAAmB,OAAuB,CAAC,mJAE5EkC,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAGpC,IAAqBA,GAAmB,OAAuB,CAAC,kMAE5EiC,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAGnC,IAAqBA,GAAmB,OAAuB,CAAC,2HAE5EgC,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAGlC,IAAqBA,GAAmB,OAAuB,CAAC,uWAE5E+B,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAGjC,IAAqBA,GAAmB,OAAuB,CAAC,6GAE5E8B,EAAKE,SAASH,EAAS,OAAO1C,OAAO,KAAM,CAAC,OAAO,SAAUqD,GAC3D,OAAOA,EAAGqB,MAAM,CACd,QAAW,CAAC,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,IACjE,QAAW,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KACnE,gBAAiB,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,UAG7E/B,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAGhC,IAAqBA,GAAmB,OAAuB,CAAC,yDAE5E6B,EAAKE,SAASH,KAAY1C,OAAO,CAAC,KAAM,OAAO,SAAU2E,EAAIF,GAC3D,OAAOE,EAAGC,OAAO,CACfC,MAAO,SAAeC,GACpB,OAAOL,EAAGM,cAEZC,KAAM,SAAcF,GAClB,OAAOA,EAAEG,QAAUH,EAAEI,WAEtBC,OAAO,QAAS,QAAQC,QAAQ,SAASC,KAAK,CAC/CC,OAAQ,SAGZ3C,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAG/B,IAAsBA,GAAoB,OAAuB,CAAC,mEAE9E4B,EAAKE,SAASH,KAAY1C,OAAO,CAAC,KAAM,OAAO,SAAU2E,EAAIF,GAC3D,OAAOE,EAAGY,OAAO,CACfC,QAASf,EAAGgB,KAAK,UAAW,iBAC5BC,SAAUjB,EAAGgB,KAAK,UAAW,aAC5BJ,UAEL1C,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAG9B,IAAsBA,GAAoB,OAAuB,CAAC,yDAE9E2B,EAAKE,SAASH,KAAY1C,OAAO,CAAC,KAAM,KAAM,OAAO,SAAU2E,EAAItB,EAAIoB,GACrE,OAAOE,EAAGgB,KAAKtC,EAAGO,MAAO,CACvBgC,GAAI,CAAC,OAAQ,SACZC,QAAQ,QAAQN,OAAO,CACxBO,IAAK,SAAahB,GAChB,OAAOL,EAAGqB,IAAIhB,EAAEiB,MAGlBC,IAAK,SAAalB,GAChB,OAAOL,EAAGuB,IAAIlB,EAAEiB,MAElBE,IAAK,SAAanB,GAChB,OAAOL,EAAGyB,QAAQpB,EAAEiB,MAEtBI,IAAK,SAAarB,GAChB,OAAOL,EAAG2B,OAAOtB,EAAEiB,MAGrBM,KAAM,SAAcC,GAClB,IAAIC,EAAID,EAAMP,IACd,OAAQtB,EAAG+B,KAAKD,GAAK9B,EAAG2B,OAAOG,IAAM9B,EAAGgC,MAAMF,IAAM,KAErDG,aAEL/D,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAG7B,IAAsBA,GAAoB,OAAuB,CAAC,8BAE9E0B,EAAKE,SAASH,EAAS,WAAW1C,OAAO,SAAU,CAAC,SAAS,SAAU2G,GACrE,IAEIC,EAAe,SAAsB3H,GACvC,MAAO,8BAAgCwE,OAAOxE,EAAO,YAGnD4H,EAAa,wDACbC,EAAY,0HAEhB,OAAO,SAAUnC,GACf,IAAIoC,EAAM7E,UAAUC,OAAS,QAAsBvC,IAAjBsC,UAAU,GAAmBA,UAAU,GAAK,GAE3D,iBAAR6E,IAAkBA,EAAM,CACjCC,MAAOD,IAGT,IAAIE,EAAQlF,EAAc,GAAIgF,EAAIE,OAElC,GAAyB,mBAAdF,EAAIE,MAEbtC,EAAGuC,cAAc7E,SAAQ,SAAU8E,GACjC,OAAOF,EAAME,GAAQJ,EAAIE,aAEtB,CACL,IAAIG,EAAQ,SAAe9E,GACzB,IAAIrD,EAAQgI,EAAM3E,GAClB2E,EAAM3E,GAAwB,mBAAVrD,EAAuBA,EAAQ,WACjD,OAAOA,IAKX,IAAK,IAAIqD,KAAO2E,EACdG,EAAM9E,GAKV,IAAIoC,EAAQ,GAAGjB,OAAOoD,GAElBQ,EAAK,SAAYF,EAAMG,EAAOC,GAChC,MAAO,GAAG9D,OAAOqD,EAAW,gBAAgBrD,QAAQsD,EAAIS,cAAgB,IAAK,QAAUP,EAAME,GAAQ,sBAAsB1D,OAAOwD,EAAME,GAAMG,EAAOC,GAAM,KAAO,KAGpKR,EAAMhF,EAAcA,EAAc,CAChCiF,MA7CgB,IA8ChBS,KAAMb,GACLG,GAAM,GAAI,CACXW,MAAO,CACLhD,MAAOA,EACP2C,GAAIA,EACJM,GAAIN,KAIR,IAAIO,EAAO,eAAenE,QAAQsD,EAAIzB,QAAU,IAAK,MACjDoC,EAAQ,GAAGjE,OAAOmE,EAAM,yCACxBvC,EAAOsB,EAAKzF,IAAsBA,GAAoB,OAAuB,CAAC,eAAiB,KAAO,YAAawG,EAAO/C,EAAGkD,OAAOd,IAExI,OADA1B,EAAKpG,MAAQ0F,EACNU,MAGJ1C,EC9MM,SAAS,EAAOF,EAASC,GACtC,IAAIC,EAAOF,EAAQG,SACnBD,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAG,IAAoB,GAAkB,OAAuB,CAAC,gCAE1EH,EAAKE,SAASH,EAAS,cAAc1C,OAAO,aAAa,WACvD,MAAO,CAAC,CACN8H,IAAK,MACLC,MAAO,OACPC,MAAO,QACPC,IAAK,aACLC,KAAM,WACL,CACDJ,IAAK,MACLC,MAAO,MACPC,MAAO,QACPC,IAAK,aACLC,KAAM,WACL,CACDJ,IAAK,MACLC,MAAO,QACPC,MAAO,QACPC,IAAK,aACLC,KAAM,cAGVvF,EAAKE,SAASH,EAAS,cAAc1C,OAAO,aAAa,WACvD,MAAO,CAAC,CACN8H,IAAK,MACLC,MAAO,WACPC,MAAO,QACPC,IAAK,aACLC,KAAM,WACL,CACDJ,IAAK,MACLC,MAAO,QACPC,MAAO,QACPC,IAAK,aACLC,KAAM,eAGVvF,EAAKE,SAASH,EAAS,SAAS1C,OAAO,OAAQ,CAAC,KAAM,cAAc,SAAUqD,EAAI8E,GAChF,OAAO9E,EAAG+E,KAAKD,MAEjBxF,EAAKE,SAASH,EAAS,oBAAoB1C,OAAO,mBAAmB,WACnE,MAAO,CACLqI,sBAAuB,IACvBC,mBAAoB,CAAC,CACnBC,WAAY,EACZC,SAAU,QACVC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,SAAyBpB,GACxC,OAAIA,EAAIqB,SAAWrB,EAAIsB,QACd,EAEA,IAGV,CACDN,WAAY,EACZC,SAAU,QACVC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,SAAyBpB,GACxC,OAAIA,EAAIuB,SAAWvB,EAAIwB,QACd,EAEA,IAGV,CACDP,SAAU,MACVC,gBAAiB,CAAC,IAAM,KACxBC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,SAAyBpB,GACxC,OAAIA,EAAIyB,OAASzB,EAAI0B,MACZ,EAEA,IAGV,CACDT,SAAU,OACVC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,SAAyBpB,GACxC,OAAIA,EAAI2B,QAAU3B,EAAI4B,OACb,EAEA,SAMjBxG,EAAKE,SAASH,EAAS,kBAAkB1C,OAAO,gBAAiB,CAAC,oBAAqB,YAAa,cAAc,SAAUoJ,EAAmBC,EAAWlB,GACxJ,OAAOiB,EAAkBC,EAAWlB,MAEtCxF,EAAKE,SAASH,KAAY1C,OAAO,CAAC,kBAAkB,SAAUsJ,GAC5D,OAAOA,EAAcjE,UAEvB1C,EAAKE,SAASH,EAAS,cAAc1C,OAAO,YAAa,CAAC,gBAAiB,gBAAiB,oBAAoB,SAAUuJ,EAAeD,EAAeE,GACtJ,OAAOD,EAAcD,EAAeE,MAEtC7G,EAAKE,SAASH,KAAY1C,OAAO,CAAC,cAAc,SAAUyJ,GACxD,OAAOA,EAAUpE,UAEnB1C,EAAKE,SAASH,KAAY1C,OAAO,CAAC,WAAY,YAAa,kBAAmB,eAAe,SAAU0J,EAAUD,EAAWD,EAAiBG,GAC3I,OAAOD,EAASD,EAAWD,EAAiBG,GAAYtE,UAE1D1C,EAAKE,SAASH,EAAS,aAAa1C,OAAO,WAAY,CAAC,wBAAyB,OAAO,SAAU4J,EAAuBvG,GACvH,OAAO,SAAkBoG,EAAWD,GAClC,IAAIG,EAAazH,UAAUC,OAAS,QAAsBvC,IAAjBsC,UAAU,GAAmBA,UAAU,GAAK,GACjF2H,EAAOJ,EAAU/C,UAAU7C,KAAI,SAAU0D,GAE3C,OADAA,EAAuB,kBAAIqC,EAAsBrC,EAAKiC,EAAiBG,GAChEpC,KAELuC,EAAKzG,EAAG+E,KAAKyB,GAIjB,OAHAC,EAAKA,EAAGC,SAAS,CAAC,qBAAsB,CACtCC,MAAO,cAKbrH,EAAKE,SAASH,EAAS,0BAA0B1C,OAAO,wBAAyB,CAAC,kBAAmB,oBAAoB,SAAUiK,EAAiBC,GAClJ,OAAO,SAAU3C,EAAK4C,GACpB,IAAIR,EAAazH,UAAUC,OAAS,QAAsBvC,IAAjBsC,UAAU,GAAmBA,UAAU,GAAK,GACjFoG,EAAqB6B,EAAS7B,mBAC9B8B,EAAgBH,EAAgBE,EAAS9B,uBACzCgC,EAAa/B,EAAmBgC,QAAO,SAAUC,EAAGC,GACtD,IAAIC,EAAiB,MAAQD,EAAGhC,SAC5BkC,EAAQnD,EAAIkD,GAEhB,IAAc,GAAVC,EACF,OAAOH,EAGT,IAAII,EAAIH,EAAoB,gBAAEE,GAC1BE,EAAIJ,EAAoB,gBAAEE,GAE1BG,EAAQtD,EAAIiD,EAAGhC,SAAW,MAAMsC,cAChCC,EAAQxD,EAAIiD,EAAGhC,SAAW,MAAMsC,cAEpC,GAAID,GAASE,GACPP,EAAGhC,YAAYmB,EAAY,CAC7B,IAAIqB,EAAMrB,EAAWa,EAAGhC,UACpByC,EAAMD,EAAIH,IAAU,EACpBK,EAAMF,EAAID,IAAU,EACpBI,EAAQC,KAAKpF,IAAIiF,EAAKC,GAEtBC,EAAQ,IACVP,EAAIO,GAKV,OAAOZ,EAAIa,KAAKC,KAAKV,EAAIC,KACxBR,GACH,OAAOF,EAAgBG,OAG3B1H,EAAKE,SAASH,EAAS,qCAAqC1C,OAAO,mCAAoC,CAAC,kBAAmB,oBAAoB,SAAUiK,EAAiBC,GACxK,OAAO,SAAU3C,EAAK4C,EAAUmB,GACX1L,MAAf0L,IACFA,EAAcnB,EAAS7B,mBAAmBnG,QAG5C,IAAImG,EAAqB6B,EAAS7B,mBAAmBzJ,MAAM,EAAGyM,GAC1DlB,EAAgBH,EAAgBE,EAAS9B,uBACzCvD,EAAI,CACNyG,kBAAmB,GACnBC,cAAe,GACfC,SAAU,GACVC,SAAU,GACVC,UAAW,GACXC,UAAW,GACXC,cAAe,GACfC,mBAAoB,GACpBC,UAAW,GACXC,kBAAmB,KACnBC,IAAK9B,EAAS9B,uBAEhBC,EAAmBjG,SAAQ,SAAUmI,GACnC,IAAIhC,EAAW,MAAQgC,EAAGhC,SACtBkC,EAAQnD,EAAIiB,GACZmC,EAAIH,EAAoB,gBAAEE,GAC1BE,EAAIJ,EAAoB,gBAAEE,GAC1BwB,EAAmB1B,EAAGhC,SAAS2D,QAAQ,IAAK,OAChDrH,EAAqB,kBAAEjD,KAAK6I,GAC5B5F,EAAiB,cAAEjD,KAAK,kBAAkB4B,OAAOyI,EAAkB,MACnEpH,EAAa,UAAEjD,KAAK2G,GACpB1D,EAAY,SAAEjD,KAAK8I,GACnB7F,EAAa,UAAEjD,KAAK,aAAa4B,OAAOyI,EAAkB,MAAMzI,OAAOiH,EAAO,MAC9E5F,EAAY,SAAEjD,KAAK+I,GACnB9F,EAAa,UAAEjD,KAAK,aAAa4B,OAAOyI,EAAkB,MAAMzI,OAAOiH,EAAO,MAC9E5F,EAAiB,cAAEjD,KAAK8I,EAAIC,GAC5B9F,EAAsB,mBAAEjD,KAAKuJ,KAAKC,KAAKV,EAAIC,OAE7C,IAAIP,EAAavF,EAAsB,mBAAEwF,QAAO,SAAUC,EAAG6B,GAC3D,OAAO7B,EAAI6B,IACVhC,GACHtF,EAAqB,kBAAIoF,EAAgBG,GACzC,IAAI4B,EAAM9B,EAAS9B,sBAOnB,OANAvD,EAAyB,sBAAImH,EAAMnH,EAAY,SAAEwF,QAAO,SAAUC,EAAG8B,GACnE,OAAO9B,EAAI8B,IACV,GACHvH,EAA6B,2BAAK,EAAImH,GAAOnH,EAAY,SAAEwF,QAAO,SAAUC,EAAG8B,GAC7E,OAAO9B,EAAI8B,IACV,GACIvH,MAGXnC,EAAKE,SAASH,EAAS,4BAA4B1C,OAAO,0BAA2B,CAAC,qCAAqC,SAAUsM,GACnI,OAAO,SAAU/E,EAAK4C,EAAUmB,GAC9B,IAAIxG,EAAIwH,EAAiC/E,EAAK4C,EAAUmB,GACpDX,EAAI7F,EAAY,SAAEjB,KAAI,SAAUiB,GAClC,OAAOA,EAAEyH,YAAY,MAEnB3B,EAAI9F,EAAY,SAAEjB,KAAI,SAAUiB,GAClC,OAAOA,EAAEyH,YAAY,MAEnBN,EAAMnH,EAAO,IAAEyH,YAAY,GAC3BC,EAAQ,CAACP,GAAKxI,OAAOkH,GACrB8B,EAAQ,CAAC,QAAQhJ,OAAOwI,EAAK,MAAMxI,OAAOmH,GAC1C8B,EAAQF,EAAMG,KAAK,aACnBC,EAAQH,EAAME,KAAK,aACnBE,EAAI/H,EAAqB,kBAAEyH,YAAY,GACvCO,EAAShI,EAAyB,sBAAEyH,YAAY,GAChDQ,EAASjI,EAA6B,0BAAEyH,YAAY,GACxD,MAAO,UAAU9I,OAAOiJ,EAAO,OAAOjJ,OAAOiJ,EAAO,SAASjJ,OAAOmJ,EAAO,iCAAiCnJ,OAAOqJ,EAAQ,MAAMrJ,OAAOqJ,EAAQ,OAAOrJ,OAAOsJ,EAAQ,yBAAyBtJ,OAAOoJ,OAG1MlK,EAAKE,SAASH,EAAS,4BAA4B1C,OAAO,0BAA2B,CAAC,qCAAqC,SAAUsM,GACnI,OAAO,SAAU/E,EAAK4C,GACpB,IAAIrF,EAAIwH,EAAiC/E,EAAK4C,GAC1CQ,EAAI7F,EAAa,UACjB8F,EAAI9F,EAAa,UAEjB0H,GADM1H,EAAO,IACL,CAAC,YAAYrB,OAAOkH,IAC5B8B,EAAQ,CAAC,kBAAkBhJ,OAAOmH,GAClC8B,EAAQF,EAAMG,KAAK,KACnBC,EAAQH,EAAME,KAAK,KACvB,MAAO,UAAUlJ,OAAOiJ,EAAO,MAAMjJ,OAAOiJ,EAAO,QAAQjJ,OAAOmJ,EAAO,SAG7EjK,EAAKE,SAASH,KAAY1C,OAAO,CAAC,MAAO,0BAA2B,YAAa,oBAAoB,SAAUgN,EAAKC,EAAyBxD,EAAWD,GACtJ,OAAOwD,EAAI,IAAqB,GAAmB,OAAuB,CAAC,GAAI,QAASC,EAAwBxD,EAAU/C,UAAU,GAAI8C,OAE1I7G,EAAKE,SAASH,EAAS,8CAA8C1C,OAAO,4CAA6C,CAAC,qCAAqC,SAAUsM,GACvK,OAAO,SAAU/E,EAAK4C,EAAUmB,GAC9B,IAAIxG,EAAIwH,EAAiC/E,EAAK4C,EAAUmB,GACpD4B,EAASpI,EAAiB,cAAE6H,KAAK,MACjCQ,EAAUrI,EAAqB,kBAAE6H,KAAK,MAC1C,MAAO,oBAAoBlJ,OAAOyJ,EAAQ,QAAQzJ,OAAO0J,EAAS,SAGtExK,EAAKE,SAASH,KAAY1C,OAAO,CAAC,MAAO,4CAA6C,YAAa,oBAAoB,SAAUgN,EAAKI,EAA2C3D,EAAWD,GAC1L,OAAOwD,EAAI,IAAqB,GAAmB,OAAuB,CAAC,GAAI,QAASI,EAA0C3D,EAAU/C,UAAU,GAAI8C,OAE5J7G,EAAKE,SAASH,KAAY1C,OAAO,CAAC,QAAQ,SAAUgN,GAClD,OAAOA,EAAI,IAAqB,GAAmB,OAAuB,CAAC,yDAA0D,CAAC,wEAExIrK,EAAKE,SAASH,KAAY1C,OAAO,CAAC,MAAO,0BAA2B,YAAa,oBAAoB,SAAUgN,EAAKK,EAAyB5D,EAAWD,GACtJ,OAAOwD,EAAI,IAAqB,GAAmB,OAAuB,CAAC,GAAI,MAAOK,EAAwB5D,EAAU/C,UAAU,GAAI8C,OAExI7G,EAAKE,SAASH,KAAY1C,OAAO,CAAC,mCAAoC,YAAa,oBAAoB,SAAUsM,EAAkC7C,EAAWD,GAC5J,OAAO8C,EAAiC7C,EAAU/C,UAAU,GAAI8C,MAElE7G,EAAKE,SAASH,EAAS,sBAAsB1C,OAAO,oBAAqB,CAAC,OAAO,SAAUqD,GACzF,OAAO,SAAUiK,EAAmBC,GAClC,IAAIC,EAAOnK,EAAG+E,KAAKkF,GACfG,EAAOpK,EAAG+E,KAAKmF,GACfjE,EAAgBkE,EAAKb,KAAKc,GAAM,SAAUlD,EAAG8B,GAC/C,OAAO,IACN,KAAM,CACPqB,OAAQ,CAAC,KAAM,QAGbC,EAAoBH,EAAKtG,cACzB0G,EAAe,GAMnB,OALAD,EAAkBtL,SAAQ,SAAUyC,GAClC8I,EAAa/L,KAAKiD,EAAI,MACtB8I,EAAa/L,KAAKiD,EAAI,SAExBwE,EAAgBA,EAAcnE,OAAOyI,OAIzCjL,EAAKE,SAASH,EAAS,kBAAkB1C,OAAO,gBAAiB,CAAC,OAAO,SAAUqD,GACjF,OAAO,SAAuBiG,EAAeE,GAC3C,IAAIlB,EAAqBkB,EAAoC,mBASzDC,EAAYH,EAAc5C,UAC9B4B,EAAmBjG,SAAQ,SAAUmI,GACnCf,EAAUpH,SAAQ,SAAUkF,GAC1BA,EAAI,MAAQiD,EAAGhC,UAAYgC,EAAG7B,gBAAgBpB,SAGlDkC,EAAYpG,EAAG+E,KAAKqB,GAEpB,IAAIoE,EAAY,CAAC,QAAS,SAO1B,OANAvF,EAAmBjG,SAAQ,SAAUmI,GACnCqD,EAAUhM,KAAK2I,EAAGhC,SAAW,MAC7BqF,EAAUhM,KAAK2I,EAAGhC,SAAW,MAC7BqF,EAAUhM,KAAK,MAAQ2I,EAAGhC,aAE5BiB,EAAYA,EAAUtE,OAAO0I,OAIjClL,EAAKE,SAASH,EAAS,yBAAyB1C,OAAO,wBAAwB,WAC7E,OAAO,SAA8BqM,GACnC,OAAOA,GAAKA,EAAI,OAGpB1J,EAAKE,SAASH,EAAS,oBAAoB1C,OAAO,kBAAmB,CAAC,yBAAyB,SAAU8N,GACvG,OAAO,SAAyBzB,GAC9B,OAAOyB,EAAqB1C,KAAK2C,IAAI,EAAG1B,QAG5C1J,EAAKE,SAASH,EAAS,yBAAyB1C,OAAO,wBAAwB,WAC7E,OAAO,SAA8B6M,GACnC,OAAOA,GAAK,EAAIA,OAGpBlK,EAAKE,SAASH,EAAS,oBAAoB1C,OAAO,kBAAmB,CAAC,yBAAyB,SAAUgO,GACvG,OAAO,SAAyBnB,GAC9B,OAAOzB,KAAKC,KAAK2C,EAAqBnB,QAG1C,IAAIoB,EAASxL,EAAQG,OAAO,GAiC5B,OAhCAD,EAAKuL,OAAO,KAAMD,GAClBtL,EAAKuL,OAAO,KAAMD,GAClBtL,EAAKE,SAASH,EAAS,sBAAsB1C,OAAO,oBAAqB,CAAC,OAAO,SAAUmO,GACzF,OAAOA,EAAGC,IAAI,gJAAiJD,EAAGE,UAAUC,MAAK,SAAUC,GACzL,IAAIC,EAAS,GAIb,OAHAD,EAASlM,SAAQ,SAAUkF,GACzBiH,EAAOjH,EAAIkH,WAAalH,EAAImH,QAEvBF,QAGX7L,EAAKE,SAASH,EAAS,mBAAmB1C,OAAO,iBAAkB,CAAC,OAAO,SAAUmO,GACnF,OAAOA,EAAGC,IAAI,wIAAyID,EAAGE,UAAUC,MAAK,SAAUC,GACjL,IAAIC,EAAS,GAIb,OAHAD,EAASlM,SAAQ,SAAUkF,GACzBiH,EAAOjH,EAAIoH,SAAWpH,EAAImH,QAErBF,QAGX7L,EAAKE,SAASH,EAAS,eAAe1C,OAAO,aAAc,CAAC,oBAAqB,mBAAmB,SAAU4O,EAAmBC,GAC/H,MAAO,CACL9G,MAAO6G,EACP5G,MAAO6G,MAGXlM,EAAKE,SAASH,KAAY1C,OAAO,CAAC,eAAe,SAAU2J,GACzD,OAAOA,EAAW5B,MAAc,UAElCpF,EAAKE,SAASH,KAAY1C,OAAO,CAAC,eAAe,SAAU2J,GACzD,OAAOA,EAAW3B,MAAe,WAE5BrF,ECnXT,SAAS,EAAQvB,EAAQC,GAAkB,IAAIC,EAAOxC,OAAOwC,KAAKF,GAAS,GAAItC,OAAOyC,sBAAuB,CAAE,IAAIC,EAAU1C,OAAOyC,sBAAsBH,GAAaC,IAAkBG,EAAUA,EAAQC,QAAO,SAAUC,GAAO,OAAO5C,OAAO6C,yBAAyBP,EAAQM,GAAKE,eAAkBN,EAAKO,KAAKC,MAAMR,EAAME,GAAY,OAAOF,EAElV,SAAS,EAAcU,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAAyB,MAAhBF,UAAUD,GAAaC,UAAUD,GAAK,GAAQA,EAAI,EAAK,EAAQnD,OAAOsD,IAAS,GAAMC,SAAQ,SAAUC,IAAO,OAAgBN,EAAQM,EAAKF,EAAOE,OAAsBxD,OAAOyD,0BAA6BzD,OAAOE,iBAAiBgD,EAAQlD,OAAOyD,0BAA0BH,IAAmB,EAAQtD,OAAOsD,IAASC,SAAQ,SAAUC,GAAOxD,OAAO0D,eAAeR,EAAQM,EAAKxD,OAAO6C,yBAAyBS,EAAQE,OAAe,OAAON,EAE9f,SAAS,EAAOS,EAASC,GACtC,IAAIC,EAAOF,EAAQG,SA2jBnB,OA1jBAD,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAG,IAAoB,GAAkB,OAAuB,CAAC,2BAE1EH,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAG,IAAqB,GAAmB,OAAuB,CAAC,mJAAoJ,CAAC,6JAEjOH,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAG,IAAqB,GAAmB,OAAuB,CAAC,oBAE5EH,EAAKE,SAASH,EAAS,oBAAoB1C,OAAO,mBAAmB,WACnE,MAAO,CACLqI,sBAAuB,IACvBC,mBAAoB,CAAC,CACnBC,WAAY,EACZC,SAAU,aACVC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,CAAC,GAAK,KACtB,CACDH,WAAY,EACZC,SAAU,UACVC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,CAAC,GAAK,KACtB,CACDF,SAAU,gBACVC,gBAAiB,CAAC,IAAM,KACxBC,gBAAiB,CAAC,GAAK,UAI7B/F,EAAKE,SAASH,EAAS,QAAQ1C,OAAO,OAAO,WAC3C,IAAI+C,EAEJ,OAAOA,EAAO,CACZ+L,aAAc,OACdC,aAAc,OACd,gBAA2B,EAC3BC,UAAW,QACXC,UAAW,QACX,aAAwB,EACxBC,gBAAiB,eAChB,OAAgBnM,EAAM,kBAAmB,eAAe,OAAgBA,EAAM,mBAA8B,IAAI,OAAgBA,EAAM,QAAS,MAAOA,KAE3JJ,EAAKE,SAASH,EAAS,cAAc1C,OAAO,aAAa,WACvD,MAAO,CACLsF,OAAQ,QAGZ3C,EAAKE,SAASH,KAAY1C,OAAO,CAAC,sBAAuB,MAAO,kBAAmB,cAAc,SAAUmP,EAAqB5H,EAAKiC,EAAiB4F,GACpJ,OAAOD,EAAoB5H,EAAKiC,EAAiB4F,GAAW,MAE9DzM,EAAKE,SAASH,KAAY1C,OAAO,CAAC,sBAAuB,MAAO,kBAAmB,cAAc,SAAUmP,EAAqB5H,EAAKiC,EAAiB4F,GACpJ,OAAOD,EAAoB5H,EAAKiC,EAAiB4F,GAAW,MAE9DzM,EAAKE,SAASH,KAAY1C,OAAO,CAAC,OAAO,SAAU8C,GACjD,OAAOA,EAAG,IAAqB,GAAmB,OAAuB,CAAC,iBAE5EH,EAAKE,SAASH,EAAS,wBAAwB1C,OAAO,sBAAuB,CAAC,2BAA4B,QAAS,mBAAmB,SAAUqP,EAA0BC,EAAOC,GAC/K,OAAO,SAAUhI,EAAKiC,EAAiBgG,EAAiBC,GACtD,IAAI9F,EAAazH,UAAUC,OAAS,QAAsBvC,IAAjBsC,UAAU,GAAmBA,UAAU,GAAK,GACjFwN,EAAOL,EAAyB9H,EAAKiC,EAAiBG,GAC1D,OAAO2F,EAAMC,EAAeG,EAAMF,EAAiBC,QAGvD9M,EAAKE,SAASH,EAAS,iCAAiC1C,OAAO,gCAAgC,WAC7F,OAAO,SAAsCwJ,GAC3C,IAAIgF,EAAS,GAKb,OAJAhF,EAAgBlB,mBAAmBjG,SAAQ,SAAUyC,GACnD,IAAI0D,EAAW1D,EAAY,SAC3B0J,EAAOhG,GAAY1D,KAEd0J,MAGX7L,EAAKE,SAASH,EAAS,6BAA6B1C,OAAO,2BAA4B,CAAC,gCAAiC,gCAAiC,iCAAiC,SAAU2P,EAA+BC,EAA+BC,GACjQ,OAAO,SAAkCtI,EAAKiC,GAC5C,IAAIG,EAAazH,UAAUC,OAAS,QAAsBvC,IAAjBsC,UAAU,GAAmBA,UAAU,GAAK,GACjF4N,EAAaH,EAA8BnG,GAC3CuG,EAA4BH,EAA8BrI,EAAKiC,EAAiBG,GAChFqG,EAAoB,CAACF,GAAYrM,OAAOsM,GACxCE,EAAYJ,EAA6BrG,GACzC0G,EAA+BF,EAAkB1F,QAAO,SAAUC,EAAG8B,GACvE,OAAO9B,EAAI8B,EAAqB,oBAC/B,GAGH,OAFA4D,EAAwB,aAAI7E,KAAK2C,IAAI,EAAGmC,GACxCD,EAA6B,kBAAIC,EAC1BF,EAAkBvM,OAAO,CAACwM,QAGrCtN,EAAKE,SAASH,EAAS,4BAA4B1C,OAAO,0BAA2B,CAAC,+BAAgC,SAAS,SAAUmQ,EAA8B9E,GACrK,OAAO,SAAiC+E,EAAW7I,EAAKiC,EAAiBG,GACvE,IAOI0G,EAAeC,EAPfhO,EAAM8N,EACNG,EAAchJ,EAAIjF,GAClBkG,EAAWlG,EAAI6J,QAAQ,MAAO,IAE9BqE,EADYL,EAA6B3G,GACrBhB,GACpBiI,EAAUlJ,EAAIiB,EAAW,MACzBkI,EAAUnJ,EAAIiB,EAAW,OAGT,GAAhB+H,GACFF,EAAgB,GAChBC,EAAgB,KAEhBD,EAAgBG,EAAyB,gBAAED,GAC3CD,EAAgBE,EAAyB,gBAAED,GAEvCE,GAAWC,GACTlI,KAAYmB,IAEd0G,EADU1G,EAAWnB,GACDiI,IAAYJ,IAKtC,IAAIM,EAAeL,EAAgBD,EACnC,MAAO,CACLM,aAAcA,EACdC,YAAapI,EACbqI,kBAAmB,MAAQrI,EAC3BsI,YAAaP,EACbQ,WAAY,SAAWR,EACvBS,kBAAmB3F,EAAKsF,GACxBL,cAAeA,EACf/H,WAAY,KACZ8H,cAAeA,EACfI,QAASA,EACTC,QAASA,OAIf/N,EAAKE,SAASH,EAAS,kCAAkC1C,OAAO,gCAAiC,CAAC,uBAAwB,8BAA8B,SAAUgO,EAAsBiD,GACtL,OAAO,SAAUzH,GAcf,MAbU,CACRmH,aAAc3C,EAAqBxE,EAAgBnB,uBACnDuI,YAAa,QACbC,kBAAmB,GACnBC,YAAa,GACbC,WAAY,KACZC,kBAAmBC,EAA0BzH,EAAgBnB,uBAC7DiI,cAAe,KACf/H,WAAY,KACZ8H,cAAe,KACfI,QAAS,GACTC,QAAS,QAKf/N,EAAKE,SAASH,EAAS,kCAAkC1C,OAAO,gCAAiC,CAAC,4BAA4B,SAAUkR,GACtI,OAAO,SAAU3J,EAAKiC,EAAiBG,GACrC,IAAIrI,EAAOxC,OAAOwC,KAAKiG,GAIvB,OAHAjG,EAAOA,EAAKG,QAAO,SAAUa,GAC3B,OAAOA,EAAI6O,SAAS,WAEVtN,KAAI,SAAUuM,GACxB,OAAOc,EAAwBd,EAAW7I,EAAKiC,EAAiBG,UAItEhH,EAAKE,SAASH,EAAS,iCAAiC1C,OAAO,gCAAgC,WAC7F,OAAO,SAAUwJ,GAcf,MAbU,CACRmH,aAAc,KACdC,YAAa,cACbC,kBAAmB,GACnBC,YAAa,GACbC,WAAY,KACZC,kBAAmB,KACnBV,cAAe,KACf/H,WAAY,KACZ8H,cAAe,KACfI,QAAS,GACTC,QAAS,QAKf/N,EAAKE,SAASH,EAAS,mBAAmB1C,OAAO,iBAAkB,CAAC,cAAc,SAAUoR,GAC1F,OAAO,SAAU1B,EAAMN,GACrB,IAAIK,EAAavN,UAAUC,OAAS,QAAsBvC,IAAjBsC,UAAU,IAAmBA,UAAU,GAC5EmP,EAAcC,KAAKC,MAAMD,KAAKE,UAAUJ,IAE5CC,EAAY3B,KAAK+B,OAAS/B,EAE1B,IAAIgC,EAAO,EAAc,EAAc,GAAIL,GAAcjC,GAEzD,GAAIK,EAAY,CAEdiC,EAAY,MAAE,GAAa,SAAK,EAAQ,MAAI,EAG5CA,EAAY,MAAE,GAAU,MAAE,GAAa,SAAQ,KAAI,CACjDC,KAAM,UACNC,MAAO,iBAETF,EAAY,MAAE,GAAU,MAAE,GAAa,SAAW,QAAI,CACpDG,UAAW,CACT5S,MAAO,EACP6S,KAAM,uEAIV,IAAIC,EAAO,kDACXL,EAAY,MAAE,GAAU,MAAE,GAAa,SAAK,EAAQ,KAAa,UAAIK,EACrEL,EAAY,MAAE,GAAU,MAAE,GAAa,SAAK,EAAQ,KAAS,MAAI,cAEjEA,EAAY,MAAE,GAAU,MAAE,GAAa,SAAW,QAAI,CAAC,CACrDC,KAAM,eACNC,MAAO,OACPI,OAAQ,MACR7R,MAAO,iCAIX,OAAOuR,MAGX/O,EAAKE,SAASH,EAAS,cAAc1C,OAAO,aAAa,WACvD,MAAO,CACLiS,OAAQ,CACN5M,KAAM,CACJ6M,iBAAkB,IAClBC,gBAAiB,MAGrBhS,MAAO,CACLiS,KAAM,+BACNC,SAAU,mEAEZC,UAAW,CAAC,CACV7Q,OAAQ,gCACP,CACD8Q,OAAQ,CAAC,CACP9N,GAAI,MACJmN,MAAO,oBACPhM,GAAI,OACH,CACDnB,GAAI,OACJmN,MAAO,cACPhM,GAAI,SAEN4M,MAAO,CAAC,KAAM,IACb,CACDC,UAAW,wFACX7M,GAAI,OACH,CACD6M,UAAW,uDACX7M,GAAI,QACH,CACD6M,UAAW,wHACX7M,GAAI,gBACH,CACD6M,UAAW,0DACX7M,GAAI,aACH,CACD6M,UAAW,0DACX7M,GAAI,gBACH,CACD6M,UAAW,kEACX7M,GAAI,WACH,CACD6M,UAAW,kEACX7M,GAAI,cACH,CACD6M,UAAW,uCACX7M,GAAI,UACH,CACD6M,UAAW,qEACX7M,GAAI,0BACH,CACD6M,UAAW,0CACX7M,GAAI,MACH,CACD6M,UAAW,oDACX7M,GAAI,YACH,CACD6M,UAAW,mCACX7M,GAAI,QACH,CACD6M,UAAW,cACX7M,GAAI,QACH,CACD6M,UAAW,6CACX7M,GAAI,kBAEN8M,MAAO,CAAC,CACNA,MAAO,CAAC,CACNC,KAAM,OACNC,SAAU,CACRC,EAAG,CACDjB,MAAO,OACPD,KAAM,gBAER/J,KAAM,CACJ3I,MAAO,IAETgI,MAAO,CACLhI,MAAO,WAGV,CACD0T,KAAM,CACJhB,KAAM,MACNmB,MAAO,IAETF,SAAU,CACR3L,MAAO,CACL4K,UAAW,CACT5S,MAAO,MACP6S,KAAM,iCAER7S,MAAO,SAET8T,QAAS,CACPlB,UAAW,CACT5S,MAAO,EACP6S,KAAM,sEAER7S,MAAO,IAET+T,QAAS,CAAC,CACRrB,KAAM,UACNC,MAAO,cACPzR,MAAO,qBACN,CACDwR,KAAM,UACNC,MAAO,UACPzR,MAAO,aACN,CACDwR,KAAM,UACNC,MAAO,UACPzR,MAAO,aACN,CACDwR,KAAM,UACNC,MAAO,cACPzR,MAAO,eACN,CACDwR,KAAM,eACNC,MAAO,eACPI,OAAQ,MACR7R,MAAO,gBACN,CACDwR,KAAM,eACNC,MAAO,oBACPI,OAAQ,MACR7R,MAAO,sBACN,CACDwR,KAAM,eACNC,MAAO,OACPI,OAAQ,MACR7R,MAAO,iCAET8S,EAAG,CACDtB,KAAM,UACNuB,KAAM,CACJC,UAAW,4EACXC,WAAY,SACZC,aAAc,GACdlT,MAAO,SACPmT,MAAM,EACNC,SAAU,UAEZ3B,MAAO,cACP4B,KAAM,MAERX,EAAG,CACDlB,KAAM,eACNuB,KAAM,CACJI,MAAM,EACNG,OAAQ,OACRtT,MAAO,sBAETyR,MAAO,gBAET8B,GAAI,CACF9B,MAAO,SAGV,CACDe,KAAM,CACJhB,KAAM,OACNgC,WAAY,QAEdf,SAAU,CACR3L,MAAO,CACLhI,MAAO,SAETmT,KAAM,CACJP,UAAW,CACTF,KAAM,UACNC,MAAO,oBACPI,OAAQ,MACRF,KAAM,oCAER7S,MAAO,IAETgU,EAAG,CACDtB,KAAM,UACNuB,KAAM,CACJU,WAAY,EACZzT,MAAO,UAETyR,MAAO,cACP4B,KAAM,MAERX,EAAG,CACDlB,KAAM,eACNuB,KAAM,CACJO,OAAQ,QAEV7B,MAAO,YAGV,CACDe,KAAM,CACJhB,KAAM,OACNkC,SAAU,SACVC,IAAK,EACLH,WAAY,QAEdf,SAAU,CACR3L,MAAO,CACLhI,MAAO,SAETmT,KAAM,CACJP,UAAW,CACTF,KAAM,UACNC,MAAO,YACPE,KAAM,oCAER7S,MAAO,IAETgU,EAAG,CACDtB,KAAM,UACNuB,KAAM,CACJU,WAAY,EACZzT,MAAO,UAETyR,MAAO,cACP4B,KAAM,MAERX,EAAG,CACDlB,KAAM,eACNC,MAAO,aAGV,CACDe,KAAM,CACJhB,KAAM,OACNkC,SAAU,MACVC,GAAI,EACJH,WAAY,QAEdf,SAAU,CACR3L,MAAO,CACLhI,MAAO,SAETmT,KAAM,CACJP,UAAW,CACTF,KAAM,UACNC,MAAO,eACPE,KAAM,oCAER7S,MAAO,IAETgU,EAAG,CACDtB,KAAM,UACNuB,KAAM,CACJU,WAAY,EACZzT,MAAO,UAETyR,MAAO,cACP4B,KAAM,MAERX,EAAG,CACDlB,KAAM,eACNC,MAAO,kBAIZ,CACDe,KAAM,CACJhB,KAAM,OACN1K,MAAO,QACP8M,YAAa,EACbC,SAAU,GACVC,SAAU,IAEZrB,SAAU,CACRK,EAAG,CACDtB,KAAM,UACNuB,KAAM,CACJU,WAAY,EACZzT,MAAO,UAETyR,MAAO,cACP4B,KAAM,MAERU,GAAI,CACFtC,MAAO,QAETiB,EAAG,CACDlB,KAAM,eACNuB,KAAM,CACJC,UAAW,kDACXM,OAAQ,QACRtT,MAAO,eAETyR,MAAO,MACPuC,MAAO,CACLC,MAAM,OAKd9O,OAAQ,IACR+O,QAAS,CACPnB,KAAM,CACJL,EAAG,gBAGPC,MAAO,CACLwB,KAAM,IAERC,QAAS,sDACT7E,KAAM,CACJ+B,OAAQ,UAId9O,EAAKE,SAASH,EAAS,UAAU1C,OAAO,QAAS,CAAC,YAAY,SAAUiD,GACtE,OAAOA,EAAQ,mBAEjBN,EAAKE,SAASH,EAAS,yBAAyB1C,OAAO,wBAAwB,WAC7E,OAAO,SAA8BqM,GACnC,OAAOA,GAAKA,EAAI,OAGpB1J,EAAKE,SAASH,EAAS,SAAS1C,OAAO,QAAQ,WAC7C,OAAOoL,KAAKC,QAEd1I,EAAKE,SAASH,EAAS,yBAAyB1C,OAAO,wBAAwB,WAC7E,OAAO,SAA8B6M,GACnC,OAAOA,GAAK,EAAIA,OAGpBlK,EAAKE,SAASH,EAAS,8BAA8B1C,OAAO,4BAA6B,CAAC,OAAQ,yBAAyB,SAAUqL,EAAM2C,GACzI,OAAO,SAAmCnB,GACxC,OAAOxB,EAAK2C,EAAqBnB,QAGrClK,EAAKE,SAASH,EAAS,8BAA8B1C,OAAO,4BAA6B,CAAC,yBAAyB,SAAU8N,GAC3H,OAAO,SAAmC0G,GACxC,OAAO1G,EAAqB1C,KAAK2C,IAAI,EAAGyG,QAG5C7R,EAAKE,SAASH,EAAS,sBAAsB1C,OAAO,oBAAqB,CAAC,OAAO,SAAUmO,GACzF,OAAOA,EAAGC,IAAI,gJAAiJD,EAAGE,UAAUC,MAAK,SAAUC,GACzL,IAAIC,EAAS,GAIb,OAHAD,EAASlM,SAAQ,SAAUkF,GACzBiH,EAAOjH,EAAIkH,WAAalH,EAAImH,QAEvBF,QAGX7L,EAAKE,SAASH,EAAS,eAAe1C,OAAO,aAAc,CAAC,sBAAsB,SAAU4O,GAC1F,MAAO,CACL6F,WAAY7F,MAGTjM,ECjkBT,SAAS+R,EAA2BC,EAAGC,GAAkB,IAAIC,EAAuB,oBAAXC,QAA0BH,EAAEG,OAAOC,WAAaJ,EAAE,cAAe,IAAKE,EAAI,CAAE,GAAIG,MAAMC,QAAQN,KAAOE,EAE9K,SAAqCF,EAAGO,GAAU,IAAKP,EAAG,OAAQ,GAAiB,iBAANA,EAAgB,OAAOQ,EAAkBR,EAAGO,GAAS,IAAIE,EAAItW,OAAOuW,UAAUC,SAASC,KAAKZ,GAAG9V,MAAM,GAAI,GAAc,WAANuW,GAAkBT,EAAEa,cAAaJ,EAAIT,EAAEa,YAAYrO,MAAM,GAAU,QAANiO,GAAqB,QAANA,EAAa,OAAOJ,MAAM5M,KAAKuM,GAAI,GAAU,cAANS,GAAqB,2CAA2CtD,KAAKsD,GAAI,OAAOD,EAAkBR,EAAGO,GAFnOO,CAA4Bd,KAAOC,GAAkBD,GAAyB,iBAAbA,EAAExS,OAAqB,CAAM0S,IAAIF,EAAIE,GAAI,IAAI5S,EAAI,EAAOyT,EAAI,aAAiB,MAAO,CAAEnP,EAAGmP,EAAGN,EAAG,WAAe,OAAInT,GAAK0S,EAAExS,OAAe,CAAEwT,MAAM,GAAe,CAAEA,MAAM,EAAO1W,MAAO0V,EAAE1S,OAAW2T,EAAG,SAAWC,GAAM,MAAMA,GAAOC,EAAGJ,GAAO,MAAM,IAAIK,UAAU,yIAA4I,IAA6CC,EAAzCC,GAAmB,EAAMC,GAAS,EAAY,MAAO,CAAE3P,EAAG,WAAesO,EAAKA,EAAGU,KAAKZ,IAAOS,EAAG,WAAe,IAAId,EAAOO,EAAGrR,OAAsC,OAA9ByS,EAAmB3B,EAAKqB,KAAarB,GAASsB,EAAG,SAAWO,GAAOD,GAAS,EAAMF,EAAMG,GAAQL,EAAG,WAAe,IAAWG,GAAiC,MAAbpB,EAAGuB,QAAgBvB,EAAGuB,SAAY,QAAU,GAAIF,EAAQ,MAAMF,KAIz9B,SAASb,EAAkBkB,EAAKC,IAAkB,MAAPA,GAAeA,EAAMD,EAAIlU,UAAQmU,EAAMD,EAAIlU,QAAQ,IAAK,IAAIF,EAAI,EAAGsU,EAAO,IAAIvB,MAAMsB,GAAMrU,EAAIqU,EAAKrU,IAAOsU,EAAKtU,GAAKoU,EAAIpU,GAAM,OAAOsU,EAKjK,SAAS,EAAO9T,EAASC,GACtC,IAAIC,EAAOF,EAAQG,SACnBD,EAAKE,SAASH,EAAS,UAAU1C,OAAO,QAAS,CAAC,OAAO,SAAU8C,GACjE,OAAOA,EAAG,IAAoB,GAAkB,OAAuB,CAAC,0DAE1EH,EAAKE,SAASH,EAAS,WAAW1C,OAAO,SAAU,CAAC,OAAO,SAAU8C,GACnE,OAAOA,EAAG,IAAqB,GAAmB,OAAuB,CAAC,4OAE5EH,EAAKE,SAASH,EAAS,UAAU1C,OAAO,QAAS,CAAC,SAAS,SAAU2G,GACnE,OAAOA,EAAK,IAAqB,GAAmB,OAAuB,CAAC,+YAE9EhE,EAAKE,SAASH,EAAS,0BAA0B1C,OAAO,wBAAyB,CAAC,OAAQ,eAAe,SAAU2G,EAAM6P,GACvH,OAAO7P,EAAK,IAAqB,GAAmB,OAAuB,CAAC,0HAA+H,YAAa6P,MAE1N7T,EAAKE,SAASH,EAAS,WAAW1C,OAAO,SAAU,CAAC,OAAO,SAAU8C,GACnE,OAAOA,EAAG,IAAqB,GAAmB,OAAuB,CAAC,oEAE5EH,EAAKE,SAASH,EAAS,wBAAwB1C,OAAO,sBAAuB,CAAC,WAAW,SAAUyW,GACjG,OAAOA,EAAOC,OAAO,CACnBC,MAAO,uCAGXhU,EAAKE,SAASH,EAAS,iBAAiB1C,OAAO,eAAgB,CAAC,aAAc,wBAAwB,SAAU4W,EAAGC,GACjH,OAAOD,EAAEE,MAAMD,MAEjBlU,EAAKE,SAASH,EAAS,oBAAoB1C,OAAO,kBAAmB,CAAC,sBAAuB,YAAa,kBAAmB,YAAa,eAAgB,eAAe,SAAUmP,EAAqB1F,EAAWD,EAAiB4F,EAAW2H,EAAcpN,GAC3P,OAAOwF,EAAoB1F,EAAU/C,UAAU,GAAI8C,EAAiB4F,GAAY2H,EAAcpN,MAEhGhH,EAAKE,SAASH,EAAS,UAAU1C,OAAO,QAAS,CAAC,OAAO,SAAU8C,GACjE,OAAOA,EAAG,IAAqB,GAAmB,OAAuB,CAAC,2NAE5EH,EAAKE,SAASH,EAAS,eAAe1C,OAAO,aAAc,CAAC,wBAAyB,YAAa,kBAAmB,eAAe,SAAU4J,EAAuBH,EAAWD,EAAiBG,GAE/L,OAAe,IADJC,EAAsBH,EAAU/C,UAAU,GAAI8C,EAAiBG,IACtD4C,YAAY,MAElC5J,EAAKE,SAASH,EAAS,cAAc1C,OAAO,YAAa,CAAC,aAAc,iBAAkB,UAAU,SAAUgX,EAAYC,EAAgBvS,GACxI,OAAOsS,EAAWE,SAAQ,SAAUC,GAClC,IAAIC,EAAW,SAAkBC,GAC/B,OAAOF,EAAOF,EAAevS,KAK/B,OAFAA,EAAM4S,iBAAiB,QAASF,GAAU,GAC1CD,EAAOF,EAAevS,IACf,WACL,OAAO6N,OAAOgF,oBAAoB,QAASH,UAIjDzU,EAAKE,SAASH,EAAS,mBAAmB1C,OAAO,kBAAkB,WACjE,OAAO,SAAwB0E,GAC7B,IAAIgL,EAAO,GA2CX,OA1CAhL,EAAM8S,iBAAiB,MAAMnV,SAAQ,SAAUkF,EAAKtF,GAClD,IAIIwV,EAHAC,EAAW,GAEXC,EAAYjD,EAHJnN,EAAIqQ,OAMhB,IACE,IAAKD,EAAUpR,MAAOkR,EAAQE,EAAUvC,KAAKO,MAAO,CAClD,IACI1W,EADOwY,EAAMxY,MACA4Y,UAIJ,KAFb5Y,GADAA,EAAQA,EAAM6Y,QACAhN,iBAGZ7L,EAAQ,MAGVyY,EAAS7V,KAAK5C,IAEhB,MAAO+W,GACP2B,EAAU/B,EAAEI,GACZ,QACA2B,EAAU7B,IAGZpG,EAAK7N,KAAK6V,MAEQhI,EAAKpF,QAAO,SAAUyN,EAAaxQ,EAAKtF,GAC1D,GAAS,GAALA,EACF8V,EAAYC,WAAazQ,MACpB,CACL,IAAI0Q,EAAY,GAChBA,EAAe,IAAIhW,EACnB8V,EAAYC,WAAW3V,SAAQ,SAAUC,EAAKL,GAC5CgW,EAAU3V,GAAOiF,EAAItF,MAEvB8V,EAAYlW,KAAKoW,GAGnB,OAAOF,IACN,QAIP,IAAI9J,EAASxL,EAAQG,OAAO,GAC5BD,EAAKuL,OAAO,gBAAiBD,GAC7BtL,EAAKuL,OAAO,WAAYD,GACxBtL,EAAKuL,OAAO,oBAAqBD,GACjCtL,EAAKuL,OAAO,wBAAyBD,GACrCtL,EAAKE,SAASH,EAAS,SAAS1C,OAAO,OAAQ,CAAC,WAAY,YAAa,oBAAoB,SAAU0J,EAAUD,EAAWD,GAC1H,OAAOE,EAASD,EAAWD,MAE7B7G,EAAKE,SAASH,EAAS,cAAc1C,OAAO,YAAa,CAAC,gBAAiB,gBAAiB,oBAAoB,SAAUuJ,EAAeD,EAAeE,GACtJ,OAAOD,EAAcD,EAAeE,MAEtC7G,EAAKE,SAASH,EAAS,kBAAkB1C,OAAO,gBAAiB,CAAC,oBAAqB,YAAa,cAAc,SAAUoJ,EAAmBC,EAAWlB,GACxJ,OAAOiB,EAAkBC,EAAWlB,MAEtCxF,EAAKE,SAASH,EAAS,cAAc1C,OAAO,YAAa,CAAC,mBAAoB,cAAc,SAAUkY,EAAkBC,GACtH,MAAO,CAACD,EAAiBC,EAAU,QAErCxV,EAAKE,SAASH,EAAS,cAAc1C,OAAO,YAAa,CAAC,mBAAoB,cAAc,SAAUkY,EAAkBC,GACtH,MAAO,CAACD,EAAiBC,EAAU,QAErCxV,EAAKE,SAASH,EAAS,qBAAqB1C,OAAO,oBAAoB,WACrE,OAAO,SAA0B8E,GAC/B,MAAO,CACLgD,IAAKhD,EAAO,IACZiD,MAAOjD,EAAE,cACTsT,MAAOtT,EAAE,eACTkD,MAAOlD,EAAW,QAClBmD,IAAKnD,EAAO,IACZuT,GAAIvT,EAAY,cAItBnC,EAAKE,SAASH,EAAS,oBAAoB1C,OAAO,kBAAmB,CAAC,eAAgB,aAAa,SAAUsY,EAAcC,GACzH,OAAO,SAAUhR,GACf,OAAoB,OAAhBA,EAAIqB,SAAoC,OAAhBrB,EAAIsB,SACtB,EAGNtB,EAAIqB,SAAWrB,EAAIsB,QACd,EAGLyP,EAAa/Q,EAAIqB,QAASrB,EAAIsB,SACzB,EAGL0P,EAAShR,EAAIqB,QAASrB,EAAIsB,SAAW,IAChC,EAEA,MAIblG,EAAKE,SAASH,EAAS,oBAAoB1C,OAAO,kBAAmB,CAAC,eAAgB,aAAa,SAAUsY,EAAcC,GACzH,OAAO,SAAUhR,GACf,OAAoB,OAAhBA,EAAIiR,SAAoC,OAAhBjR,EAAIkR,SACtB,EAGNlR,EAAIiR,SAAWjR,EAAIkR,QACd,EAGLH,EAAa/Q,EAAIiR,QAASjR,EAAIkR,SACzB,EAGLF,EAAShR,EAAIiR,QAASjR,EAAIkR,SAAW,IAChC,EAEA,MAIb9V,EAAKE,SAASH,EAAS,oBAAoB1C,OAAO,kBAAmB,CAAC,eAAgB,aAAa,SAAUsY,EAAcC,GACzH,OAAO,SAAUhR,GACf,OAAoB,OAAhBA,EAAIuB,SAAoC,OAAhBvB,EAAIwB,SACtB,EAGNxB,EAAIuB,SAAWvB,EAAIwB,QACd,EAGLuP,EAAa/Q,EAAIuB,QAASvB,EAAIwB,SACzB,EAGLwP,EAAShR,EAAIuB,QAASvB,EAAIwB,SAAW,IAChC,EAEA,MAIbpG,EAAKE,SAASH,EAAS,2BAA2B1C,OAAO,0BAA0B,WACjF,OAAO,SAAU0Y,EAAQC,GACvB,IAAIC,EAAM,IAAIC,KAAKH,GACfI,EAAM,IAAID,KAAKF,GAEnB,OAAOvN,KAAK2N,IAAIH,EAAME,GADR,YAIlBnW,EAAKE,SAASH,EAAS,kBAAkB1C,OAAO,gBAAiB,CAAC,cAAe,2BAA2B,SAAUgZ,EAAaC,GACjI,OAAO,SAAU1R,GACf,OAAkB,OAAdA,EAAIyB,OAAgC,OAAdzB,EAAI0B,OACpB,EAGN1B,EAAIyB,OAASzB,EAAI0B,OAAgC,SAAvB1B,EAAIyB,MAAMnK,OAAO,GACtC,EAGL0I,EAAIyB,OAASzB,EAAI0B,MACZ,EAGL+P,EAAYzR,EAAIyB,MAAOzB,EAAI0B,QAAU,EAChC,EAGLgQ,EAAuB1R,EAAIyB,MAAOzB,EAAI0B,OAAS,EAC1C,EAGLgQ,EAAuB1R,EAAIyB,MAAOzB,EAAI0B,OAAS,GAC1C,EAEA,MAIbtG,EAAKE,SAASH,EAAS,iBAAiB1C,OAAO,gBAAgB,WAC7D,OAAO,SAAUuH,GACf,OAAiB,OAAbA,EAAI2R,MAA8B,OAAb3R,EAAI4R,MACnB,EAGN5R,EAAI2R,MAAQ3R,EAAI4R,KACX,EAGL5R,EAAI2R,KAAKra,MAAM,EAAG,IAAM0I,EAAI4R,KAAKta,MAAM,EAAG,GACrC,EAEA,MAIb8D,EAAKE,SAASH,EAAS,oBAAoB1C,OAAO,kBAAmB,CAAC,kBAAmB,kBAAmB,kBAAmB,gBAAiB,iBAAiB,SAAUoZ,EAAiBC,EAAiBC,EAAiBC,EAAeC,GAC3O,MAAO,CACLnR,sBAAuB,EAAI,IAC3BC,mBAAoB,CAAC,CACnBC,WAAY,EACZC,SAAU,QACVC,gBAAiB,CAAC,kBAAoB,oBAAsB,oBAAsB,qBAClFC,gBAAiB,CAAC,oBAAsB,mBAAqB,qBAAuB,mBACpFC,gBAAiByQ,GAChB,CACD7Q,WAAY,EACZC,SAAU,QACVC,gBAAiB,CAAC,kBAAoB,oBAAsB,oBAAsB,qBAClFC,gBAAiB,CAAC,oBAAsB,mBAAqB,qBAAuB,mBACpFC,gBAAiB0Q,GAChB,CACD9Q,WAAY,EACZC,SAAU,QACVC,gBAAiB,CAAC,kBAAoB,qBAAuB,qBAAuB,sBACpFC,gBAAiB,CAAC,mBAAqB,mBAAqB,qBAAuB,mBACnFC,gBAAiB2Q,GAChB,CACD9Q,SAAU,MACVC,gBAAiB,CAAC,kBAAoB,mBAAqB,kBAAoB,qBAAuB,qBAAsB,sBAC5HC,gBAAiB,CAAC,sBAAwB,qBAAuB,oBAAsB,oBAAsB,qBAAuB,mBACpIC,gBAAiB4Q,GAChB,CACD/Q,SAAU,KACVC,gBAAiB,CAAC,kBAAoB,mBAAqB,mBAAqB,sBAAuB,qBAAuB,sBAC9HC,gBAAiB,CAAC,mBAAqB,mBAAqB,kBAAoB,mBAAqB,mBAAqB,oBAC1HC,gBAAiB6Q,QAIvB7W,EAAKE,SAASH,EAAS,cAAc1C,OAAO,aAAa,WACvD,MAAO,CACLG,MAAO,CACLiS,KAAM,uEACNC,SAAU,IAEZ/M,OAAQ,QAGZ,IAAImU,EAAShX,EAAQG,OAAO,GAmF5B,OAlFAD,EAAKuL,OAAO,sBAAuBuL,GACnC9W,EAAKE,SAASH,EAAS,OAAO1C,OAAO,KAAM,CAAC,YAAY,SAAUiD,GAChE,OAAOA,EAAQ,gDAEjBN,EAAKE,SAASH,EAAS,aAAa1C,OAAO,WAAY,CAAC,YAAY,SAAUiD,GAC5E,OAAOA,EAAQ,kCAEjBN,EAAKE,SAASH,EAAS,iBAAiB1C,OAAO,eAAgB,CAAC,OAAO,SAAU0Z,GAC/E,OAAO,SAAsBC,EAAOC,GAClC,IAAIC,EAAQH,EAAGI,gBAAgBH,GAC3BI,EAAQL,EAAGI,gBAAgBF,GAC/B,OAAOC,EAAMpY,QAAO,SAAUxC,GAC5B,OAAO8a,EAAM5I,SAASlS,MACrBkD,OAAS,MAGhBQ,EAAKE,SAASH,EAAS,sBAAsB1C,OAAO,oBAAqB,CAAC,OAAO,SAAUmO,GACzF,OAAOA,EAAGC,IAAI,gJAAiJD,EAAGE,UAAUC,MAAK,SAAUC,GACzL,IAAIC,EAAS,GAIb,OAHAD,EAASlM,SAAQ,SAAUkF,GACzBiH,EAAOjH,EAAIkH,WAAalH,EAAImH,QAEvBF,QAGX7L,EAAKE,SAASH,EAAS,mBAAmB1C,OAAO,iBAAkB,CAAC,OAAO,SAAUmO,GACnF,OAAOA,EAAGC,IAAI,wIAAyID,EAAGE,UAAUC,MAAK,SAAUC,GACjL,IAAIC,EAAS,GAIb,OAHAD,EAASlM,SAAQ,SAAUkF,GACzBiH,EAAOjH,EAAIoH,SAAWpH,EAAImH,QAErBF,QAGX7L,EAAKE,SAASH,EAAS,eAAe1C,OAAO,aAAc,CAAC,oBAAqB,mBAAmB,SAAU4O,EAAmBC,GAC/H,MAAO,CACL9G,MAAO6G,EACPwJ,MAAOxJ,EACP5G,MAAO6G,MAGXlM,EAAKE,SAASH,EAAS,gBAAgB1C,OAAO,eAAe,WAC3D,OAAO,SAAUuK,EAAG8B,GAClB,GAAgB,GAAZ9B,EAAEpI,OAAa,OAAOkK,EAAElK,OAC5B,GAAgB,GAAZkK,EAAElK,OAAa,OAAOoI,EAAEpI,OAC5B,IAEIF,EAOA+X,EATAC,EAAS,GAIb,IAAKhY,EAAI,EAAGA,GAAKoK,EAAElK,OAAQF,IACzBgY,EAAOhY,GAAK,CAACA,GAMf,IAAK+X,EAAI,EAAGA,GAAKzP,EAAEpI,OAAQ6X,IACzBC,EAAO,GAAGD,GAAKA,EAIjB,IAAK/X,EAAI,EAAGA,GAAKoK,EAAElK,OAAQF,IACzB,IAAK+X,EAAI,EAAGA,GAAKzP,EAAEpI,OAAQ6X,IACrB3N,EAAE6N,OAAOjY,EAAI,IAAMsI,EAAE2P,OAAOF,EAAI,GAClCC,EAAOhY,GAAG+X,GAAKC,EAAOhY,EAAI,GAAG+X,EAAI,GAEjCC,EAAOhY,GAAG+X,GAAK5O,KAAKtF,IAAImU,EAAOhY,EAAI,GAAG+X,EAAI,GAAK,EAC/C5O,KAAKtF,IAAImU,EAAOhY,GAAG+X,EAAI,GAAK,EAC5BC,EAAOhY,EAAI,GAAG+X,GAAK,IAKzB,OAAOC,EAAO5N,EAAElK,QAAQoI,EAAEpI,YAG9BQ,EAAKE,SAASH,EAAS,OAAO1C,OAAO,KAAM,CAAC,YAAY,SAAUiD,GAChE,OAAOA,EAAQ,WAEjBN,EAAKE,SAASH,EAAS,WAAW1C,OAAO,SAAU,CAAC,YAAY,SAAUiD,GACxE,OAAOA,EAAQ,2BAEVN,E,uBC3XF,IAAMwX,EAAc,CACvBha,MAAO,iDACPia,UAAW,aACXC,SAAU,oEACVC,UAAW,MACXC,cAAe,wBACfla,YAAa,uFAGbJ,EAAe,CACf,QACA,SACA,QACA,wBACA,SACA,sBACA,kBACA,SAKEua,EAAY,sKAclB,WAAgBnb,GAEZ,OAAQ,QAAC,IAAD,CACJW,OAAQA,EACRC,aAAcA,EACdG,iBAAkB+Z,EAClBra,IAAK0a,EACLjb,aAAcF,EAAMC","file":"component---src-pages-interactive-fellegi-sunter-jsx-d450258a0b67d3d8e256.js","sourcesContent":["export default function _taggedTemplateLiteral(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  return Object.freeze(Object.defineProperties(strings, {\n    raw: {\n      value: Object.freeze(raw)\n    }\n  }));\n}","import React from 'react'\nimport { css } from \"@emotion/core\"\nimport { rhythm } from \"../utils/typography\"\nimport { Link } from \"gatsby\"\n\n\nconst foot = css`\nmargin-left: auto;\n  margin-right: auto;\n  width: 80%;\n  max-width: 640px;\n  `\n\nconst cen = css`\n  text-align: center;\n`\n\nconst mar = css`\n  margin-top: 1rem;\n  margin-bottom: 0.5rem;\n`\n\nconst flex = css`\n\n\n    display: flex;\n    justify-content: space-between;\n\n`\n\nconst order_of_articles = [\n  \"/intro_to_probabilistic_linkage/\",\n  \"/maths_of_fellegi_sunter/\",\n  \"/visualising_fellegi_sunter/\",\n  \"/understanding_match_weights/\",\n  \"/match_weight_dependencies/\",\n  \"/m_u_generator/\",\n]\n\nconst LinkageFooter = (props) => {\n\n  let path = props.current_path\n\n  let this_index = order_of_articles.indexOf(path)\n\n  let previous_article = order_of_articles[this_index - 1]\n  let next_article = order_of_articles[this_index + 1]\n\n  if (previous_article === undefined) {\n    previous_article = <div></div>\n  } else {\n    previous_article = <div><Link to={previous_article}> &lt; Previous article</Link></div>\n  }\n\n  if (next_article === undefined) {\n    next_article = <div></div>\n  } else {\n    next_article = <div><Link to={next_article}> Next article &gt;</Link></div>\n  }\n\n  return (\n    <div>\n      <hr css={mar} />\n      <div css={flex}>\n        {previous_article}\n        <div><Link to=\"/probabilistic_linkage\">Probabilistic linkage home</Link></div>\n        {next_article}\n      </div>\n\n    </div >)\n}\n\nexport default LinkageFooter","import React from 'react'\nimport Layout from \"../layouts/layout\"\nimport LinkageFooter from './linkage_footer'\nimport ObeservableNotebookDiv from \"./observable_div\"\nimport PostFrontMatter from \"./post_frontmatter\"\nimport SEO from \"./seo\"\n\n\nfunction ProbLinkagePage(props) {\n\n\n  // let post\n\n\n  let post = <ObeservableNotebookDiv define={props.define} output_order={props.output_order} />\n\n\n  return (\n    <Layout css={props.className}>\n      <SEO title={props.post_frontmatter.title} description={props.post_frontmatter.description} />\n      <PostFrontMatter post_frontmatter={props.post_frontmatter} />\n      {post}\n      <LinkageFooter current_path={props.current_path}\n      />\n    </Layout>\n  )\n\n}\n\nexport default ProbLinkagePage","import _defineProperty from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6, _templateObject7, _templateObject8, _templateObject9, _templateObject10, _templateObject11, _templateObject12, _templateObject13;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport _regeneratorRuntime from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/regenerator\";\n// https://observablehq.com/@uwdata/arquero@209\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Arquero\\n\\nArquero is a library for query processing and transformation of array-backed data tables. Following the [relational algebra](https://en.wikipedia.org/wiki/Relational_algebra) and inspired by the design of [dplyr](https://dplyr.tidyverse.org/), Arquero provides a fluent API for manipulating column-oriented data frames. Arquero supports a range of data transformation tasks, including filter, sample, aggregation, window, join, and reshaping operations. Arquero is Spanish for \\\"archer\\\": if datasets are [arrows](https://observablehq.com/@theneuralbit/introduction-to-apache-arrow), Arquero helps their aim stay true.\"])));\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"Import Arquero and extend it to print HTML tables in Observable:\"])));\n  });\n  main.variable(observer(\"aq\")).define(\"aq\", [\"require\", \"aq_version\", \"aq_packages\", \"toView\"], /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(require, aq_version, aq_packages, toView) {\n      var aq;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return require(\"arquero@\".concat(aq_version));\n\n            case 2:\n              aq = _context.sent;\n              _context.next = 5;\n              return Promise.all(aq_packages.map(function (pkg) {\n                return require(pkg);\n              }));\n\n            case 5:\n              _context.sent.forEach(function (pkg) {\n                return aq.addPackage(pkg);\n              });\n\n              // Add HTML table view method to tables\n              aq.addTableMethod('view', toView, {\n                override: true\n              });\n              return _context.abrupt(\"return\", aq);\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x, _x2, _x3, _x4) {\n      return _ref.apply(this, arguments);\n    };\n  }());\n  main.variable(observer(\"aq_version\")).define(\"aq_version\", function () {\n    return '4.2.0';\n  });\n  main.variable(observer(\"aq_packages\")).define(\"aq_packages\", function () {\n    return [];\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"Export a global reference to Arquero operations:\"])));\n  });\n  main.variable(observer(\"op\")).define(\"op\", [\"aq\"], function (aq) {\n    return aq.op;\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"To use the same setup in your own notebooks, add a cell with the following code:\\n~~~ js\\nimport { aq, op } from '@uwdata/arquero'\\n~~~\\n\"])));\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"To get started, see the [Introducing Arquero](https://observablehq.com/@uwdata/introducing-arquero) and [Arquero Cookbook](https://observablehq.com/@uwdata/arquero-cookbook) notebooks.\"])));\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"To use Arquero outside of Observable, see [https://github.com/uwdata/arquero](https://github.com/uwdata/arquero).\"])));\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"<hr>\\n## Examples\\n\\nThe core abstractions in Arquero are *data tables*, which model each column as an array of values, and *verbs* that transform data and return new tables. Verbs are table methods, allowing method chaining for multi-step transformations. Though each table is unique, many verbs reuse the underlying columns to limit duplication.\\n\"])));\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject8 || (_templateObject8 = _taggedTemplateLiteral([\"Average hours of sunshine per month, from [https://usclimatedata.com/](https://usclimatedata.com/):\"])));\n  });\n  main.variable(observer(\"dt\")).define(\"dt\", [\"aq\"], function (aq) {\n    return aq.table({\n      'Seattle': [69, 108, 178, 207, 253, 268, 312, 281, 221, 142, 72, 52],\n      'Chicago': [135, 136, 187, 215, 281, 311, 318, 283, 226, 193, 113, 106],\n      'San Francisco': [165, 182, 251, 281, 314, 330, 300, 272, 267, 243, 189, 156]\n    });\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject9 || (_templateObject9 = _taggedTemplateLiteral([\"Sorted differences between Seattle and Chicago:\"])));\n  });\n  main.variable(observer()).define([\"dt\", \"op\"], function (dt, op) {\n    return dt.derive({\n      month: function month(d) {\n        return op.row_number();\n      },\n      diff: function diff(d) {\n        return d.Seattle - d.Chicago;\n      }\n    }).select('month', 'diff').orderby('month').view({\n      height: 400\n    });\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject10 || (_templateObject10 = _taggedTemplateLiteral([\"Is Seattle more correlated with San Francisco or Chicago?\"])));\n  });\n  main.variable(observer()).define([\"dt\", \"op\"], function (dt, op) {\n    return dt.rollup({\n      corr_sf: op.corr('Seattle', 'San Francisco'),\n      corr_chi: op.corr('Seattle', 'Chicago')\n    }).view();\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject11 || (_templateObject11 = _taggedTemplateLiteral([\"Summary statistics per city, as output objects:\"])));\n  });\n  main.variable(observer()).define([\"dt\", \"aq\", \"op\"], function (dt, aq, op) {\n    return dt.fold(aq.all(), {\n      as: ['city', 'sun']\n    }).groupby('city').rollup({\n      min: function min(d) {\n        return op.min(d.sun);\n      },\n      // functional form of op.min('sun')\n      max: function max(d) {\n        return op.max(d.sun);\n      },\n      avg: function avg(d) {\n        return op.average(d.sun);\n      },\n      med: function med(d) {\n        return op.median(d.sun);\n      },\n      // functional forms permit flexible table expressions\n      skew: function skew(_ref2) {\n        var s = _ref2.sun;\n        return (op.mean(s) - op.median(s)) / op.stdev(s) || 0;\n      }\n    }).objects();\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject12 || (_templateObject12 = _taggedTemplateLiteral([\"<hr>\\n## Utilities\\n\"])));\n  });\n  main.variable(observer(\"toView\")).define(\"toView\", [\"html\"], function (html) {\n    var DEFAULT_LIMIT = 100;\n\n    var DEFAULT_NULL = function DEFAULT_NULL(value) {\n      return \"<span style=\\\"color: #999;\\\">\".concat(value, \"</span>\");\n    };\n\n    var tableStyle = 'margin: 0; border-collapse: collapse; width: initial;';\n    var cellStyle = 'padding: 1px 5px; white-space: nowrap; overflow-x: hidden; text-overflow: ellipsis; font-variant-numeric: tabular-nums;'; // extend table prototype to provide an HTML table view\n\n    return function (dt) {\n      var opt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      // permit shorthand for limit\n      if (typeof opt === 'number') opt = {\n        limit: opt\n      }; // marshal cell color options\n\n      var color = _objectSpread({}, opt.color);\n\n      if (typeof opt.color === 'function') {\n        // if function, apply to all columns\n        dt.columnNames().forEach(function (name) {\n          return color[name] = opt.color;\n        });\n      } else {\n        var _loop = function _loop(key) {\n          var value = color[key];\n          color[key] = typeof value === 'function' ? value : function () {\n            return value;\n          };\n        };\n\n        // otherwise, gather per-column color options\n        for (var key in color) {\n          _loop(key);\n        }\n      } // marshal CSS styles as toHTML() options\n\n\n      var table = \"\".concat(tableStyle);\n\n      var td = function td(name, index, row) {\n        return \"\".concat(cellStyle, \" max-width: \").concat(+opt.maxCellWidth || 300, \"px;\") + (color[name] ? \" background-color: \".concat(color[name](index, row), \";\") : '');\n      };\n\n      opt = _objectSpread(_objectSpread({\n        limit: DEFAULT_LIMIT,\n        null: DEFAULT_NULL\n      }, opt), {}, {\n        style: {\n          table: table,\n          td: td,\n          th: td\n        }\n      }); // return container div, bind table value to support viewof operator\n\n      var size = \"max-height: \".concat(+opt.height || 270, \"px\");\n      var style = \"\".concat(size, \"; overflow-x: auto; overflow-y: auto;\");\n      var view = html(_templateObject13 || (_templateObject13 = _taggedTemplateLiteral([\"<div style=\\\"\", \"\\\">\", \"</div>\"])), style, dt.toHTML(opt));\n      view.value = dt;\n      return view;\n    };\n  });\n  return main;\n}","import _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5;\n\nimport define1 from \"./79750b3b8e929d9d@209.js\";\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Fellegi Sunter utils\"])));\n  });\n  main.variable(observer(\"records_l\")).define(\"records_l\", function () {\n    return [{\n      uid: \"1_l\",\n      fname: \"John\",\n      sname: \"Smith\",\n      dob: \"1989-03-02\",\n      town: \"Bristol\"\n    }, {\n      uid: \"2_l\",\n      fname: \"Tom\",\n      sname: \"Hanks\",\n      dob: \"1956-07-09\",\n      town: \"Concord\"\n    }, {\n      uid: \"3_l\",\n      fname: \"David\",\n      sname: \"Smith\",\n      dob: \"1981-08-21\",\n      town: \"London\"\n    }];\n  });\n  main.variable(observer(\"records_r\")).define(\"records_r\", function () {\n    return [{\n      uid: \"1_r\",\n      fname: \"Jonathan\",\n      sname: \"Smith\",\n      dob: \"1989-03-02\",\n      town: \"Bristol\"\n    }, {\n      uid: \"2_r\",\n      fname: \"David\",\n      sname: \"Smith\",\n      dob: \"1981-08-21\",\n      town: \"Peckham\"\n    }];\n  });\n  main.variable(observer(\"df_r\")).define(\"df_r\", [\"aq\", \"records_r\"], function (aq, records_r) {\n    return aq.from(records_r);\n  });\n  main.variable(observer(\"splink_settings\")).define(\"splink_settings\", function () {\n    return {\n      proportion_of_matches: 1 / 100,\n      comparison_columns: [{\n        num_levels: 3,\n        col_name: \"fname\",\n        u_probabilities: [0.8, 0.2],\n        m_probabilities: [0.2, 0.8],\n        case_expression: function case_expression(row) {\n          if (row.fname_l == row.fname_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      }, {\n        num_levels: 3,\n        col_name: \"sname\",\n        u_probabilities: [0.9, 0.1],\n        m_probabilities: [0.2, 0.8],\n        case_expression: function case_expression(row) {\n          if (row.sname_l == row.sname_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      }, {\n        col_name: \"dob\",\n        u_probabilities: [0.99, 0.01],\n        m_probabilities: [0.2, 0.8],\n        case_expression: function case_expression(row) {\n          if (row.dob_l == row.dob_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      }, {\n        col_name: \"town\",\n        u_probabilities: [0.7, 0.3],\n        m_probabilities: [0.3, 0.7],\n        case_expression: function case_expression(row) {\n          if (row.town_l == row.town_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      }]\n    };\n  });\n  main.variable(observer(\"df_comparison\")).define(\"df_comparison\", [\"get_df_comparison\", \"records_l\", \"records_r\"], function (get_df_comparison, records_l, records_r) {\n    return get_df_comparison(records_l, records_r);\n  });\n  main.variable(observer()).define([\"df_comparison\"], function (df_comparison) {\n    return df_comparison.view();\n  });\n  main.variable(observer(\"df_gammas\")).define(\"df_gammas\", [\"get_df_gammas\", \"df_comparison\", \"splink_settings\"], function (get_df_gammas, df_comparison, splink_settings) {\n    return get_df_gammas(df_comparison, splink_settings);\n  });\n  main.variable(observer()).define([\"df_gammas\"], function (df_gammas) {\n    return df_gammas.view();\n  });\n  main.variable(observer()).define([\"get_df_e\", \"df_gammas\", \"splink_settings\", \"term_freqs\"], function (get_df_e, df_gammas, splink_settings, term_freqs) {\n    return get_df_e(df_gammas, splink_settings, term_freqs).view();\n  });\n  main.variable(observer(\"get_df_e\")).define(\"get_df_e\", [\"get_match_probability\", \"aq\"], function (get_match_probability, aq) {\n    return function get_df_e(df_gammas, splink_settings) {\n      var term_freqs = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var df_e = df_gammas.objects().map(function (row) {\n        row[\"match_probability\"] = get_match_probability(row, splink_settings, term_freqs);\n        return row;\n      });\n      var df = aq.from(df_e);\n      df = df.relocate([\"match_probability\"], {\n        after: \"uid_r\"\n      });\n      return df;\n    };\n  });\n  main.variable(observer(\"get_match_probability\")).define(\"get_match_probability\", [\"prob_to_log2_bf\", \"log2_bf_to_prob\"], function (prob_to_log2_bf, log2_bf_to_prob) {\n    return function (row, settings) {\n      var term_freqs = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var comparison_columns = settings.comparison_columns;\n      var prior_log2_bg = prob_to_log2_bf(settings.proportion_of_matches);\n      var log2_bayes = comparison_columns.reduce(function (a, cc) {\n        var gamma_col_name = \"_\" + cc.col_name;\n        var gamma = row[gamma_col_name]; // gamma = -1 means one side of the comparison is null\n\n        if (gamma == -1) {\n          return a;\n        }\n\n        var m = cc[\"m_probabilities\"][gamma];\n        var u = cc[\"u_probabilities\"][gamma]; // If TF lookup provided, attempt to use to overwrite u\n\n        var l_val = row[cc.col_name + \"_l\"].toLowerCase();\n        var r_val = row[cc.col_name + \"_r\"].toLowerCase();\n\n        if (l_val == r_val) {\n          if (cc.col_name in term_freqs) {\n            var tfs = term_freqs[cc.col_name];\n            var u_l = tfs[l_val] || 0;\n            var u_r = tfs[r_val] || 0;\n            var u_new = Math.max(u_l, u_r);\n\n            if (u_new > 0) {\n              u = u_new;\n            }\n          }\n        }\n\n        return a + Math.log2(m / u);\n      }, prior_log2_bg);\n      return log2_bf_to_prob(log2_bayes);\n    };\n  });\n  main.variable(observer(\"get_match_probability_components\")).define(\"get_match_probability_components\", [\"prob_to_log2_bf\", \"log2_bf_to_prob\"], function (prob_to_log2_bf, log2_bf_to_prob) {\n    return function (row, settings, num_columns) {\n      if (num_columns == undefined) {\n        num_columns = settings.comparison_columns.length;\n      }\n\n      var comparison_columns = settings.comparison_columns.slice(0, num_columns);\n      var prior_log2_bg = prob_to_log2_bf(settings.proportion_of_matches);\n      var d = {\n        comparison_vector: [],\n        gamma_symbols: [],\n        m_values: [],\n        u_values: [],\n        m_symbols: [],\n        u_symbols: [],\n        bayes_factors: [],\n        log2_bayes_factors: [],\n        col_names: [],\n        match_probability: null,\n        lam: settings.proportion_of_matches\n      };\n      comparison_columns.forEach(function (cc) {\n        var col_name = \"_\" + cc.col_name;\n        var gamma = row[col_name];\n        var m = cc[\"m_probabilities\"][gamma];\n        var u = cc[\"u_probabilities\"][gamma];\n        var col_name_escaped = cc.col_name.replace(\"_\", \"\\\\_\");\n        d[\"comparison_vector\"].push(gamma);\n        d[\"gamma_symbols\"].push(\"\\\\gamma_\\\\text{\".concat(col_name_escaped, \"}\"));\n        d[\"col_names\"].push(col_name);\n        d[\"m_values\"].push(m);\n        d[\"m_symbols\"].push(\"m_{\\\\text{\".concat(col_name_escaped, \"},\").concat(gamma, \"}\"));\n        d[\"u_values\"].push(u);\n        d[\"u_symbols\"].push(\"u_{\\\\text{\".concat(col_name_escaped, \"},\").concat(gamma, \"}\"));\n        d[\"bayes_factors\"].push(m / u);\n        d[\"log2_bayes_factors\"].push(Math.log2(m / u));\n      });\n      var log2_bayes = d[\"log2_bayes_factors\"].reduce(function (a, bf) {\n        return a + bf;\n      }, prior_log2_bg);\n      d[\"match_probability\"] = log2_bf_to_prob(log2_bayes);\n      var lam = settings.proportion_of_matches;\n      d[\"size_of_match_portion\"] = lam * d[\"m_values\"].reduce(function (a, b) {\n        return a * b;\n      }, 1);\n      d[\"size_of_non_match_portion\"] = (1 - lam) * d[\"u_values\"].reduce(function (a, b) {\n        return a * b;\n      }, 1);\n      return d;\n    };\n  });\n  main.variable(observer(\"get_m_u_formula_numbers\")).define(\"get_m_u_formula_numbers\", [\"get_match_probability_components\"], function (get_match_probability_components) {\n    return function (row, settings, num_columns) {\n      var d = get_match_probability_components(row, settings, num_columns);\n      var m = d[\"m_values\"].map(function (d) {\n        return d.toPrecision(3);\n      });\n      var u = d[\"u_values\"].map(function (d) {\n        return d.toPrecision(3);\n      });\n      var lam = d[\"lam\"].toPrecision(3);\n      var lam_m = [lam].concat(m);\n      var lam_u = [\"(1 - \".concat(lam, \")\")].concat(u);\n      var m_tex = lam_m.join(\" \\\\times \");\n      var u_tex = lam_u.join(\" \\\\times \");\n      var p = d[\"match_probability\"].toPrecision(3);\n      var m_part = d[\"size_of_match_portion\"].toPrecision(3);\n      var u_part = d[\"size_of_non_match_portion\"].toPrecision(3);\n      return \"\\\\frac{\".concat(m_tex, \"}{(\").concat(m_tex, \") + (\").concat(u_tex, \")}  \\\\newline[10pt] = \\\\frac{\").concat(m_part, \"}{\").concat(m_part, \" + \").concat(u_part, \"}  \\\\newline[10pt] = \").concat(p);\n    };\n  });\n  main.variable(observer(\"get_m_u_formula_symbols\")).define(\"get_m_u_formula_symbols\", [\"get_match_probability_components\"], function (get_match_probability_components) {\n    return function (row, settings) {\n      var d = get_match_probability_components(row, settings);\n      var m = d[\"m_symbols\"];\n      var u = d[\"u_symbols\"];\n      var lam = d[\"lam\"];\n      var lam_m = [\"\\\\lambda\"].concat(m);\n      var lam_u = [\"(1 - \\\\lambda)\"].concat(u);\n      var m_tex = lam_m.join(\" \");\n      var u_tex = lam_u.join(\" \");\n      return \"\\\\frac{\".concat(m_tex, \"}{\").concat(m_tex, \") + \").concat(u_tex, \"}\");\n    };\n  });\n  main.variable(observer()).define([\"tex\", \"get_m_u_formula_symbols\", \"df_gammas\", \"splink_settings\"], function (tex, get_m_u_formula_symbols, df_gammas, splink_settings) {\n    return tex(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\", \"\\n\"])), get_m_u_formula_symbols(df_gammas.objects()[0], splink_settings));\n  });\n  main.variable(observer(\"get_comparison_vector_symbols_and_numbers\")).define(\"get_comparison_vector_symbols_and_numbers\", [\"get_match_probability_components\"], function (get_match_probability_components) {\n    return function (row, settings, num_columns) {\n      var d = get_match_probability_components(row, settings, num_columns);\n      var joined = d[\"gamma_symbols\"].join(\", \");\n      var joined2 = d[\"comparison_vector\"].join(\", \");\n      return \"\\\\bm{\\\\gamma} = [\".concat(joined, \"]= [\").concat(joined2, \"]\");\n    };\n  });\n  main.variable(observer()).define([\"tex\", \"get_comparison_vector_symbols_and_numbers\", \"df_gammas\", \"splink_settings\"], function (tex, get_comparison_vector_symbols_and_numbers, df_gammas, splink_settings) {\n    return tex(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\", \"\\n\"])), get_comparison_vector_symbols_and_numbers(df_gammas.objects()[0], splink_settings));\n  });\n  main.variable(observer()).define([\"tex\"], function (tex) {\n    return tex(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\\bm{gamma} = [gamma_\\text{fname}, gamma_\\text{sname}]\"], [\"\\\\bm{\\\\gamma} = [\\\\gamma_\\\\text{fname}, \\\\gamma_\\\\text{sname}]\"])));\n  });\n  main.variable(observer()).define([\"tex\", \"get_m_u_formula_numbers\", \"df_gammas\", \"splink_settings\"], function (tex, get_m_u_formula_numbers, df_gammas, splink_settings) {\n    return tex(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"\", \"\"])), get_m_u_formula_numbers(df_gammas.objects()[0], splink_settings));\n  });\n  main.variable(observer()).define([\"get_match_probability_components\", \"df_gammas\", \"splink_settings\"], function (get_match_probability_components, df_gammas, splink_settings) {\n    return get_match_probability_components(df_gammas.objects()[0], splink_settings);\n  });\n  main.variable(observer(\"get_df_comparison\")).define(\"get_df_comparison\", [\"aq\"], function (aq) {\n    return function (records_as_dict_l, records_as_dict_r) {\n      var df_l = aq.from(records_as_dict_l);\n      var df_r = aq.from(records_as_dict_r);\n      var df_comparison = df_l.join(df_r, function (a, b) {\n        return true;\n      }, null, {\n        suffix: [\"_l\", \"_r\"]\n      }); // Group columns\n\n      var colname_no_suffix = df_l.columnNames();\n      var cols_ordered = [];\n      colname_no_suffix.forEach(function (d) {\n        cols_ordered.push(d + \"_l\");\n        cols_ordered.push(d + \"_r\");\n      });\n      df_comparison = df_comparison.select(cols_ordered);\n      return df_comparison;\n    };\n  });\n  main.variable(observer(\"get_df_gammas\")).define(\"get_df_gammas\", [\"aq\"], function (aq) {\n    return function get_df_gammas(df_comparison, splink_settings) {\n      var comparison_columns = splink_settings[\"comparison_columns\"]; // let df_gammas = df_comparison;\n      // let derivation = {};\n      // comparison_columns.forEach(function (cc) {\n      //   derivation[\"_\" + cc.col_name] = cc.case_expression;\n      // });\n      // df_gammas = df_gammas.derive(derivation);\n      // Since we want function calls like double metaphone in our comparison columns, we need to\n      // roundtrip from aq -> object -> aq\n\n      var df_gammas = df_comparison.objects();\n      comparison_columns.forEach(function (cc) {\n        df_gammas.forEach(function (row) {\n          row[\"_\" + cc.col_name] = cc.case_expression(row);\n        });\n      });\n      df_gammas = aq.from(df_gammas); // Put columns in order\n\n      var col_order = [\"uid_l\", \"uid_r\"];\n      comparison_columns.forEach(function (cc) {\n        col_order.push(cc.col_name + \"_l\");\n        col_order.push(cc.col_name + \"_r\");\n        col_order.push(\"_\" + cc.col_name);\n      });\n      df_gammas = df_gammas.select(col_order);\n      return df_gammas;\n    };\n  });\n  main.variable(observer(\"bayes_factor_to_prob\")).define(\"bayes_factor_to_prob\", function () {\n    return function bayes_factor_to_prob(b) {\n      return b / (b + 1);\n    };\n  });\n  main.variable(observer(\"log2_bf_to_prob\")).define(\"log2_bf_to_prob\", [\"bayes_factor_to_prob\"], function (bayes_factor_to_prob) {\n    return function log2_bf_to_prob(b) {\n      return bayes_factor_to_prob(Math.pow(2, b));\n    };\n  });\n  main.variable(observer(\"prob_to_bayes_factor\")).define(\"prob_to_bayes_factor\", function () {\n    return function prob_to_bayes_factor(p) {\n      return p / (1 - p);\n    };\n  });\n  main.variable(observer(\"prob_to_log2_bf\")).define(\"prob_to_log2_bf\", [\"prob_to_bayes_factor\"], function (prob_to_bayes_factor) {\n    return function prob_to_log2_bf(p) {\n      return Math.log2(prob_to_bayes_factor(p));\n    };\n  });\n  var child1 = runtime.module(define1);\n  main.import(\"aq\", child1);\n  main.import(\"op\", child1);\n  main.variable(observer(\"first_name_lookup\")).define(\"first_name_lookup\", [\"d3\"], function (d3) {\n    return d3.csv(\"https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/first_name_noyear.csv\", d3.autoType).then(function (csv_file) {\n      var lookup = {};\n      csv_file.forEach(function (row) {\n        lookup[row.firstname] = row.freq;\n      });\n      return lookup;\n    });\n  });\n  main.variable(observer(\"surname_lookup\")).define(\"surname_lookup\", [\"d3\"], function (d3) {\n    return d3.csv(\"https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/last_name.csv\", d3.autoType).then(function (csv_file) {\n      var lookup = {};\n      csv_file.forEach(function (row) {\n        lookup[row.surname] = row.freq;\n      });\n      return lookup;\n    });\n  });\n  main.variable(observer(\"term_freqs\")).define(\"term_freqs\", [\"first_name_lookup\", \"surname_lookup\"], function (first_name_lookup, surname_lookup) {\n    return {\n      fname: first_name_lookup,\n      sname: surname_lookup\n    };\n  });\n  main.variable(observer()).define([\"term_freqs\"], function (term_freqs) {\n    return term_freqs.fname[\"joshua\"];\n  });\n  main.variable(observer()).define([\"term_freqs\"], function (term_freqs) {\n    return term_freqs.sname[\"linacre\"];\n  });\n  return main;\n}","import _defineProperty from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Waterfall chart\"])));\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"### Objective\\n\\nTake \\n- a Splink settings object \\n- A row of data from `df_e`\\nAnd turn it into the data needed for the waterfall chart.\\n\\n\"], [\"### Objective\\n\\nTake \\n- a Splink settings object \\n- A row of data from \\\\`df_e\\\\`\\nAnd turn it into the data needed for the waterfall chart.\\n\\n\"])));\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"## Example\"])));\n  });\n  main.variable(observer(\"splink_settings\")).define(\"splink_settings\", function () {\n    return {\n      proportion_of_matches: 1 / 100,\n      comparison_columns: [{\n        num_levels: 3,\n        col_name: \"first_name\",\n        u_probabilities: [0.8, 0.2],\n        m_probabilities: [0.2, 0.8]\n      }, {\n        num_levels: 3,\n        col_name: \"surname\",\n        u_probabilities: [0.8, 0.2],\n        m_probabilities: [0.2, 0.8]\n      }, {\n        col_name: \"date_of_birth\",\n        u_probabilities: [0.99, 0.01],\n        m_probabilities: [0.2, 0.8]\n      }]\n    };\n  });\n  main.variable(observer(\"row\")).define(\"row\", function () {\n    var _ref;\n\n    return _ref = {\n      first_name_l: \"John\",\n      first_name_r: \"John\",\n      \"\\uD835\\uDEFE_first_name\": 1,\n      surname_l: \"Smith\",\n      surname_r: \"Smith\",\n      \"\\uD835\\uDEFE_surname\": 1,\n      date_of_birth_l: \"1992-04-01\"\n    }, _defineProperty(_ref, \"date_of_birth_l\", \"1992-04-02\"), _defineProperty(_ref, \"\\uD835\\uDEFE_date_of_birth\", 0), _defineProperty(_ref, \"other\", \"hi\"), _ref;\n  });\n  main.variable(observer(\"overrides\")).define(\"overrides\", function () {\n    return {\n      height: 200\n    };\n  });\n  main.variable(observer()).define([\"get_waterfall_chart\", \"row\", \"splink_settings\", \"overrides\"], function (get_waterfall_chart, row, splink_settings, overrides) {\n    return get_waterfall_chart(row, splink_settings, overrides, true);\n  });\n  main.variable(observer()).define([\"get_waterfall_chart\", \"row\", \"splink_settings\", \"overrides\"], function (get_waterfall_chart, row, splink_settings, overrides) {\n    return get_waterfall_chart(row, splink_settings, overrides, false);\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"## Code\"])));\n  });\n  main.variable(observer(\"get_waterfall_chart\")).define(\"get_waterfall_chart\", [\"get_waterfall_chart_data\", \"embed\", \"get_chart_spec\"], function (get_waterfall_chart_data, embed, get_chart_spec) {\n    return function (row, splink_settings, chart_overrides, simplified) {\n      var term_freqs = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n      var data = get_waterfall_chart_data(row, splink_settings, term_freqs);\n      return embed(get_chart_spec(data, chart_overrides, simplified));\n    };\n  });\n  main.variable(observer(\"get_comparison_column_lookup\")).define(\"get_comparison_column_lookup\", function () {\n    return function get_comparison_column_lookup(splink_settings) {\n      var lookup = {};\n      splink_settings.comparison_columns.forEach(function (d) {\n        var col_name = d[\"col_name\"];\n        lookup[col_name] = d;\n      });\n      return lookup;\n    };\n  });\n  main.variable(observer(\"get_waterfall_chart_data\")).define(\"get_waterfall_chart_data\", [\"get_waterfall_data_lambda_row\", \"get_waterfall_data_other_rows\", \"get_waterfall_data_final_row\"], function (get_waterfall_data_lambda_row, get_waterfall_data_other_rows, get_waterfall_data_final_row) {\n    return function get_waterfall_chart_data(row, splink_settings) {\n      var term_freqs = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var lambda_row = get_waterfall_data_lambda_row(splink_settings);\n      var waterfall_data_other_rows = get_waterfall_data_other_rows(row, splink_settings, term_freqs);\n      var rows_except_final = [lambda_row].concat(waterfall_data_other_rows);\n      var final_row = get_waterfall_data_final_row(splink_settings);\n      var cumulative_log2_bayes_factor = rows_except_final.reduce(function (a, b) {\n        return a + b[\"log2_bayes_factor\"];\n      }, 0);\n      final_row[\"bayes_factor\"] = Math.pow(2, cumulative_log2_bayes_factor);\n      final_row[\"log2_bayes_factor\"] = cumulative_log2_bayes_factor;\n      return rows_except_final.concat([final_row]);\n    };\n  });\n  main.variable(observer(\"get_waterfall_row_gamma\")).define(\"get_waterfall_row_gamma\", [\"get_comparison_column_lookup\", \"log2\"], function (get_comparison_column_lookup, log2) {\n    return function get_waterfall_row_gamma(gamma_key, row, splink_settings, term_freqs) {\n      var key = gamma_key;\n      var gamma_value = row[key];\n      var col_name = key.replace(\"_\", \"\");\n      var cc_lookup = get_comparison_column_lookup(splink_settings);\n      var this_cc = cc_lookup[col_name];\n      var value_l = row[col_name + \"_l\"];\n      var value_r = row[col_name + \"_r\"];\n      var u_probability, m_probability;\n\n      if (gamma_value == -1) {\n        u_probability = 0.5;\n        m_probability = 0.5;\n      } else {\n        u_probability = this_cc[\"u_probabilities\"][gamma_value];\n        m_probability = this_cc[\"m_probabilities\"][gamma_value];\n\n        if (value_l == value_r) {\n          if (col_name in term_freqs) {\n            var tfs = term_freqs[col_name];\n            u_probability = tfs[value_l] || u_probability;\n          }\n        }\n      }\n\n      var bayes_factor = m_probability / u_probability;\n      return {\n        bayes_factor: bayes_factor,\n        column_name: col_name,\n        gamma_column_name: \"_\" + col_name,\n        gamma_index: gamma_value,\n        level_name: \"level_\" + gamma_value,\n        log2_bayes_factor: log2(bayes_factor),\n        m_probability: m_probability,\n        num_levels: null,\n        u_probability: u_probability,\n        value_l: value_l,\n        value_r: value_r\n      };\n    };\n  });\n  main.variable(observer(\"get_waterfall_data_lambda_row\")).define(\"get_waterfall_data_lambda_row\", [\"prob_to_bayes_factor\", \"prob_to_log2_bayes_factor\"], function (prob_to_bayes_factor, prob_to_log2_bayes_factor) {\n    return function (splink_settings) {\n      var row = {\n        bayes_factor: prob_to_bayes_factor(splink_settings.proportion_of_matches),\n        column_name: \"Prior\",\n        gamma_column_name: \"\",\n        gamma_index: \"\",\n        level_name: null,\n        log2_bayes_factor: prob_to_log2_bayes_factor(splink_settings.proportion_of_matches),\n        m_probability: null,\n        num_levels: null,\n        u_probability: null,\n        value_l: \"\",\n        value_r: \"\"\n      };\n      return row;\n    };\n  });\n  main.variable(observer(\"get_waterfall_data_other_rows\")).define(\"get_waterfall_data_other_rows\", [\"get_waterfall_row_gamma\"], function (get_waterfall_row_gamma) {\n    return function (row, splink_settings, term_freqs) {\n      var keys = Object.keys(row);\n      keys = keys.filter(function (key) {\n        return key.includes(\"_\");\n      });\n      return keys.map(function (gamma_key) {\n        return get_waterfall_row_gamma(gamma_key, row, splink_settings, term_freqs);\n      });\n    };\n  });\n  main.variable(observer(\"get_waterfall_data_final_row\")).define(\"get_waterfall_data_final_row\", function () {\n    return function (splink_settings) {\n      var row = {\n        bayes_factor: null,\n        column_name: \"Final score\",\n        gamma_column_name: \"\",\n        gamma_index: \"\",\n        level_name: null,\n        log2_bayes_factor: null,\n        m_probability: null,\n        num_levels: null,\n        u_probability: null,\n        value_l: \"\",\n        value_r: \"\"\n      };\n      return row;\n    };\n  });\n  main.variable(observer(\"get_chart_spec\")).define(\"get_chart_spec\", [\"base_spec\"], function (base_spec) {\n    return function (data, overrides) {\n      var simplified = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      var base_spec_2 = JSON.parse(JSON.stringify(base_spec)); // let base_spec_2 = Object.assign({}, base_spec);\n\n      base_spec_2.data.values = data;\n\n      var spec = _objectSpread(_objectSpread({}, base_spec_2), overrides);\n\n      if (simplified) {\n        // Remove right hand axis\n        spec[\"layer\"][1][\"encoding\"][\"y\"][\"axis\"] = false; // Remove bayes factor text overlays\n        // spec[\"layer\"][0][\"layer\"].splice(2, 1);\n\n        spec[\"layer\"][0][\"layer\"][2][\"encoding\"][\"text\"] = {\n          type: \"nominal\",\n          field: \"up_down_emoji\"\n        };\n        spec[\"layer\"][0][\"layer\"][2][\"encoding\"][\"opacity\"] = {\n          condition: {\n            value: 0,\n            test: \"datum.column_name == 'Final score' || datum.column_name == 'Prior'\"\n          }\n        }; // Make left hand side axis probability\n\n        var expr = \"format(1 / (1 + pow(2, -1*datum.value)), '.2r')\";\n        spec[\"layer\"][0][\"layer\"][1][\"encoding\"][\"y\"][\"axis\"][\"labelExpr\"] = expr;\n        spec[\"layer\"][0][\"layer\"][1][\"encoding\"][\"y\"][\"axis\"][\"title\"] = \"probability\"; // Tooltip\n\n        spec[\"layer\"][0][\"layer\"][1][\"encoding\"][\"tooltip\"] = [{\n          type: \"quantitative\",\n          field: \"prob\",\n          format: \".3r\",\n          title: \"Cumulative match probability\"\n        }];\n      }\n\n      return spec;\n    };\n  });\n  main.variable(observer(\"base_spec\")).define(\"base_spec\", function () {\n    return {\n      config: {\n        view: {\n          continuousHeight: 300,\n          continuousWidth: 400\n        }\n      },\n      title: {\n        text: \"Bayes factor intuition chart\",\n        subtitle: \"How each comparison column contributes to the final match score\"\n      },\n      transform: [{\n        filter: \"(datum.bayes_factor !== 1.0)\"\n      }, {\n        window: [{\n          op: \"sum\",\n          field: \"log2_bayes_factor\",\n          as: \"sum\"\n        }, {\n          op: \"lead\",\n          field: \"column_name\",\n          as: \"lead\"\n        }],\n        frame: [null, 0]\n      }, {\n        calculate: 'datum.column_name === \"Final score\" ? datum.sum - datum.log2_bayes_factor : datum.sum',\n        as: \"sum\"\n      }, {\n        calculate: \"datum.lead === null ? datum.column_name : datum.lead\",\n        as: \"lead\"\n      }, {\n        calculate: 'datum.column_name === \"Final score\" || datum.column_name === \"Prior lambda\" ? 0 : datum.sum - datum.log2_bayes_factor',\n        as: \"previous_sum\"\n      }, {\n        calculate: 'datum.sum > datum.previous_sum ? datum.column_name : \"\"',\n        as: \"top_label\"\n      }, {\n        calculate: 'datum.sum < datum.previous_sum ? datum.column_name : \"\"',\n        as: \"bottom_label\"\n      }, {\n        calculate: \"datum.sum > datum.previous_sum ? datum.sum : datum.previous_sum\",\n        as: \"sum_top\"\n      }, {\n        calculate: \"datum.sum < datum.previous_sum ? datum.sum : datum.previous_sum\",\n        as: \"sum_bottom\"\n      }, {\n        calculate: \"(datum.sum + datum.previous_sum) / 2\",\n        as: \"center\"\n      }, {\n        calculate: '(datum.log2_bayes_factor > 0 ? \"+\" : \"\") + datum.log2_bayes_factor',\n        as: \"text_log2_bayes_factor\"\n      }, {\n        calculate: \"datum.sum < datum.previous_sum ? 4 : -4\",\n        as: \"dy\"\n      }, {\n        calculate: 'datum.sum < datum.previous_sum ? \"top\" : \"bottom\"',\n        as: \"baseline\"\n      }, {\n        calculate: \"1. / (1 + pow(2, -1.*datum.sum))\",\n        as: \"prob\"\n      }, {\n        calculate: \"0*datum.sum\",\n        as: \"zero\"\n      }, {\n        calculate: 'datum.sum > datum.previous_sum ? \"\" : \"\"',\n        as: \"up_down_emoji\"\n      }],\n      layer: [{\n        layer: [{\n          mark: \"rule\",\n          encoding: {\n            y: {\n              field: \"zero\",\n              type: \"quantitative\"\n            },\n            size: {\n              value: 0.5\n            },\n            color: {\n              value: \"black\"\n            }\n          }\n        }, {\n          mark: {\n            type: \"bar\",\n            width: 60\n          },\n          encoding: {\n            color: {\n              condition: {\n                value: \"red\",\n                test: \"(datum.log2_bayes_factor < 0)\"\n              },\n              value: \"green\"\n            },\n            opacity: {\n              condition: {\n                value: 1,\n                test: \"datum.column_name == 'Prior' || datum.column_name == 'Final score'\"\n              },\n              value: 0.5\n            },\n            tooltip: [{\n              type: \"nominal\",\n              field: \"column_name\",\n              title: \"Comparison column\"\n            }, {\n              type: \"nominal\",\n              field: \"value_l\",\n              title: \"Value (L)\"\n            }, {\n              type: \"nominal\",\n              field: \"value_r\",\n              title: \"Value (R)\"\n            }, {\n              type: \"nominal\",\n              field: \"gamma_index\",\n              title: \"Gamma level\"\n            }, {\n              type: \"quantitative\",\n              field: \"bayes_factor\",\n              format: \".3r\",\n              title: \"Bayes factor\"\n            }, {\n              type: \"quantitative\",\n              field: \"log2_bayes_factor\",\n              format: \".3r\",\n              title: \"log2(Bayes factor)\"\n            }, {\n              type: \"quantitative\",\n              field: \"prob\",\n              format: \".3r\",\n              title: \"Cumulative match probability\"\n            }],\n            x: {\n              type: \"nominal\",\n              axis: {\n                labelExpr: \"datum.value == 'Prior' || datum.value == 'Final score' ? '' : datum.value\",\n                labelAlign: \"center\",\n                labelPadding: 10,\n                title: \"Column\",\n                grid: true,\n                tickBand: \"extent\"\n              },\n              field: \"column_name\",\n              sort: null\n            },\n            y: {\n              type: \"quantitative\",\n              axis: {\n                grid: false,\n                orient: \"left\",\n                title: \"log2(Bayes factor)\"\n              },\n              field: \"previous_sum\"\n            },\n            y2: {\n              field: \"sum\"\n            }\n          }\n        }, {\n          mark: {\n            type: \"text\",\n            fontWeight: \"bold\"\n          },\n          encoding: {\n            color: {\n              value: \"white\"\n            },\n            text: {\n              condition: {\n                type: \"nominal\",\n                field: \"log2_bayes_factor\",\n                format: \".2f\",\n                test: \"abs(datum.log2_bayes_factor) > 1\"\n              },\n              value: \"\"\n            },\n            x: {\n              type: \"nominal\",\n              axis: {\n                labelAngle: 0,\n                title: \"Column\"\n              },\n              field: \"column_name\",\n              sort: null\n            },\n            y: {\n              type: \"quantitative\",\n              axis: {\n                orient: \"left\"\n              },\n              field: \"center\"\n            }\n          }\n        }, {\n          mark: {\n            type: \"text\",\n            baseline: \"bottom\",\n            dy: -5,\n            fontWeight: \"bold\"\n          },\n          encoding: {\n            color: {\n              value: \"black\"\n            },\n            text: {\n              condition: {\n                type: \"nominal\",\n                field: \"top_label\",\n                test: \"abs(datum.log2_bayes_factor) > 1\"\n              },\n              value: \"\"\n            },\n            x: {\n              type: \"nominal\",\n              axis: {\n                labelAngle: 0,\n                title: \"Column\"\n              },\n              field: \"column_name\",\n              sort: null\n            },\n            y: {\n              type: \"quantitative\",\n              field: \"sum_top\"\n            }\n          }\n        }, {\n          mark: {\n            type: \"text\",\n            baseline: \"top\",\n            dy: 5,\n            fontWeight: \"bold\"\n          },\n          encoding: {\n            color: {\n              value: \"black\"\n            },\n            text: {\n              condition: {\n                type: \"nominal\",\n                field: \"bottom_label\",\n                test: \"abs(datum.log2_bayes_factor) > 1\"\n              },\n              value: \"\"\n            },\n            x: {\n              type: \"nominal\",\n              axis: {\n                labelAngle: 0,\n                title: \"Column\"\n              },\n              field: \"column_name\",\n              sort: null\n            },\n            y: {\n              type: \"quantitative\",\n              field: \"sum_bottom\"\n            }\n          }\n        }]\n      }, {\n        mark: {\n          type: \"rule\",\n          color: \"black\",\n          strokeWidth: 2,\n          x2Offset: 30,\n          xOffset: -30\n        },\n        encoding: {\n          x: {\n            type: \"nominal\",\n            axis: {\n              labelAngle: 0,\n              title: \"Column\"\n            },\n            field: \"column_name\",\n            sort: null\n          },\n          x2: {\n            field: \"lead\"\n          },\n          y: {\n            type: \"quantitative\",\n            axis: {\n              labelExpr: \"format(1 / (1 + pow(2, -1*datum.value)), '.2r')\",\n              orient: \"right\",\n              title: \"Probability\"\n            },\n            field: \"sum\",\n            scale: {\n              zero: false\n            }\n          }\n        }\n      }],\n      height: 450,\n      resolve: {\n        axis: {\n          y: \"independent\"\n        }\n      },\n      width: {\n        step: 75\n      },\n      $schema: \"https://vega.github.io/schema/vega-lite/v4.8.1.json\",\n      data: {\n        values: null\n      }\n    };\n  });\n  main.variable(observer(\"embed\")).define(\"embed\", [\"require\"], function (require) {\n    return require(\"vega-embed@6\");\n  });\n  main.variable(observer(\"bayes_factor_to_prob\")).define(\"bayes_factor_to_prob\", function () {\n    return function bayes_factor_to_prob(b) {\n      return b / (b + 1);\n    };\n  });\n  main.variable(observer(\"log2\")).define(\"log2\", function () {\n    return Math.log2;\n  });\n  main.variable(observer(\"prob_to_bayes_factor\")).define(\"prob_to_bayes_factor\", function () {\n    return function prob_to_bayes_factor(p) {\n      return p / (1 - p);\n    };\n  });\n  main.variable(observer(\"prob_to_log2_bayes_factor\")).define(\"prob_to_log2_bayes_factor\", [\"log2\", \"prob_to_bayes_factor\"], function (log2, prob_to_bayes_factor) {\n    return function prob_to_log2_bayes_factor(p) {\n      return log2(prob_to_bayes_factor(p));\n    };\n  });\n  main.variable(observer(\"log2_bayes_factor_to_prob\")).define(\"log2_bayes_factor_to_prob\", [\"bayes_factor_to_prob\"], function (bayes_factor_to_prob) {\n    return function log2_bayes_factor_to_prob(log2_b) {\n      return bayes_factor_to_prob(Math.pow(2, log2_b));\n    };\n  });\n  main.variable(observer(\"first_name_lookup\")).define(\"first_name_lookup\", [\"d3\"], function (d3) {\n    return d3.csv(\"https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/first_name_noyear.csv\", d3.autoType).then(function (csv_file) {\n      var lookup = {};\n      csv_file.forEach(function (row) {\n        lookup[row.firstname] = row.freq;\n      });\n      return lookup;\n    });\n  });\n  main.variable(observer(\"term_freqs\")).define(\"term_freqs\", [\"first_name_lookup\"], function (first_name_lookup) {\n    return {\n      first_name: first_name_lookup\n    };\n  });\n  return main;\n}","import _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6;\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n// https://observablehq.com/@robinl/interactive-fellegi-sunter-model@441\nimport define1 from \"./d25176b0fe784ad0@488.js\";\nimport define2 from \"./843cb6e82d7c3d9b@474.js\";\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer(\"title\")).define(\"title\", [\"md\"], function (md) {\n    return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Interactive probabilistic record linkage model\"])));\n  });\n  main.variable(observer(\"para_1\")).define(\"para_1\", [\"md\"], function (md) {\n    return md(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"Here we use a trained Fellegi-Sunter model to calculate match probabilities interactively.  \\n\\n\\u2728<span style=\\\"background-color:yellow\\\">You can edit the records in the table, and the match probability will be estimated.</span>\\u2728\"])));\n  });\n  main.variable(observer(\"table\")).define(\"table\", [\"html\"], function (html) {\n    return html(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\\n<table id=\\\"data-table\\\" >\\n\\n<tr>\\n\\n<th>First name</th>\\n<th>Middle name</th>\\n<th>Surname</th>\\n<th>DOB</th>\\n<th>Postcode</th>\\n\\n</tr>\\n<tr contenteditable>\\n\\n<td>Mary</td>\\n<td>Emma</td>\\n<td>Smith</td>\\n<td>1990-01-01</td>\\n<td>SW1A 1AA</td>\\n\\n</tr>\\n<tr contenteditable>\\n\\n<td>Mary</td>\\n<td>Emma</td>\\n<td>Smith</td>\\n<td>1990-01-01</td>\\n<td>SW1A 1AA</td>\\n</tr>\\n\\n</table>\\n\"])));\n  });\n  main.variable(observer(\"estimated_probability\")).define(\"estimated_probability\", [\"html\", \"match_prob\"], function (html, match_prob) {\n    return html(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"<h3 style=\\\"font-family:Helvetica,Arial,Sans-Serif\\\">Estimated match probability = <span style=\\\"background-color:yellow\\\">\", \"%</h3>\"])), match_prob);\n  });\n  main.variable(observer(\"para_2\")).define(\"para_2\", [\"md\"], function (md) {\n    return md(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"The charts shows how the match probability was calculated:\"])));\n  });\n  main.variable(observer(\"viewof show_complex\")).define(\"viewof show_complex\", [\"inputs\"], function (inputs) {\n    return inputs.toggle({\n      label: \"Show details in waterfall chart\"\n    });\n  });\n  main.variable(observer(\"show_complex\")).define(\"show_complex\", [\"Generators\", \"viewof show_complex\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"waterfall_chart\")).define(\"waterfall_chart\", [\"get_waterfall_chart\", \"df_gammas\", \"splink_settings\", \"overrides\", \"show_complex\", \"term_freqs\"], function (get_waterfall_chart, df_gammas, splink_settings, overrides, show_complex, term_freqs) {\n    return get_waterfall_chart(df_gammas.objects()[0], splink_settings, overrides, !show_complex, term_freqs);\n  });\n  main.variable(observer(\"notes\")).define(\"notes\", [\"md\"], function (md) {\n    return md(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"## Notes\\n\\n- Accounts for term frequencies for the name fields, _using recent data_.  This means 'John' is no longer a common name, but 'Oliver' is.  For names not in the lookup, an average value is used.\\n\\n\"])));\n  });\n  main.variable(observer(\"match_prob\")).define(\"match_prob\", [\"get_match_probability\", \"df_gammas\", \"splink_settings\", \"term_freqs\"], function (get_match_probability, df_gammas, splink_settings, term_freqs) {\n    var prob = get_match_probability(df_gammas.objects()[0], splink_settings, term_freqs);\n    return (prob * 100).toPrecision(4);\n  });\n  main.variable(observer(\"tableData\")).define(\"tableData\", [\"Generators\", \"parseTableData\", \"table\"], function (Generators, parseTableData, table) {\n    return Generators.observe(function (notify) {\n      var keyinput = function keyinput(event) {\n        return notify(parseTableData(table));\n      };\n\n      table.addEventListener(\"input\", keyinput, false);\n      notify(parseTableData(table));\n      return function () {\n        return window.removeEventListener(\"input\", keyinput);\n      };\n    });\n  });\n  main.variable(observer(\"parseTableData\")).define(\"parseTableData\", function () {\n    return function parseTableData(table) {\n      var data = [];\n      table.querySelectorAll(\"tr\").forEach(function (row, i) {\n        var cells = row.cells;\n        var row_data = [];\n\n        var _iterator = _createForOfIteratorHelper(cells),\n            _step;\n\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var cell = _step.value;\n            var value = cell.innerText;\n            value = value.trim();\n            value = value.toLowerCase();\n\n            if (value == \"\") {\n              value = null;\n            }\n\n            row_data.push(value);\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n\n        data.push(row_data);\n      });\n      var formattedData = data.reduce(function (accumulator, row, i) {\n        if (i == 0) {\n          accumulator.properties = row;\n        } else {\n          var rowObject = {};\n          rowObject[\"uid\"] = i;\n          accumulator.properties.forEach(function (key, i) {\n            rowObject[key] = row[i];\n          });\n          accumulator.push(rowObject);\n        }\n\n        return accumulator;\n      }, []);\n      return formattedData;\n    };\n  });\n  var child1 = runtime.module(define1);\n  main.import(\"get_df_gammas\", child1);\n  main.import(\"get_df_e\", child1);\n  main.import(\"get_df_comparison\", child1);\n  main.import(\"get_match_probability\", child1);\n  main.variable(observer(\"df_e\")).define(\"df_e\", [\"get_df_e\", \"df_gammas\", \"splink_settings\"], function (get_df_e, df_gammas, splink_settings) {\n    return get_df_e(df_gammas, splink_settings);\n  });\n  main.variable(observer(\"df_gammas\")).define(\"df_gammas\", [\"get_df_gammas\", \"df_comparison\", \"splink_settings\"], function (get_df_gammas, df_comparison, splink_settings) {\n    return get_df_gammas(df_comparison, splink_settings);\n  });\n  main.variable(observer(\"df_comparison\")).define(\"df_comparison\", [\"get_df_comparison\", \"records_l\", \"records_r\"], function (get_df_comparison, records_l, records_r) {\n    return get_df_comparison(records_l, records_r);\n  });\n  main.variable(observer(\"records_l\")).define(\"records_l\", [\"rename_dict_keys\", \"tableData\"], function (rename_dict_keys, tableData) {\n    return [rename_dict_keys(tableData[0])];\n  });\n  main.variable(observer(\"records_r\")).define(\"records_r\", [\"rename_dict_keys\", \"tableData\"], function (rename_dict_keys, tableData) {\n    return [rename_dict_keys(tableData[1])];\n  });\n  main.variable(observer(\"rename_dict_keys\")).define(\"rename_dict_keys\", function () {\n    return function rename_dict_keys(d) {\n      return {\n        uid: d[\"uid\"],\n        fname: d[\"first name\"],\n        mname: d[\"middle name\"],\n        sname: d[\"surname\"],\n        dob: d[\"dob\"],\n        pc: d[\"postcode\"]\n      };\n    };\n  });\n  main.variable(observer(\"fname_case_stmt\")).define(\"fname_case_stmt\", [\"dm_intersect\", \"distance\"], function (dm_intersect, distance) {\n    return function (row) {\n      if (row.fname_l === null || row.fname_r === null) {\n        return -1;\n      }\n\n      if (row.fname_l == row.fname_r) {\n        return 3;\n      }\n\n      if (dm_intersect(row.fname_l, row.fname_r)) {\n        return 2;\n      }\n\n      if (distance(row.fname_l, row.fname_r) > 0.85) {\n        return 1;\n      } else {\n        return 0;\n      }\n    };\n  });\n  main.variable(observer(\"mname_case_stmt\")).define(\"mname_case_stmt\", [\"dm_intersect\", \"distance\"], function (dm_intersect, distance) {\n    return function (row) {\n      if (row.mname_l === null || row.mname_r === null) {\n        return -1;\n      }\n\n      if (row.mname_l == row.mname_r) {\n        return 3;\n      }\n\n      if (dm_intersect(row.mname_l, row.mname_r)) {\n        return 2;\n      }\n\n      if (distance(row.mname_l, row.mname_r) > 0.85) {\n        return 1;\n      } else {\n        return 0;\n      }\n    };\n  });\n  main.variable(observer(\"sname_case_stmt\")).define(\"sname_case_stmt\", [\"dm_intersect\", \"distance\"], function (dm_intersect, distance) {\n    return function (row) {\n      if (row.sname_l === null || row.sname_r === null) {\n        return -1;\n      }\n\n      if (row.sname_l == row.sname_r) {\n        return 3;\n      }\n\n      if (dm_intersect(row.sname_l, row.sname_r)) {\n        return 2;\n      }\n\n      if (distance(row.sname_l, row.sname_r) > 0.85) {\n        return 1;\n      } else {\n        return 0;\n      }\n    };\n  });\n  main.variable(observer(\"abs_date_diff_in_years\")).define(\"abs_date_diff_in_years\", function () {\n    return function (date_l, date_r) {\n      var d_l = new Date(date_l);\n      var d_r = new Date(date_r);\n      var divisor = 24 * 60 * 60 * 1000 * 365;\n      return Math.abs(d_l - d_r) / divisor;\n    };\n  });\n  main.variable(observer(\"dob_case_stmt\")).define(\"dob_case_stmt\", [\"levenshtein\", \"abs_date_diff_in_years\"], function (levenshtein, abs_date_diff_in_years) {\n    return function (row) {\n      if (row.dob_l === null || row.dob_r === null) {\n        return -1;\n      }\n\n      if (row.dob_l == row.dob_r && row.dob_l.slice(-5) == \"01-01\") {\n        return 4;\n      }\n\n      if (row.dob_l == row.dob_r) {\n        return 5;\n      }\n\n      if (levenshtein(row.dob_l, row.dob_r) <= 1) {\n        return 3;\n      }\n\n      if (abs_date_diff_in_years(row.dob_l, row.dob_r) < 1) {\n        return 2;\n      }\n\n      if (abs_date_diff_in_years(row.dob_l, row.dob_r) < 10) {\n        return 1;\n      } else {\n        return 0;\n      }\n    };\n  });\n  main.variable(observer(\"pc_case_stmt\")).define(\"pc_case_stmt\", function () {\n    return function (row) {\n      if (row.pc_l === null || row.pc_r === null) {\n        return -1;\n      }\n\n      if (row.pc_l == row.pc_r) {\n        return 5;\n      }\n\n      if (row.pc_l.slice(0, 3) == row.pc_r.slice(0, 3)) {\n        return 4;\n      } else {\n        return 0;\n      }\n    };\n  });\n  main.variable(observer(\"splink_settings\")).define(\"splink_settings\", [\"fname_case_stmt\", \"mname_case_stmt\", \"sname_case_stmt\", \"dob_case_stmt\", \"pc_case_stmt\"], function (fname_case_stmt, mname_case_stmt, sname_case_stmt, dob_case_stmt, pc_case_stmt) {\n    return {\n      proportion_of_matches: 1 / 60e6,\n      comparison_columns: [{\n        num_levels: 4,\n        col_name: \"fname\",\n        u_probabilities: [0.9883897757902356, 0.004639565877697178, 0.002783859108435161, 0.004186799223632191],\n        m_probabilities: [0.013910835049471115, 0.03580070792581899, 0.0026304325373041827, 0.9431284756772805],\n        case_expression: fname_case_stmt\n      }, {\n        num_levels: 4,\n        col_name: \"mname\",\n        u_probabilities: [0.9883897757902356, 0.004639565877697178, 0.002783859108435161, 0.004186799223632191],\n        m_probabilities: [0.013910835049471115, 0.03580070792581899, 0.0026304325373041827, 0.9431284756772805],\n        case_expression: mname_case_stmt\n      }, {\n        num_levels: 4,\n        col_name: \"sname\",\n        u_probabilities: [0.9971958658858057, 0.0015765242689686637, 0.0003754879678726784, 0.0008521218773530913],\n        m_probabilities: [0.01809857679375992, 0.02769695651313621, 0.0014468181425986496, 0.9514336326024172],\n        case_expression: sname_case_stmt\n      }, {\n        col_name: \"dob\",\n        u_probabilities: [0.2807916467157474, 0.20073737664045227, 0.5164828418823143, 0.0019211842885877536, 9.766061108210657e-7, 6.597386678746452e-5],\n        m_probabilities: [0.00024675771766021674, 0.0017179728285089994, 0.009868620663422667, 0.023118927215599792, 0.0036827860949234354, 0.9571689718277999],\n        case_expression: dob_case_stmt\n      }, {\n        col_name: \"pc\",\n        u_probabilities: [0.6751190264364737, 0.22792766449447727, 0.09517523421356786, 1.7091033037790942e-6, 0.0017755009047047013, 8.648474727307328e-7],\n        m_probabilities: [0.18962646163517627, 0.02145498887358967, 0.4023991769621992, 0.11064711462002584, 0.07144100324386156, 0.20090472079462598],\n        case_expression: pc_case_stmt\n      }]\n    };\n  });\n  main.variable(observer(\"overrides\")).define(\"overrides\", function () {\n    return {\n      title: {\n        text: \"Match weights and their cumulative contribution to match probability\",\n        subtitle: \"\"\n      },\n      height: 200\n    };\n  });\n  var child2 = runtime.module(define2);\n  main.import(\"get_waterfall_chart\", child2);\n  main.variable(observer(\"dm\")).define(\"dm\", [\"require\"], function (require) {\n    return require(\"https://bundle.run/double-metaphone@2.0.0\");\n  });\n  main.variable(observer(\"distance\")).define(\"distance\", [\"require\"], function (require) {\n    return require(\"jaro-winkler@0.2.8/index.js\");\n  });\n  main.variable(observer(\"dm_intersect\")).define(\"dm_intersect\", [\"dm\"], function (dm) {\n    return function dm_intersect(val_l, val_r) {\n      var arr_l = dm.doubleMetaphone(val_l);\n      var arr_r = dm.doubleMetaphone(val_r);\n      return arr_l.filter(function (value) {\n        return arr_r.includes(value);\n      }).length > 0;\n    };\n  });\n  main.variable(observer(\"first_name_lookup\")).define(\"first_name_lookup\", [\"d3\"], function (d3) {\n    return d3.csv(\"https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/first_name_noyear.csv\", d3.autoType).then(function (csv_file) {\n      var lookup = {};\n      csv_file.forEach(function (row) {\n        lookup[row.firstname] = row.freq;\n      });\n      return lookup;\n    });\n  });\n  main.variable(observer(\"surname_lookup\")).define(\"surname_lookup\", [\"d3\"], function (d3) {\n    return d3.csv(\"https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/last_name.csv\", d3.autoType).then(function (csv_file) {\n      var lookup = {};\n      csv_file.forEach(function (row) {\n        lookup[row.surname] = row.freq;\n      });\n      return lookup;\n    });\n  });\n  main.variable(observer(\"term_freqs\")).define(\"term_freqs\", [\"first_name_lookup\", \"surname_lookup\"], function (first_name_lookup, surname_lookup) {\n    return {\n      fname: first_name_lookup,\n      mname: first_name_lookup,\n      sname: surname_lookup\n    };\n  });\n  main.variable(observer(\"levenshtein\")).define(\"levenshtein\", function () {\n    return function (a, b) {\n      if (a.length == 0) return b.length;\n      if (b.length == 0) return a.length;\n      var matrix = []; // increment along the first column of each row\n\n      var i;\n\n      for (i = 0; i <= b.length; i++) {\n        matrix[i] = [i];\n      } // increment each column in the first row\n\n\n      var j;\n\n      for (j = 0; j <= a.length; j++) {\n        matrix[0][j] = j;\n      } // Fill in the rest of the matrix\n\n\n      for (i = 1; i <= b.length; i++) {\n        for (j = 1; j <= a.length; j++) {\n          if (b.charAt(i - 1) == a.charAt(j - 1)) {\n            matrix[i][j] = matrix[i - 1][j - 1];\n          } else {\n            matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, // substitution\n            Math.min(matrix[i][j - 1] + 1, // insertion\n            matrix[i - 1][j] + 1)); // deletion\n          }\n        }\n      }\n\n      return matrix[b.length][a.length];\n    };\n  });\n  main.variable(observer(\"d3\")).define(\"d3\", [\"require\"], function (require) {\n    return require(\"d3@6\");\n  });\n  main.variable(observer(\"inputs\")).define(\"inputs\", [\"require\"], function (require) {\n    return require(\"@observablehq/inputs\");\n  });\n  return main;\n}","import React from 'react'\nimport define from \"@robinl/interactive-fellegi-sunter-model\"\nimport ProbLinkagePage from \"../components/prob_linkage_page\"\nimport { css } from \"@emotion/core\"\n\nexport const frontmatter = {\n    title: \"Interactive probabilistic record linkage model\",\n    post_date: \"2021-05-17\",\n    code_url: \"https://observablehq.com/@robinl/interactive-fellegi-sunter-model\",\n    post_type: \"obs\",\n    post_category: \"probabilistic_linkage\",\n    description: \"A live, interactive, explorable probabilistic record linkage (Fellegi Sunter) model\"\n}\n\nlet output_order = [\n    \"title\",\n    \"para_1\",\n    \"table\",\n    \"estimated_probability\",\n    \"para_2\",\n    \"viewof show_complex\",\n    \"waterfall_chart\",\n    \"notes\",\n\n]\n\n\nconst css_override = css`\nmargin-left: auto;\nmargin-right: auto;\nwidth: 90%;\nmax-width: 800px;\ntable {font-size: 0.8rem;\n line-height: 1rem;\n}\n#output__table_1 {\n    margin-bottom:10px;\n}\n\n\n`\nexport default (props) => {\n\n    return (<ProbLinkagePage\n        define={define}\n        output_order={output_order}\n        post_frontmatter={frontmatter}\n        css={css_override}\n        current_path={props.path}\n    />)\n\n\n}"],"sourceRoot":""}