(self.webpackChunkgatsby_starter_hello_world=self.webpackChunkgatsby_starter_hello_world||[]).push([[948],{2465:function(e,n,t){"use strict";function a(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}t.d(n,{Z:function(){return a}})},1369:function(e,n,t){"use strict";t.d(n,{Z:function(){return f}});t(7294);var a=t(835),r=t(674),o=(t(5713),t(5444));var i={name:"mh6tuh",styles:"margin-top:1rem;margin-bottom:0.5rem;"},l={name:"gg4vpm",styles:"display:flex;justify-content:space-between;"},s=["/intro_to_probabilistic_linkage/","/maths_of_fellegi_sunter/","/visualising_fellegi_sunter/","/understanding_match_weights/","/match_weight_dependencies/","/m_u_generator/"],m=function(e){var n=e.current_path,t=s.indexOf(n),a=s[t-1],m=s[t+1];return a=void 0===a?(0,r.tZ)("div",null):(0,r.tZ)("div",null,(0,r.tZ)(o.rU,{to:a}," < Previous article")),m=void 0===m?(0,r.tZ)("div",null):(0,r.tZ)("div",null,(0,r.tZ)(o.rU,{to:m}," Next article >")),(0,r.tZ)("div",null,(0,r.tZ)("hr",{css:i}),(0,r.tZ)("div",{css:l},a,(0,r.tZ)("div",null,(0,r.tZ)(o.rU,{to:"/probabilistic_linkage"},"Probabilistic linkage home")),m))},c=t(5802),u=t(7414),_=t(6140);var f=function(e){var n=(0,r.tZ)(c.Z,{define:e.define,output_order:e.output_order});return(0,r.tZ)(a.Z,{css:e.className},(0,r.tZ)(_.Z,{title:e.post_frontmatter.title,description:e.post_frontmatter.description}),(0,r.tZ)(u.Z,{post_frontmatter:e.post_frontmatter}),n,(0,r.tZ)(m,{current_path:e.current_path}))}},2857:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return bn},frontmatter:function(){return _n}});t(7294);var a,r,o,i,l,s=t(6156),m=t(2465);function c(e,n){var t=e.module();return t.variable(n()).define(["md"],(function(e){return e(a||(a=(0,m.Z)(["# Treemap for Bayes Intuition"])))})),t.variable(n("viewof settings_raw")).define("viewof settings_raw",["inputs","default_settings"],(function(e,n){return e.textarea({value:n,rows:29})})),t.variable(n("settings_raw")).define("settings_raw",["Generators","viewof settings_raw"],(function(e,n){return e.input(n)})),t.variable(n("viewof max_depth_1")).define("viewof max_depth_1",["settings","inputs"],(function(e,n){var t=e.comparison_columns.length;return n.range([0,t],{step:1,label:"How many columns to take account of?"})})),t.variable(n("max_depth_1")).define("max_depth_1",["Generators","viewof max_depth_1"],(function(e,n){return e.input(n)})),t.variable(n()).define(["md"],(function(e){return e(r||(r=(0,m.Z)(["In the following diagram, the outermost rectangle represents the space all pairwise record comparisons.  \n\nThis can then be recursively split into subsets, beginning with spliting between record pairs that match and those that do not match, then further splitting these rectangles based on comparisons of the values in columns.\n"])))})),t.variable(n()).define(["plot_treemap","settings","max_depth_1"],(function(e,n,t){return e(n,t,600)})),t.variable(n("plot_treemap")).define("plot_treemap",["generate_treemap_data","treemap","html","d3","width","DOM","box_html"],(function(e,n,t,a,r,i,l){return function(s,c,u){var _=e(s),f=n(_,u),d=t(o||(o=(0,m.Z)(['<div class="treemap_container">']))),b=a.select(d).append("div").attr("class","svg-tooltip").style("position","absolute").style("display","inline-block").style("visibility","hidden").attr("pointer-events","none"),p=a.select(d).append("svg").attr("height",u).attr("width",r),h=a.filter(f,(function(e){return e.depth<=c+1}));h=a.group(h,(function(e){return e.height}));var v=p.selectAll("g").data(h).join("g").selectAll("g").data((function(e){return e[1]})).join("g").attr("transform",(function(e){return"translate(".concat(e.x0,",").concat(e.y0,")")}));return v.append("rect").attr("id",(function(e){return(e.nodeUid=i.uid("node")).id})).attr("width",(function(e){return e.x1-e.x0})).attr("height",(function(e){return e.y1-e.y0})).attr("stroke-width","1px").attr("stroke","black").attr("fill",(function(e){if(e.depth==c+1)return a.rgb(e.data.colour);var n=a.rgb(e.data.colour);return"#ffffff"!=n.hex()&&(1==e.depth?n.opacity=.3:n.opacity=0),n})),v.append("foreignObject").attr("pointer-events","none").attr("width",(function(e){return e.x1-e.x0})).attr("height",(function(e){return e.y1-e.y0})).attr("xmlns","http://www.w3.org/1999/xhtml").append("xhtml:div").attr("class","wrap-info").append("div").html((function(e){return l(e,c)})),v.filter((function(e){return e.children})).selectAll("tspan").attr("dx",3).attr("y",13),v.filter((function(e){return!e.children})).selectAll("tspan").attr("x",3).attr("y",(function(e,n,t){return"".concat(.3*(n===t.length-1)+1.1+.9*n,"em")})),p.selectAll("rect").on("mouseover",(function(e){return b.style("visibility","visible")})).on("mousemove",(function(e){var n,t,o=a.select(this).datum(),i=l(o,c);b.html(i);b.node().getBoundingClientRect().height;var s=b.node().getBoundingClientRect().width;n=e.offsetY+10+"px",t=r-e.layerX>s?e.offsetX+10+"px":e.offsetX-s-10+"px";var m="visible";return""==i&&(m="hidden"),b.style("top",n).style("left",t).style("visibility",m)})).on("click",(function(e){console.log("height: ".concat(u)),console.log("event.layerY: ".concat(e.layerY))})).on("mouseout",(function(){return b.style("visibility","hidden")})),d}})),t.variable(n("add_children_from_column")).define("add_children_from_column",["children_to_add"],(function(e){return function n(t,a,r){if("children"in t)t.children.forEach((function(e){n(e,a,r)}));else{var o=e(a,t,r);t.children=o}delete t.value}})),t.variable(n("children_to_add")).define("children_to_add",["color_match","color_non_match","d3"],(function(e,n,t){return function(a,r,o){var i,l,s=[];return o?(i=a.m_probabilities,l=e):(i=a.u_probabilities,l=n),i.forEach((function(e,n){var o="gamma_"+a.col_name+" = "+n,i={name:o,name_list:r.name_list.concat(o),value:r.value*e,prob:e,prob_list:r.prob_list.concat(e)};a.gamma_value==n&&r.colour==l?i.colour=l:i.colour=t.rgb(255,255,255),s.push(i)})),s}})),t.variable(n("generate_treemap_data")).define("generate_treemap_data",["d3","color_match","color_non_match","add_children_from_column"],(function(e,n,t,a){return function(r){var o=r.proportion_of_matches,i={name:"All comparisons",name_list:[],prob_list:[],prob:1,colour:e.rgb(255,255,255),children:[{name:"matches",name_list:["match"],prob_list:[o],prob:o,value:o,colour:n},{name:"non-match",name_list:["non-match"],prob_list:[1-o],prob:1-o,value:1-o,colour:t}]},l=i.children[0],s=i.children[1];return r.comparison_columns.forEach((function(e,n){a(l,e,!0),a(s,e,!1)})),i}})),t.variable(n("box_html")).define("box_html",["format_perc","html"],(function(e,n){return function(t,a){var r=t.data.name_list,o=t.data.prob_list,l=r.map((function(e,n){return[e,o[n]]})).map((function(n){return"<p>".concat(n[0]," (").concat(e(n[1]),")")})).join(" and "),s=o.reduce((function(e,n){return e*n}),1);l+="<p>Proportion of all comparisons: ".concat(e(s));var c=n(i||(i=(0,m.Z)(["",""])),l);return t.depth==a+1?c.innerHTML:""}})),t.variable(n("settings")).define("settings",["settings_raw"],(function(e){return JSON.parse(e)})),t.variable(n("styles")).define("styles",["html"],(function(e){return e(l||(l=(0,m.Z)(["\n<style>\n.wrap-info {\n  padding: 5px;\n  font-family: monospace;\n  font-size: 0.6em;\n  line-height: 1.3em;\n}\n.wrap-info p {\n  margin-top: 0px;\n  margin-bottom: 0.1rem;\n  \n}\ntextarea {\n    max-height: 1000em !important\n}\n\n.svg-tooltip {\n\n    background: rgba(69,77,93,.9);\n    border-radius: .1rem;\n    color: #fff;\n    display: inline-block;\n    max-width: 500px;\n    padding: .2rem .4rem;\n    position: absolute;\n    text-overflow: ellipsis;\n    white-space: pre;\n    z-index: 300;\n    visibility: hidden;\n  }\n\n.svg-tooltip p {\nfont-family: sans-serif;\n    padding: 0;\n    margin: 0.2rem;\n      font-size: 0.8em;\n    line-height: 1.0em;\n  }\n</style>"])))})),t.variable(n("treemap")).define("treemap",["d3","width"],(function(e,n){return function(t,a){return e.treemap().tile(e.treemapSquarify).size([n,a]).paddingOuter(5).paddingTop(5).paddingInner(5).round(!0)(e.hierarchy(t).sum((function(e){return e.value})).sort((function(e,n){return n.value-e.value})))}})),t.variable(n("default_settings")).define("default_settings",(function(){return'{\n    "proportion_of_matches": 0.4,\n    "comparison_columns": [\n        {\n            "col_name": "fname",\n            "m_probabilities": [0.25, 0.75],\n            "u_probabilities": [0.7,  0.3],\n            "gamma_value": 1\n        },\n        {\n            "col_name": "sname",\n            "m_probabilities": [0.2, 0.8],\n            "u_probabilities": [0.8,  0.2],\n            "gamma_value": 0\n        },\n        {\n            "col_name": "dob",\n            "m_probabilities": [0.2, 0.8],\n            "u_probabilities": [0.8,  0.2],\n            "gamma_value": 1\n        },\n        {\n            "col_name": "town",\n            "m_probabilities": [0.2, 0.8],\n            "u_probabilities": [0.8,  0.2],\n            "gamma_value": 1\n        }\n    ]\n}'})),t.variable(n("format_perc")).define("format_perc",["d3"],(function(e){return e.format(".1%")})),t.variable(n("colours")).define("colours",["d3"],(function(e){return e.scaleOrdinal(e.schemeCategory10)})),t.variable(n("color_match")).define("color_match",["d3","colours"],(function(e,n){return e.rgb(n(2)).brighter(2.5)})),t.variable(n("color_non_match")).define("color_non_match",["d3","colours"],(function(e,n){return e.rgb(n(1)).brighter(1.5)})),t.variable(n("d3")).define("d3",["require"],(function(e){return e("d3@6")})),t.variable(n("inputs")).define("inputs",["require"],(function(e){return e("@observablehq/inputs")})),t.variable(n()).define((function(){return"Links:\n\nx times more likely: \nhttps://betterexplained.com/articles/understanding-bayes-theorem-with-ratios/\nhttps://rss.onlinelibrary.wiley.com/doi/pdf/10.1111/j.1740-9713.2006.00204.x\n\nOdds are not quite the same as bayes factors:  https://ocw.mit.edu/courses/mathematics/18-05-introduction-to-probability-and-statistics-spring-2014/readings/MIT18_05S14_Reading12b.pdf\n\nhttps://cran.r-project.org/web/packages/BayesFactor/vignettes/odds_probs.html#:~:text=The%20Bayes%20factor%20represents%20the,are%20what%20are%20being%20changed.&text=Further%2C%20these%20odds%20can%20be,models%20sum%20to%20known%20probability.\nThe Bayes factor represents the relative evidence between two models – that is, the change in the model odds due to the data – but the odds are what are being changed. \n\n\nhttps://bookdown.org/kevin_davisross/bayesian-reasoning-and-methods/bayes-factor.html\nRepresenting bayes theorem using bf\n\n"})),t}var u,_,f,d,b,p,h,v,g,w,y,x,Z,k,q,j,O,P,T,S,A,E,B,C,F,W,M,z,I,D,G,L,K,$,H,N,R,V,J,U,Y,X,Q,ee,ne,te,ae,re,oe,ie,le,se,me,ce,ue,_e,fe,de,be,pe,he,ve,ge,we,ye,xe,Ze,ke,qe,je,Oe,Pe,Te,Se,Ae,Ee,Be,Ce,Fe,We,Me,ze,Ie,De,Ge,Le,Ke,$e,He,Ne,Re,Ve,Je,Ue,Ye,Xe=t(2137),Qe=t(7757),en=t.n(Qe);function nn(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function tn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?nn(Object(t),!0).forEach((function(n){(0,s.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):nn(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function an(e,n){var t=e.module();return t.variable(n()).define(["md"],(function(e){return e(u||(u=(0,m.Z)(['# Arquero\n\nArquero is a library for query processing and transformation of array-backed data tables. Following the [relational algebra](https://en.wikipedia.org/wiki/Relational_algebra) and inspired by the design of [dplyr](https://dplyr.tidyverse.org/), Arquero provides a fluent API for manipulating column-oriented data frames. Arquero supports a range of data transformation tasks, including filter, sample, aggregation, window, join, and reshaping operations. Arquero is Spanish for "archer": if datasets are [arrows](https://observablehq.com/@theneuralbit/introduction-to-apache-arrow), Arquero helps their aim stay true.'])))})),t.variable(n()).define(["md"],(function(e){return e(_||(_=(0,m.Z)(["Import Arquero and extend it to print HTML tables in Observable:"])))})),t.variable(n("aq")).define("aq",["require","aq_version","aq_packages","toView"],function(){var e=(0,Xe.Z)(en().mark((function e(n,t,a,r){var o;return en().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n("arquero@".concat(t));case 2:return o=e.sent,e.next=5,Promise.all(a.map((function(e){return n(e)})));case 5:return e.sent.forEach((function(e){return o.addPackage(e)})),o.addTableMethod("view",r,{override:!0}),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})));return function(n,t,a,r){return e.apply(this,arguments)}}()),t.variable(n("aq_version")).define("aq_version",(function(){return"4.2.0"})),t.variable(n("aq_packages")).define("aq_packages",(function(){return[]})),t.variable(n()).define(["md"],(function(e){return e(f||(f=(0,m.Z)(["Export a global reference to Arquero operations:"])))})),t.variable(n("op")).define("op",["aq"],(function(e){return e.op})),t.variable(n()).define(["md"],(function(e){return e(d||(d=(0,m.Z)(["To use the same setup in your own notebooks, add a cell with the following code:\n~~~ js\nimport { aq, op } from '@uwdata/arquero'\n~~~\n"])))})),t.variable(n()).define(["md"],(function(e){return e(b||(b=(0,m.Z)(["To get started, see the [Introducing Arquero](https://observablehq.com/@uwdata/introducing-arquero) and [Arquero Cookbook](https://observablehq.com/@uwdata/arquero-cookbook) notebooks."])))})),t.variable(n()).define(["md"],(function(e){return e(p||(p=(0,m.Z)(["To use Arquero outside of Observable, see [https://github.com/uwdata/arquero](https://github.com/uwdata/arquero)."])))})),t.variable(n()).define(["md"],(function(e){return e(h||(h=(0,m.Z)(["<hr>\n## Examples\n\nThe core abstractions in Arquero are *data tables*, which model each column as an array of values, and *verbs* that transform data and return new tables. Verbs are table methods, allowing method chaining for multi-step transformations. Though each table is unique, many verbs reuse the underlying columns to limit duplication.\n"])))})),t.variable(n()).define(["md"],(function(e){return e(v||(v=(0,m.Z)(["Average hours of sunshine per month, from [https://usclimatedata.com/](https://usclimatedata.com/):"])))})),t.variable(n("dt")).define("dt",["aq"],(function(e){return e.table({Seattle:[69,108,178,207,253,268,312,281,221,142,72,52],Chicago:[135,136,187,215,281,311,318,283,226,193,113,106],"San Francisco":[165,182,251,281,314,330,300,272,267,243,189,156]})})),t.variable(n()).define(["md"],(function(e){return e(g||(g=(0,m.Z)(["Sorted differences between Seattle and Chicago:"])))})),t.variable(n()).define(["dt","op"],(function(e,n){return e.derive({month:function(e){return n.row_number()},diff:function(e){return e.Seattle-e.Chicago}}).select("month","diff").orderby("month").view({height:400})})),t.variable(n()).define(["md"],(function(e){return e(w||(w=(0,m.Z)(["Is Seattle more correlated with San Francisco or Chicago?"])))})),t.variable(n()).define(["dt","op"],(function(e,n){return e.rollup({corr_sf:n.corr("Seattle","San Francisco"),corr_chi:n.corr("Seattle","Chicago")}).view()})),t.variable(n()).define(["md"],(function(e){return e(y||(y=(0,m.Z)(["Summary statistics per city, as output objects:"])))})),t.variable(n()).define(["dt","aq","op"],(function(e,n,t){return e.fold(n.all(),{as:["city","sun"]}).groupby("city").rollup({min:function(e){return t.min(e.sun)},max:function(e){return t.max(e.sun)},avg:function(e){return t.average(e.sun)},med:function(e){return t.median(e.sun)},skew:function(e){var n=e.sun;return(t.mean(n)-t.median(n))/t.stdev(n)||0}}).objects()})),t.variable(n()).define(["md"],(function(e){return e(x||(x=(0,m.Z)(["<hr>\n## Utilities\n"])))})),t.variable(n("toView")).define("toView",["html"],(function(e){var n=function(e){return'<span style="color: #999;">'.concat(e,"</span>")},t="margin: 0; border-collapse: collapse; width: initial;",a="padding: 1px 5px; white-space: nowrap; overflow-x: hidden; text-overflow: ellipsis; font-variant-numeric: tabular-nums;";return function(r){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"number"==typeof o&&(o={limit:o});var i=tn({},o.color);if("function"==typeof o.color)r.columnNames().forEach((function(e){return i[e]=o.color}));else{var l=function(e){var n=i[e];i[e]="function"==typeof n?n:function(){return n}};for(var s in i)l(s)}var c="".concat(t),u=function(e,n,t){return"".concat(a," max-width: ").concat(+o.maxCellWidth||300,"px;")+(i[e]?" background-color: ".concat(i[e](n,t),";"):"")};o=tn(tn({limit:100,null:n},o),{},{style:{table:c,td:u,th:u}});var _="max-height: ".concat(+o.height||270,"px"),f="".concat(_,"; overflow-x: auto; overflow-y: auto;"),d=e(Z||(Z=(0,m.Z)(['<div style="','">',"</div>"])),f,r.toHTML(o));return d.value=r,d}})),t}function rn(e,n){var t=e.module();t.variable(n()).define(["md"],(function(e){return e(k||(k=(0,m.Z)(["# Fellegi Sunter utils"])))})),t.variable(n("records_l")).define("records_l",(function(){return[{uid:"1_l",fname:"John",sname:"Smith",dob:"1989-03-02",town:"Bristol"},{uid:"2_l",fname:"Tom",sname:"Hanks",dob:"1956-07-09",town:"Concord"},{uid:"3_l",fname:"David",sname:"Smith",dob:"1981-08-21",town:"London"}]})),t.variable(n("records_r")).define("records_r",(function(){return[{uid:"1_r",fname:"Jonathan",sname:"Smith",dob:"1989-03-02",town:"Bristol"},{uid:"2_r",fname:"David",sname:"Smith",dob:"1981-08-21",town:"Peckham"}]})),t.variable(n("df_r")).define("df_r",["aq","records_r"],(function(e,n){return e.from(n)})),t.variable(n("splink_settings")).define("splink_settings",(function(){return{proportion_of_matches:.01,comparison_columns:[{num_levels:3,col_name:"fname",u_probabilities:[.8,.2],m_probabilities:[.2,.8],case_expression:function(e){return e.fname_l==e.fname_r?1:0}},{num_levels:3,col_name:"sname",u_probabilities:[.9,.1],m_probabilities:[.2,.8],case_expression:function(e){return e.sname_l==e.sname_r?1:0}},{col_name:"dob",u_probabilities:[.99,.01],m_probabilities:[.2,.8],case_expression:function(e){return e.dob_l==e.dob_r?1:0}},{col_name:"town",u_probabilities:[.7,.3],m_probabilities:[.3,.7],case_expression:function(e){return e.town_l==e.town_r?1:0}}]}})),t.variable(n("df_comparison")).define("df_comparison",["get_df_comparison","records_l","records_r"],(function(e,n,t){return e(n,t)})),t.variable(n()).define(["df_comparison"],(function(e){return e.view()})),t.variable(n("df_gammas")).define("df_gammas",["get_df_gammas","df_comparison","splink_settings"],(function(e,n,t){return e(n,t)})),t.variable(n()).define(["df_gammas"],(function(e){return e.view()})),t.variable(n()).define(["get_df_e","df_gammas","splink_settings","term_freqs"],(function(e,n,t,a){return e(n,t,a).view()})),t.variable(n("get_df_e")).define("get_df_e",["get_match_probability","aq"],(function(e,n){return function(t,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.objects().map((function(n){return n.match_probability=e(n,a,r),n})),i=n.from(o);return i=i.relocate(["match_probability"],{after:"uid_r"})}})),t.variable(n("get_match_probability")).define("get_match_probability",["prob_to_log2_bf","log2_bf_to_prob"],(function(e,n){return function(t,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=a.comparison_columns,i=e(a.proportion_of_matches),l=o.reduce((function(e,n){var a="𝛾_"+n.col_name,o=t[a];if(-1==o)return e;var i=n.m_probabilities[o],l=n.u_probabilities[o],s=t[n.col_name+"_l"].toLowerCase(),m=t[n.col_name+"_r"].toLowerCase();if(s==m&&n.col_name in r){var c=r[n.col_name],u=c[s]||0,_=c[m]||0,f=Math.max(u,_);f>0&&(l=f)}return e+Math.log2(i/l)}),i);return n(l)}})),t.variable(n("get_match_probability_components")).define("get_match_probability_components",["prob_to_log2_bf","log2_bf_to_prob"],(function(e,n){return function(t,a,r){null==r&&(r=a.comparison_columns.length);var o=a.comparison_columns.slice(0,r),i=e(a.proportion_of_matches),l={comparison_vector:[],gamma_symbols:[],m_values:[],u_values:[],m_symbols:[],u_symbols:[],bayes_factors:[],log2_bayes_factors:[],col_names:[],match_probability:null,lam:a.proportion_of_matches};o.forEach((function(e){var n="𝛾_"+e.col_name,a=t[n],r=e.m_probabilities[a],o=e.u_probabilities[a],i=e.col_name.replace("_","\\_");l.comparison_vector.push(a),l.gamma_symbols.push("\\gamma_\\text{".concat(i,"}")),l.col_names.push(n),l.m_values.push(r),l.m_symbols.push("m_{\\text{".concat(i,"},").concat(a,"}")),l.u_values.push(o),l.u_symbols.push("u_{\\text{".concat(i,"},").concat(a,"}")),l.bayes_factors.push(r/o),l.log2_bayes_factors.push(Math.log2(r/o))}));var s=l.log2_bayes_factors.reduce((function(e,n){return e+n}),i);l.match_probability=n(s);var m=a.proportion_of_matches;return l.size_of_match_portion=m*l.m_values.reduce((function(e,n){return e*n}),1),l.size_of_non_match_portion=(1-m)*l.u_values.reduce((function(e,n){return e*n}),1),l}})),t.variable(n("get_m_u_formula_numbers")).define("get_m_u_formula_numbers",["get_match_probability_components"],(function(e){return function(n,t,a){var r=e(n,t,a),o=r.m_values.map((function(e){return e.toPrecision(3)})),i=r.u_values.map((function(e){return e.toPrecision(3)})),l=r.lam.toPrecision(3),s=[l].concat(o),m=["(1 - ".concat(l,")")].concat(i),c=s.join(" \\times "),u=m.join(" \\times "),_=r.match_probability.toPrecision(3),f=r.size_of_match_portion.toPrecision(3),d=r.size_of_non_match_portion.toPrecision(3);return"\\frac{".concat(c,"}{(").concat(c,") + (").concat(u,")}  \\newline[10pt] = \\frac{").concat(f,"}{").concat(f," + ").concat(d,"}  \\newline[10pt] = ").concat(_)}})),t.variable(n("get_m_u_formula_symbols")).define("get_m_u_formula_symbols",["get_match_probability_components"],(function(e){return function(n,t){var a=e(n,t),r=a.m_symbols,o=a.u_symbols,i=(a.lam,["\\lambda"].concat(r)),l=["(1 - \\lambda)"].concat(o),s=i.join(" "),m=l.join(" ");return"\\frac{".concat(s,"}{").concat(s,") + ").concat(m,"}")}})),t.variable(n()).define(["tex","get_m_u_formula_symbols","df_gammas","splink_settings"],(function(e,n,t,a){return e(q||(q=(0,m.Z)(["","\n"])),n(t.objects()[0],a))})),t.variable(n("get_comparison_vector_symbols_and_numbers")).define("get_comparison_vector_symbols_and_numbers",["get_match_probability_components"],(function(e){return function(n,t,a){var r=e(n,t,a),o=r.gamma_symbols.join(", "),i=r.comparison_vector.join(", ");return"\\bm{\\gamma} = [".concat(o,"]= [").concat(i,"]")}})),t.variable(n()).define(["tex","get_comparison_vector_symbols_and_numbers","df_gammas","splink_settings"],(function(e,n,t,a){return e(j||(j=(0,m.Z)(["","\n"])),n(t.objects()[0],a))})),t.variable(n()).define(["tex"],(function(e){return e(O||(O=(0,m.Z)(["\bm{gamma} = [gamma_\text{fname}, gamma_\text{sname}]"],["\\bm{\\gamma} = [\\gamma_\\text{fname}, \\gamma_\\text{sname}]"])))})),t.variable(n()).define(["tex","get_m_u_formula_numbers","df_gammas","splink_settings"],(function(e,n,t,a){return e(P||(P=(0,m.Z)(["",""])),n(t.objects()[0],a))})),t.variable(n()).define(["get_match_probability_components","df_gammas","splink_settings"],(function(e,n,t){return e(n.objects()[0],t)})),t.variable(n("get_df_comparison")).define("get_df_comparison",["aq"],(function(e){return function(n,t){var a=e.from(n),r=e.from(t),o=a.join(r,(function(e,n){return!0}),null,{suffix:["_l","_r"]}),i=a.columnNames(),l=[];return i.forEach((function(e){l.push(e+"_l"),l.push(e+"_r")})),o=o.select(l)}})),t.variable(n("get_df_gammas")).define("get_df_gammas",["aq"],(function(e){return function(n,t){var a=t.comparison_columns,r=n.objects();a.forEach((function(e){r.forEach((function(n){n["𝛾_"+e.col_name]=e.case_expression(n)}))})),r=e.from(r);var o=["uid_l","uid_r"];return a.forEach((function(e){o.push(e.col_name+"_l"),o.push(e.col_name+"_r"),o.push("𝛾_"+e.col_name)})),r=r.select(o)}})),t.variable(n("bayes_factor_to_prob")).define("bayes_factor_to_prob",(function(){return function(e){return e/(e+1)}})),t.variable(n("log2_bf_to_prob")).define("log2_bf_to_prob",["bayes_factor_to_prob"],(function(e){return function(n){return e(Math.pow(2,n))}})),t.variable(n("prob_to_bayes_factor")).define("prob_to_bayes_factor",(function(){return function(e){return e/(1-e)}})),t.variable(n("prob_to_log2_bf")).define("prob_to_log2_bf",["prob_to_bayes_factor"],(function(e){return function(n){return Math.log2(e(n))}}));var a=e.module(an);return t.import("aq",a),t.import("op",a),t.variable(n("first_name_lookup")).define("first_name_lookup",["d3"],(function(e){return e.csv("https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/first_name_noyear.csv",e.autoType).then((function(e){var n={};return e.forEach((function(e){n[e.firstname]=e.freq})),n}))})),t.variable(n("surname_lookup")).define("surname_lookup",["d3"],(function(e){return e.csv("https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/last_name.csv",e.autoType).then((function(e){var n={};return e.forEach((function(e){n[e.surname]=e.freq})),n}))})),t.variable(n("term_freqs")).define("term_freqs",["first_name_lookup","surname_lookup"],(function(e,n){return{fname:e,sname:n}})),t.variable(n()).define(["term_freqs"],(function(e){return e.fname.joshua})),t.variable(n()).define(["term_freqs"],(function(e){return e.sname.linacre})),t}function on(e,n){var t=e.module();return t.variable(n()).define(["md"],(function(e){return e(T||(T=(0,m.Z)(["# Fellegi-Sunter visualisation interface"])))})),t.variable(n("my_interface")).define("my_interface",["inputs","tex","html"],(function(e,n,t){return function(a){var r=1==a.gamma_value?"match":"mismatch",o=e.radio(["match","mismatch"],{label:"Comparison of ".concat(a.col_name," is a:"),value:r}),i=e.range([0,1],{label:n(S||(S=(0,m.Z)(["u_\text{",",level_0}"],["u_\\text{",",level\\_0}"])),a.col_name),value:a.u_probabilities[0]}),l=e.range([0,1],{label:n(A||(A=(0,m.Z)(["u_\text{",",level_1}"],["u_\\text{",",level\\_1}"])),a.col_name),value:a.u_probabilities[1]}),s=e.range([0,1],{label:n(E||(E=(0,m.Z)(["m_\text{",",level_0}"],["m_\\text{",",level\\_0}"])),a.col_name),value:a.m_probabilities[0]}),c=e.range([0,1],{label:n(B||(B=(0,m.Z)(["m_\text{",",level_1}"],["m_\\text{",",level\\_1}"])),a.col_name),value:a.m_probabilities[1]}),u=t(C||(C=(0,m.Z)(["\n    <h4>Choose value and parameters for ","</h4>\n    ",'\n    <div class="container">\n      <div class="item-0">',"",'</div>\n      <div class="item-1">',"","</div>\n    </div>\n  "])),a.col_name,o,i,s,l,c),_=function(){return{col_name:a.col_name,gamma_value:o.querySelector("input").checked?1:0,u_probabilities:[i.value,l.value],m_probabilities:[s.value,c.value]}};return o.onclick=function(){console.log(o.value),u.value=_()},i.oninput=function(){l.value=1-i.value,u.value=_()},l.oninput=function(){i.value=1-l.value,u.value=_()},s.oninput=function(){c.value=1-s.value,u.value=_()},c.oninput=function(){s.value=1-c.value,u.value=_()},u.value=_(),u}})),t.variable(n("viewof fname_val")).define("viewof fname_val",["my_interface"],(function(e){return e({col_name:"fname",gamma_value:1,m_probabilities:[.3,.7],u_probabilities:[.75,.25]})})),t.variable(n("fname_val")).define("fname_val",["Generators","viewof fname_val"],(function(e,n){return e.input(n)})),t.variable(n()).define(["fname_val"],(function(e){return e})),t.variable(n("viewof sname_val")).define("viewof sname_val",["my_interface"],(function(e){return e({col_name:"sname",gamma_value:0,m_probabilities:[.2,.8],u_probabilities:[.85,.15]})})),t.variable(n("sname_val")).define("sname_val",["Generators","viewof sname_val"],(function(e,n){return e.input(n)})),t.variable(n("viewof dob_val")).define("viewof dob_val",["my_interface"],(function(e){return e({col_name:"dob",gamma_value:1,m_probabilities:[.2,.8],u_probabilities:[.8,.2]})})),t.variable(n("dob_val")).define("dob_val",["Generators","viewof dob_val"],(function(e,n){return e.input(n)})),t.variable(n("viewof town_val")).define("viewof town_val",["my_interface"],(function(e){return e({col_name:"town",gamma_value:1,m_probabilities:[.3,.7],u_probabilities:[.9,.1]})})),t.variable(n("town_val")).define("town_val",["Generators","viewof town_val"],(function(e,n){return e.input(n)})),t.variable(n("viewof lam")).define("viewof lam",["inputs","tex"],(function(e,n){return e.range([0,1],{label:n(F||(F=(0,m.Z)(["lambda"],["\\lambda"]))),value:.3})})),t.variable(n("lam")).define("lam",["Generators","viewof lam"],(function(e,n){return e.input(n)})),t.variable(n("splink_settings")).define("splink_settings",["lam","fname_val","sname_val","dob_val","town_val"],(function(e,n,t,a,r){return{proportion_of_matches:e,comparison_columns:[n,t,a,r]}})),t.variable(n("form_styles")).define("form_styles",["html"],(function(e){return e(W||(W=(0,m.Z)(["<style>.container {\n  display: flex;\nflex-wrap: wrap;\n  gap: 12px;\n}\n</style>\n"])))})),t.variable(n("inputs")).define("inputs",["require"],(function(e){return e("@observablehq/inputs")})),t}function ln(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function sn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ln(Object(t),!0).forEach((function(n){(0,s.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ln(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function mn(e,n){var t=e.module();t.variable(n("title")).define("title",["md"],(function(e){return e(M||(M=(0,m.Z)(["# Visualising the Fellegi Sunter model "])))})),t.variable(n()).define(["md"],(function(e){return e(z||(z=(0,m.Z)(["*A final version of this notebook can be viewed on my blog [here](https://www.robinlinacre.com/visualising_fellegi_sunter/).*"])))})),t.variable(n("para_1")).define("para_1",["md","texd"],(function(e,n){return e(I||(I=(0,m.Z)(["The [previous article](https://www.robinlinacre.com/maths_of_fellegi_sunter/) presented an implementation of the Fellegi Sunter model.  We showed that match probability could be represented by Equation 1 - which is reproduced below:\n","\n\n"])),n(D||(D=(0,m.Z)(["\noperatorname{Pr}(\text{records match}|gamma_{1},gamma_{2},ldots,gamma_{K})  \newline [10pt] = \frac{lambda m_{1ell}m_{2ell}ldots m_{Kell}}{lambda m_{1ell}m_{2ell}ldots m_{Kell}+ (1-lambda)u_{1ell}u_{1ell} ldots u_{Kell}} "],["\n\\operatorname{Pr}(\\text{records match}|\\gamma_{1},\\gamma_{2},\\ldots,\\gamma_{K})  \\newline [10pt] = \\frac{\\lambda m_{1\\ell}m_{2\\ell}\\ldots m_{K\\ell}}{\\lambda m_{1\\ell}m_{2\\ell}\\ldots m_{K\\ell}+ (1-\\lambda)u_{1\\ell}u_{1\\ell} \\ldots u_{K\\ell}} "]))))})),t.variable(n("para_2")).define("para_2",["md"],(function(e){return e(G||(G=(0,m.Z)(["This article presents a way to understand and visualise this formula."])))})),t.variable(n("para_3")).define("para_3",["md"],(function(e){return e(L||(L=(0,m.Z)(["In our visualisation, we are going to take each piece of evidence into account in turn. This is possible due to our assumption of conditional independence of comparison columns given the match status.\n\nThe means Equation 1 is equivalent to a repeated application of Bayes' Theorem (see annex). See [here](https://www.youtube.com/watch?v=HZGCoVF3YvM) is more in depth video about Bayes Theorem.\n"])))})),t.variable(n("para_4")).define("para_4",["md"],(function(e){return e(K||(K=(0,m.Z)(["## Example\n\nWe are going to compute match probability for a record comparison with the following comparison columns:\n\n- `fname` (first name)\n- `sname` (surname)\n- `dob` (date of birth)\n- `town` \n\n\nThe default parameter values are a bit unrealistic, but help make sure the diagrams are legible.\n"],["## Example\n\nWe are going to compute match probability for a record comparison with the following comparison columns:\n\n- \\`fname\\` (first name)\n- \\`sname\\` (surname)\n- \\`dob\\` (date of birth)\n- \\`town\\` \n\n\nThe default parameter values are a bit unrealistic, but help make sure the diagrams are legible.\n"])))})),t.variable(n("subhead_1")).define("subhead_1",["md"],(function(e){return e($||($=(0,m.Z)(["## Step 1"])))})),t.variable(n("para_5")).define("para_5",["md","m","nm","tex"],(function(e,n,t,a){return e(H||(H=(0,m.Z)(["We begin by visualising the space of all pairwise record comparisons, splitting the overall comparison space into "," and "," using our prior, ",""])),n(N||(N=(0,m.Z)(["matches"]))),t(R||(R=(0,m.Z)(["non-matches"]))),a(V||(V=(0,m.Z)(["operatorname{Pr}(\text{records match}) =  lambda"],["\\operatorname{Pr}(\\text{records match}) =  \\lambda"]))))})),t.variable(n("lam_view")).define("lam_view",["viewof lam"],(function(e){return e})),t.variable(n("treemap_1")).define("treemap_1",["plot_treemap","splink_settings"],(function(e,n){return e(n,0,300)})),t.variable(n("para_6")).define("para_6",["md","texd","color_match","color_non_match","splink_settings"],(function(e,n,t,a,r){return e(J||(J=(0,m.Z)(["Using only this information, our estimate of match probability is just the prior:\n\n","\n\n"])),n(U||(U=(0,m.Z)(["\text{match probability} =  \frac{lambda }{lambda + (1-lambda)}  \newline [10pt] = \frac{colorbox{","}{\text{yellow area}}}{colorbox{","}{\text{yellow area}} + colorbox{","}{\text{blue area}} }= "," "],["\\text{match probability} =  \\frac{\\lambda }{\\lambda + (1-\\lambda)}  \\newline [10pt] = \\frac{\\colorbox{","}{\\text{yellow area}}}{\\colorbox{","}{\\text{yellow area}} + \\colorbox{","}{\\text{blue area}} }= "," "])),t.hex(),t.hex(),a.hex(),r.proportion_of_matches.toPrecision(4)))})),t.variable(n("subhead_2")).define("subhead_2",["md"],(function(e){return e(Y||(Y=(0,m.Z)(["## Step 2 - First name"])))})),t.variable(n("para_7")).define("para_7",["md"],(function(e){return e(X||(X=(0,m.Z)(["We will now choose the parameters of the model for the first name field, and then take this information into account in the diagram."])))})),t.variable(n("fname_view")).define("fname_view",["viewof fname_val"],(function(e){return e})),t.variable(n("para_8")).define("para_8",["md","choice_text","splink_settings","dict_as_md_table_row","get_row_no_gammas","get_m_u_text","get_row","m","nm"],(function(e,n,t,a,r,o,i,l,s){return e(Q||(Q=(0,m.Z)([" ","\nAn example of the data would be:\n","\n\nAccording to the model parameters you've chosen:\n\n\n- ","\n- ","\n\n\n\nGiven this observation, we can subdivide the comparison space, and we know we must be in the "," or "," part of the following diagram:\n"])),n("fname",t),a(r(1)),o("fname",i(1),t,"m"),o("fname",i(1),t,"u"),l(ee||(ee=(0,m.Z)(["yellow"]))),s(ne||(ne=(0,m.Z)(["blue"]))))})),t.variable(n("treemap_2")).define("treemap_2",["plot_treemap","splink_settings"],(function(e,n){return e(n,1,300)})),t.variable(n("para_9")).define("para_9",["md","m","texd","color_match","color_non_match","tex","get_m_u_formula_numbers","get_row","splink_settings"],(function(e,n,t,a,r,o,i,l,s){return e(te||(te=(0,m.Z)([" What's the probability we're in the "," area?  This must be:\n\n","\n\nFrom this diagram we can see that the "," and the \n",".\n\nSo:\n\n","\n\nWhich, in numbers is:\n\n","\n"])),n(ae||(ae=(0,m.Z)(["yellow"]))),t(re||(re=(0,m.Z)(["\text{match probability} = \frac{colorbox{","}{\text{yellow area}}}{colorbox{","}{\text{yellow area}} + colorbox{","}{\text{blue area}} } "],["\\text{match probability} = \\frac{\\colorbox{","}{\\text{yellow area}}}{\\colorbox{","}{\\text{yellow area}} + \\colorbox{","}{\\text{blue area}} } "])),a.hex(),a.hex(),r.hex()),o(oe||(oe=(0,m.Z)(["colorbox{","}{$\text{yellow area} = lambda m_{1ell}$}"],["\\colorbox{","}{$\\text{yellow area} = \\lambda m_{1\\ell}$}"])),a.hex()),o(ie||(ie=(0,m.Z)(["colorbox{","}{$\text{blue area} = (1-lambda) u_{1ell}$}"],["\\colorbox{","}{$\\text{blue area} = (1-\\lambda) u_{1\\ell}$}"])),r.hex()),t(le||(le=(0,m.Z)(["\text{match probability} =  \frac{lambda m_{1ell}}{lambda m_{1ell}+ (1-lambda)u_{1ell}}"],["\\text{match probability} =  \\frac{\\lambda m_{1\\ell}}{\\lambda m_{1\\ell}+ (1-\\lambda)u_{1\\ell}}"]))),o(se||(se=(0,m.Z)(["",""])),i(l(2),s,1)))})),t.variable(n("subhead_3")).define("subhead_3",["md"],(function(e){return e(me||(me=(0,m.Z)(["## Step 3 - Surname"])))})),t.variable(n("para_10")).define("para_10",["md"],(function(e){return e(ce||(ce=(0,m.Z)(["Let's also choose parameters for `sname`, the surname field:"],["Let's also choose parameters for \\`sname\\`, the surname field:"])))})),t.variable(n("sname_view")).define("sname_view",["viewof sname_val"],(function(e){return e})),t.variable(n("para_11")).define("para_11",["md","choice_text","splink_settings","dict_as_md_table_row","get_row_no_gammas","get_m_u_text","get_row","m","nm"],(function(e,n,t,a,r,o,i,l,s){return e(ue||(ue=(0,m.Z)(["","\nAn example of the data would be:\n","\n\nAccording to the model parameters you've chosen:\n\n\n- ","\n- ","\n\n\n\nGiven this observation, we can subdivide the comparison space, and we know we must be in the "," or "," part of the following diagram:"])),n("sname",t),a(r(2)),o("sname",i(2),t,"m"),o("sname",i(2),t,"u"),l(_e||(_e=(0,m.Z)(["yellow"]))),s(fe||(fe=(0,m.Z)(["blue"]))))})),t.variable(n("treemap_3")).define("treemap_3",["plot_treemap","splink_settings"],(function(e,n){return e(n,2,300)})),t.variable(n("para_12")).define("para_12",["md","texd","color_match","color_non_match","get_m_u_formula_numbers","get_row","splink_settings"],(function(e,n,t,a,r,o,i){return e(de||(de=(0,m.Z)(["We now have:\n\n","\n\n","\n\nWhich, in numbers is:\n\n","\n"])),n(be||(be=(0,m.Z)(["\text{match probability} = \frac{colorbox{","}{\text{yellow area}}}{colorbox{","}{\text{yellow area}} + colorbox{","}{\text{blue area}} } "],["\\text{match probability} = \\frac{\\colorbox{","}{\\text{yellow area}}}{\\colorbox{","}{\\text{yellow area}} + \\colorbox{","}{\\text{blue area}} } "])),t.hex(),t.hex(),a.hex()),n(pe||(pe=(0,m.Z)(["= \frac{lambda m_{1ell}m_{2ell}}{lambda m_{1ell}m_{2ell}+ (1-lambda)u_{1ell}u_{2ell}}"],["= \\frac{\\lambda m_{1\\ell}m_{2\\ell}}{\\lambda m_{1\\ell}m_{2\\ell}+ (1-\\lambda)u_{1\\ell}u_{2\\ell}}"]))),n(he||(he=(0,m.Z)(["",""])),r(o(2),i,2)))})),t.variable(n("subhead_4")).define("subhead_4",["md"],(function(e){return e(ve||(ve=(0,m.Z)(["## Step 4 - Date of birth"])))})),t.variable(n("dob_view")).define("dob_view",["viewof dob_val"],(function(e){return e})),t.variable(n("para_13")).define("para_13",["md","choice_text","splink_settings","dict_as_md_table_row","get_row_no_gammas","get_m_u_text","get_row","m","nm"],(function(e,n,t,a,r,o,i,l,s){return e(ge||(ge=(0,m.Z)([" ","\nAn example of the data would be:\n","\n\nAccording to the model parameters you've chosen:\n\n\n- ","\n- ","\n\n\n\nGiven this observation, we can subdivide the comparison space, and we know we must be in the "," or "," part of the following diagram:\n"])),n("dob",t),a(r(3)),o("dob",i(3),t,"m"),o("dob",i(3),t,"u"),l(we||(we=(0,m.Z)(["yellow"]))),s(ye||(ye=(0,m.Z)(["blue"]))))})),t.variable(n("treemap_4")).define("treemap_4",["plot_treemap","splink_settings"],(function(e,n){return e(n,3,300)})),t.variable(n("para_14")).define("para_14",["md","texd","get_m_u_formula_numbers","get_row","splink_settings"],(function(e,n,t,a,r){return e(xe||(xe=(0,m.Z)(["We now have:\n\n","\n\n","\n"])),n(Ze||(Ze=(0,m.Z)(["\text{match probability} =  \frac{lambda m_{1ell}m_{2ell}m_{3ell}}{lambda m_{1ell}m_{2ell}m_{3ell}+ (1-lambda)u_{1ell}u_{2ell}u_{3ell}}"],["\\text{match probability} =  \\frac{\\lambda m_{1\\ell}m_{2\\ell}m_{3\\ell}}{\\lambda m_{1\\ell}m_{2\\ell}m_{3\\ell}+ (1-\\lambda)u_{1\\ell}u_{2\\ell}u_{3\\ell}}"]))),n(ke||(ke=(0,m.Z)(["",""])),t(a(3),r,3)))})),t.variable(n("subhead_5")).define("subhead_5",["md"],(function(e){return e(qe||(qe=(0,m.Z)(["## Step 5: Town"])))})),t.variable(n("town_view")).define("town_view",["viewof town_val"],(function(e){return e})),t.variable(n("para_15")).define("para_15",["md","choice_text","splink_settings","dict_as_md_table_row","get_row_no_gammas","get_m_u_text","get_row","m","nm"],(function(e,n,t,a,r,o,i,l,s){return e(je||(je=(0,m.Z)(["The final column is town.\n\n","\nAn example of the final data would be:\n","\n\nAccording to the model parameters you've chosen:\n\n\n- ","\n- ","\n\n\n\nGiven this observation, we can subdivide the comparison space, and we know we must be in the "," or "," part of the following diagram:\n"])),n("town",t),a(r(4)),o("town",i(4),t,"m"),o("town",i(4),t,"u"),l(Oe||(Oe=(0,m.Z)(["yellow"]))),s(Pe||(Pe=(0,m.Z)(["blue"]))))})),t.variable(n("treemap_5")).define("treemap_5",["plot_treemap","splink_settings"],(function(e,n){return e(n,4,300)})),t.variable(n("para_16")).define("para_16",["md","texd","tex","get_m_u_formula_numbers","get_row","splink_settings"],(function(e,n,t,a,r,o){return e(Te||(Te=(0,m.Z)(["The final match probability is therefore:\n\n","\n\nWhich, in numbers is:\n\n\n","\n"])),n(Se||(Se=(0,m.Z)(["\text{match probability} =  \frac{lambda m_{1ell}m_{2ell}m_{3ell}m_{4ell}}{lambda m_{1ell}m_{2ell}m_{3ell}m_{4ell}+ (1-lambda)u_{1ell}u_{2ell}u_{3ell}u_{4ell}}"],["\\text{match probability} =  \\frac{\\lambda m_{1\\ell}m_{2\\ell}m_{3\\ell}m_{4\\ell}}{\\lambda m_{1\\ell}m_{2\\ell}m_{3\\ell}m_{4\\ell}+ (1-\\lambda)u_{1\\ell}u_{2\\ell}u_{3\\ell}u_{4\\ell}}"]))),t(Ae||(Ae=(0,m.Z)(["",""])),a(r(4),o)))})),t.variable(n("annex")).define("annex",["md","tex","texd"],(function(e,n,t){return e(Ee||(Ee=(0,m.Z)(["## Annex:  Mathematical representation\n\nThis annex shows why it's possible to represent the calculation of match probability as a step-by-step computation.  \n\nIn particular, we will show that we can calculate match probability using a repeated application of Bayes Theorem.  In pseudocode, our algorithm will be:\n\n```\nprior = lambda\nfor col in compaison_columns:\n  posterior = bayes(col, prior)\n  prior = posterior\n```\n\n\nWhere the final value of the posterior is equal to ",".\n\nTo demonstrate why this works, consider equation 1, for the case of two columns:\n\n","\n\nWe start by applying Bayes Theorem once, accounting for the first comparison column:\n\n","\n\nThis posterior, ",", becomes the new prior, which we now use instead of lambda:\n","\n\nNote that:\n\n","\n\nBut "," shows that  the term "," appears on both top and bottom of "," and therefore cancels, leaving ","  as desired.\n\n"],["## Annex:  Mathematical representation\n\nThis annex shows why it's possible to represent the calculation of match probability as a step-by-step computation.  \n\nIn particular, we will show that we can calculate match probability using a repeated application of Bayes Theorem.  In pseudocode, our algorithm will be:\n\n\\`\\`\\`\nprior = lambda\nfor col in compaison_columns:\n  posterior = bayes(col, prior)\n  prior = posterior\n\\`\\`\\`\n\n\nWhere the final value of the posterior is equal to ",".\n\nTo demonstrate why this works, consider equation 1, for the case of two columns:\n\n","\n\nWe start by applying Bayes Theorem once, accounting for the first comparison column:\n\n","\n\nThis posterior, ",", becomes the new prior, which we now use instead of lambda:\n","\n\nNote that:\n\n","\n\nBut "," shows that  the term "," appears on both top and bottom of "," and therefore cancels, leaving ","  as desired.\n\n"])),n(Be||(Be=(0,m.Z)(["\noperatorname{Pr}(\text{records match}|gamma_{1},gamma_{2},ldots,gamma_{K})"],["\n\\operatorname{Pr}(\\text{records match}|\\gamma_{1},\\gamma_{2},\\ldots,\\gamma_{K})"]))),t(Ce||(Ce=(0,m.Z)(["\noperatorname{Pr}(\text{records match}|gamma_{1},gamma_{2}) = \frac{lambda m_{1ell}m_{2ell}}{lambda m_{1ell}m_{2ell}+ (1-lambda)u_{1ell}u_{1ell}} \tag{2.1}"],["\n\\operatorname{Pr}(\\text{records match}|\\gamma_{1},\\gamma_{2}) = \\frac{\\lambda m_{1\\ell}m_{2\\ell}}{\\lambda m_{1\\ell}m_{2\\ell}+ (1-\\lambda)u_{1\\ell}u_{1\\ell}} \\tag{2.1}"]))),t(Fe||(Fe=(0,m.Z)(["\noperatorname{Pr}(\text{records match}|gamma_{1}) = t = \frac{lambda m_{1ell}}{lambda m_{1ell}+ (1-lambda)u_{1ell}}"],["\n\\operatorname{Pr}(\\text{records match}|\\gamma_{1}) = t = \\frac{\\lambda m_{1\\ell}}{\\lambda m_{1\\ell}+ (1-\\lambda)u_{1\\ell}}"]))),n(We||(We=(0,m.Z)(["t"]))),t(Me||(Me=(0,m.Z)(["\n\text{posterior} = operatorname{Pr}(\text{records match}|gamma_{1},gamma_{2}) = \frac{t m_{2ell}}{t m_{2ell}+ (1-t)u_{2ell}}\tag{2.2}"],["\n\\text{posterior} = \\operatorname{Pr}(\\text{records match}|\\gamma_{1},\\gamma_{2}) = \\frac{t m_{2\\ell}}{t m_{2\\ell}+ (1-t)u_{2\\ell}}\\tag{2.2}"]))),t(ze||(ze=(0,m.Z)(["\n1- t = 1 - \frac{lambda m_{1ell}}{lambda m_{1ell}+ (1-lambda)u_{1ell}} = \frac{lambda m_{1ell}+ (1-lambda)u_{1ell} - lambda m_{1ell}}{lambda m_{1ell}+ (1-lambda)u_{1ell}} = \frac{(1-lambda)u_{1ell} }{lambda m_{1ell}+ (1-lambda)u_{1ell}}\tag{2.3}"],["\n1- t = 1 - \\frac{\\lambda m_{1\\ell}}{\\lambda m_{1\\ell}+ (1-\\lambda)u_{1\\ell}} = \\frac{\\lambda m_{1\\ell}+ (1-\\lambda)u_{1\\ell} - \\lambda m_{1\\ell}}{\\lambda m_{1\\ell}+ (1-\\lambda)u_{1\\ell}} = \\frac{(1-\\lambda)u_{1\\ell} }{\\lambda m_{1\\ell}+ (1-\\lambda)u_{1\\ell}}\\tag{2.3}"]))),n(Ie||(Ie=(0,m.Z)(["(2.3)"]))),n(De||(De=(0,m.Z)(["(lambda m_{1ell}+ (1-lambda)u_{1ell})"],["(\\lambda m_{1\\ell}+ (1-\\lambda)u_{1\\ell})"]))),n(Ge||(Ge=(0,m.Z)(["(2.2)"]))),n(Le||(Le=(0,m.Z)(["(2.1)"]))))})),t.variable(n("texd")).define("texd",["tex"],(function(e){return e.options({displayMode:!0,fleqn:!0})})),t.variable(n("css_styles")).define("css_styles",["html","color_match","color_non_match"],(function(e,n,t){return e(Ke||(Ke=(0,m.Z)(["<style>\n.katex-display>.katex { font-size: 1em}\n\n\ntextarea {\n    max-height: 1000em !important;\n    font-family: monospace !important;\n}\n\n.katex-display>.katex>.katex-html>.tag {right: unset; padding-left:4em}\n\n.hl_m {\nbackground-color: ",";\ndisplay:inline-block;\n}\n\n.hl_nm {\nbackground-color: ",";\ndisplay:inline-block;\n}\n\n</style>"])),n.hex(),t.hex())}));var a=e.module(c);t.import("default_settings",a),t.variable(n("get_row")).define("get_row",["splink_settings"],(function(e){return function(n){var t={},a={fname:[{fname_l:"John",fname_r:"Tom"},{fname_l:"John",fname_r:"John"}],sname:[{sname_l:"Smith",sname_r:"Hanks"},{sname_l:"Smith",sname_r:"Smith"}],dob:[{dob_l:"1989-03-02",dob_r:"1981-08-21"},{dob_l:"1989-03-02",dob_r:"1989-03-02"}],town:[{town_l:"Bristol",town_r:"Peckham"},{town_l:"Bristol",town_r:"Bristol"}]};return e.comparison_columns.slice(0,n).forEach((function(e){var n=a[e.col_name][e.gamma_value];t=sn(sn({},t),n);var r="𝛾_"+e.col_name;t[r]=e.gamma_value})),t}})),t.variable(n("get_row_no_gammas")).define("get_row_no_gammas",["get_row"],(function(e){return function(n){var t=e(n),a=Object.keys(t).filter((function(e){return!e.includes("𝛾_")})),r={};return a.forEach((function(e){r[e]=t[e]})),r}}));var r=e.module(rn);t.import("get_m_u_formula_symbols",r),t.import("get_m_u_formula_numbers",r),t.import("get_comparison_vector_symbols_and_numbers",r),t.import("get_match_probability_components",r),t.variable(n("dict_as_md_table_row")).define("dict_as_md_table_row",["md"],(function(e){return function(n){var t=Object.keys(n).join(" | "),a=Object.keys(n).map((function(e){return"-"})).join(" | "),r=Object.values(n).join(" | ");return e($e||($e=(0,m.Z)([""," \n "," \n "," \n"],[""," \\n "," \\n "," \\n"])),t,a,r)}}));var o=e.module(c);t.import("styles",o),t.import("plot_treemap",o),t.import("color_match",o),t.import("color_non_match",o),t.variable(n("additional_styles")).define("additional_styles",["styles"],(function(e){return e})),t.variable(n("nm")).define("nm",["html"],(function(e){return function(n){return e(He||(He=(0,m.Z)(['<span class="hl_nm">',"</span>"])),n)}})),t.variable(n("m")).define("m",["html"],(function(e){return function(n){return e(Ne||(Ne=(0,m.Z)(['<span class="hl_m">',"</span>"])),n)}}));var i=e.module(on);return t.import("splink_settings",i),t.import("viewof lam",i),t.import("lam",i),t.import("viewof fname_val",i),t.import("fname_val",i),t.import("viewof sname_val",i),t.import("sname_val",i),t.import("viewof dob_val",i),t.import("dob_val",i),t.import("viewof town_val",i),t.import("town_val",i),t.import("form_styles",i),t.variable(n("styles2")).define("styles2",["form_styles"],(function(e){return e})),t.variable(n("get_m_u_text")).define("get_m_u_text",["m","nm","md"],(function(e,n,t){return function(a,r,o,i){var l,s=o.comparison_columns.filter((function(e){return e.col_name==a}))[0],c=r["𝛾_"+a];1==c?l="matches":0==c&&(l="does not match");a.replace("_","\\_");var u,_="The column `".concat(a,"` ").concat(l),f=100*s["".concat(i,"_probabilities")][c];return f=parseFloat(f).toFixed(0)+"%",u="m"==i?e(Re||(Re=(0,m.Z)(["matching records"]))):n(Ve||(Ve=(0,m.Z)(["non-matching records"]))),t(Je||(Je=(0,m.Z)([""," in "," of ",""])),_,f,u)}})),t.variable(n("choice_text")).define("choice_text",["md","tex"],(function(e,n){return function(t,a){var r,o;a.comparison_columns.forEach((function(e){e.col_name==t&&(r=e)}));var i=r.gamma_value;return o=0==i?"does not match":"matches",e(Ue||(Ue=(0,m.Z)(["You have chosen that the column `","` ",", i.e. that "," = ","."],["You have chosen that the column \\`","\\` ",", i.e. that "," = ","."])),t,o,n(Ye||(Ye=(0,m.Z)(["gamma_\text{","}"],["\\gamma_\\text{","}"])),t),i)}})),t.variable(n("inputs")).define("inputs",["require"],(function(e){return e("@observablehq/inputs")})),t}var cn=t(1369),un=t(674);var _n={title:"Visualising the Fellegi Sunter model",post_date:"2021-05-07",code_url:"https://observablehq.com/@robinl/visualising-fellegi-sunter",post_type:"obs",post_category:"probabilistic_linkage",description:"An set of interactive, explorable explanations of the Fellegi Sunter model of probabilistic record linkage.  This article presents a way of visualising how the model works."},fn=["additional_styles","title","para_1","para_2","para_3","para_4","subhead_1","para_5","lam_view","treemap_1","para_6","subhead_2","para_7","fname_view","para_8","treemap_2","para_9","subhead_3","para_10","sname_view","para_11","treemap_3","para_12","subhead_4","dob_view","para_13","treemap_4","para_14","subhead_5","town_view","para_15","treemap_5","para_16","annex","additional_styles","styles2","css_styles"],dn={name:"1aymd26",styles:"margin-left:auto;margin-right:auto;width:90%;max-width:800px;table{font-size:0.8rem;line-height:1rem;}div{position:relative}.wrap-info{font-size:0.7rem;}rem;"},bn=function(e){return(0,un.tZ)(cn.Z,{define:mn,output_order:fn,post_frontmatter:_n,css:dn,current_path:e.path})}}}]);
//# sourceMappingURL=component---src-pages-visualising-fellegi-sunter-jsx-14b56f4d06a788c9c903.js.map