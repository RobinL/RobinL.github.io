{"version":3,"sources":["webpack://gatsby-starter-hello-world/./node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js","webpack://gatsby-starter-hello-world/./src/components/linkage_footer.jsx","webpack://gatsby-starter-hello-world/./src/components/prob_linkage_page.jsx","webpack://gatsby-starter-hello-world/./node_modules/@robinl/dependencies-between-match-weights/817db6818ab226c0@104.js","webpack://gatsby-starter-hello-world/./node_modules/@robinl/dependencies-between-match-weights/34fd4ef09fb0509a@2296.js","webpack://gatsby-starter-hello-world/./node_modules/@robinl/dependencies-between-match-weights/9547bc35da079fbb@158.js","webpack://gatsby-starter-hello-world/./src/pages/match_weight_dependencies.jsx"],"names":["_taggedTemplateLiteral","strings","raw","slice","Object","freeze","defineProperties","value","mar","flex","order_of_articles","props","path","current_path","this_index","indexOf","previous_article","next_article","undefined","to","css","post","define","output_order","className","title","post_frontmatter","description","_templateObject","_templateObject2","_templateObject3","_templateObject4","_templateObject5","_templateObject6","_templateObject7","_templateObject8","_templateObject9","_templateObject10","runtime","observer","main","module","variable","md","width","config","view","height","anchor","offset","header","hconcat","mark","text","fontWeight","encoding","row","type","field","sort","labelAngle","labelAnchor","labelAlign","x","axis","y","tooltip","format","color","resolve","scale","transform","filter","labels","data","values","subtitle","$schema","clip","selection","selector076","bind","encodings","range","domain","default_splink_settings","JSON","parse","get_chart_row","splink_settings","chart_data","comparison_columns","forEach","cc","a","b","map","k","i","m_u_pair","index","push","base_spec_m_u","chart_data_from_splink_settings","embed","splink_setttings","base_spec","stringify","lam","proportion_of_matches","concat","get_m_u_chart","settings_example","base_spec_bayes_factors","toPrecision","get_bayes_factor_chart","comparison_column","Math","log2","m_probabilities","length","require","inputs","label","step","G","_","input","m_u_input_control","starting_data","d3","axis_stretch_at_extremes","internal_height","scaleLinear","my_fn","squash","pow","log","root","multiple","offset_scale","in_values_not_normalised","num_points","d","ext","extent","normalise_scale","DOM","margin","splink_data_to_unstacked_data","unstacked_data_to_stacked","num_levels_to_level_keys","get_level_colours_scale","gen_x_scale","gen_y_scale","html","get_tick_vals","redraw","comparison_column_index","arguments","axis_compression_slider","axis_compression_start_value","comparison_col","num_levels","u_probabilities","node","svg","svg_outer","select","append","attr","left","top","unstacked_data","stacked_data","plot_data","m_u","level_keys","level_names","level_colours","internal_width","right","bottom","axis_slider","style","display","final_output","enclosed_data","on","inner","selectAll","join","key","classed","remove","thing","get_scale","get_drag","get_label","format_tick","e","slider","axis_stretch","match_status","bandwidth","call","tickVals","axisBottom","tickValues","tickFormat","axisLeft","normalise","col_name","u_probs","match_index","p","m_probs","vals","index_offset","floor","middle_index","start_index","end_index","lev_name","this_name","ms","level_prop","replace","charAt","toUpperCase","scheme","schemeGnBu","scaleOrdinal","get_lam","get_m_u","Event","drag","dispatchEvent","start_lam_x","new_lam","invert","dx","min","max","target_level_index","dragging_from_bottom","this_level_name","subject","level_index","dragged_cum_proportions","start_of_this_level_prop","end_of_this_level_prop","midpoint_y","y_start","y_start_with_delta","dy","prop_start","change_in_prop","target_level","new_val_this_lev","new_val_target_lev","isBetween","n","s1","scaleBand","padding","s2","widget_data","levels","m","lev","u","level_keys_from_unstacked_data","stacked","stack","keys","order","stackOrderNone","stackOffsetNone","v","includes","input_control_data","toString","arr","sum","reduce","settings","acc","child1","import","tex","reset_gender","settings_gender","button","input_control_data_to_splink_settings","gen","reset_fn1","settings_forename_1","fn1","reset_fn2","settings_forename_2","fn2","child2","frontmatter","post_date","code_url","post_type","post_category","css_override"],"mappings":"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","file":"component---src-pages-match-weight-dependencies-jsx-6928d73eca493a3dd199.js","sourcesContent":["export default function _taggedTemplateLiteral(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  return Object.freeze(Object.defineProperties(strings, {\n    raw: {\n      value: Object.freeze(raw)\n    }\n  }));\n}","import React from 'react'\nimport { css } from \"@emotion/core\"\nimport { rhythm } from \"../utils/typography\"\nimport { Link } from \"gatsby\"\n\n\nconst foot = css`\nmargin-left: auto;\n  margin-right: auto;\n  width: 80%;\n  max-width: 640px;\n  `\n\nconst cen = css`\n  text-align: center;\n`\n\nconst mar = css`\n  margin-top: 1rem;\n  margin-bottom: 0.5rem;\n`\n\nconst flex = css`\n\n\n    display: flex;\n    justify-content: space-between;\n\n`\n\nconst order_of_articles = [\n  \"/intro_to_probabilistic_linkage/\",\n  \"/maths_of_fellegi_sunter/\",\n  \"/visualising_fellegi_sunter/\",\n  \"/understanding_match_weights/\",\n  \"/match_weight_dependencies/\",\n  \"/m_u_generator/\",\n]\n\nconst LinkageFooter = (props) => {\n\n  let path = props.current_path\n\n  let this_index = order_of_articles.indexOf(path)\n\n  let previous_article = order_of_articles[this_index - 1]\n  let next_article = order_of_articles[this_index + 1]\n\n  if (previous_article === undefined) {\n    previous_article = <div></div>\n  } else {\n    previous_article = <div><Link to={previous_article}> &lt; Previous article</Link></div>\n  }\n\n  if (next_article === undefined) {\n    next_article = <div></div>\n  } else {\n    next_article = <div><Link to={next_article}> Next article &gt;</Link></div>\n  }\n\n  return (\n    <div>\n      <hr css={mar} />\n      <div css={flex}>\n        {previous_article}\n        <div><Link to=\"/probabilistic_linkage\">Probabilistic linkage home</Link></div>\n        {next_article}\n      </div>\n\n    </div >)\n}\n\nexport default LinkageFooter","import React from 'react'\nimport Layout from \"../layouts/layout\"\nimport LinkageFooter from './linkage_footer'\nimport ObeservableNotebookDiv from \"./observable_div\"\nimport PostFrontMatter from \"./post_frontmatter\"\nimport SEO from \"./seo\"\n\n\nfunction ProbLinkagePage(props) {\n\n\n  // let post\n\n\n  let post = <ObeservableNotebookDiv define={props.define} output_order={props.output_order} />\n\n\n  return (\n    <Layout css={props.className}>\n      <SEO title={props.post_frontmatter.title} description={props.post_frontmatter.description} />\n      <PostFrontMatter post_frontmatter={props.post_frontmatter} />\n      {post}\n      <LinkageFooter current_path={props.current_path}\n      />\n    </Layout>\n  )\n\n}\n\nexport default ProbLinkagePage","import _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject;\n\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Match Weights Charts\"])));\n  });\n  main.variable(observer(\"base_spec_m_u\")).define(\"base_spec_m_u\", [\"width\"], function (width) {\n    return {\n      config: {\n        view: {\n          width: width / 3,\n          height: 300\n        },\n        title: {\n          anchor: \"middle\",\n          offset: 10\n        },\n        header: {\n          title: null\n        }\n      },\n      hconcat: [{\n        mark: \"bar\",\n        title: {\n          text: \"Non-matches\",\n          fontWeight: \"normal\"\n        },\n        encoding: {\n          row: {\n            type: \"nominal\",\n            field: \"column_name\",\n            sort: {\n              field: \"gamma_index\"\n            },\n            header: {\n              labelAngle: 0,\n              labelAnchor: \"middle\",\n              labelAlign: \"left\"\n            }\n          },\n          x: {\n            type: \"quantitative\",\n            field: \"u_probability\",\n            axis: {\n              title: \"proportion\"\n            }\n          },\n          y: {\n            type: \"nominal\",\n            axis: {\n              title: null\n            },\n            field: \"level_name\"\n          },\n          tooltip: [{\n            type: \"nominal\",\n            field: \"column_name\"\n          }, {\n            type: \"ordinal\",\n            field: \"level_name\"\n          }, {\n            type: \"quantitative\",\n            field: \"u_probability\",\n            format: \".4f\"\n          }, {\n            type: \"quantitative\",\n            field: \"bayes_factor\",\n            format: \".4f\"\n          }, {\n            type: \"nominal\",\n            field: \"level_proportion\",\n            title: \"Percentage of record comparisons in this level\",\n            format: \".2%\"\n          }, {\n            type: \"quantitative\",\n            field: \"log2_bayes_factor\",\n            format: \".4f\"\n          }],\n          color: {\n            value: \"red\"\n          }\n        },\n        resolve: {\n          scale: {\n            y: \"independent\"\n          }\n        },\n        transform: [{\n          filter: \"(datum.bayes_factor != 'unnecessary filter2 due to vega lite issue 4680')\"\n        }],\n        // width: width / 2,\n        height: 50\n      }, {\n        mark: \"bar\",\n        title: {\n          text: \"Matches\",\n          fontWeight: \"normal\"\n        },\n        encoding: {\n          row: {\n            type: \"nominal\",\n            field: \"column_name\",\n            sort: {\n              field: \"gamma_index\"\n            },\n            header: {\n              labels: false\n            }\n          },\n          x: {\n            type: \"quantitative\",\n            field: \"m_probability\",\n            axis: {\n              title: \"proportion\"\n            }\n          },\n          y: {\n            type: \"nominal\",\n            axis: {\n              title: null\n            },\n            field: \"level_name\"\n          },\n          tooltip: [{\n            type: \"nominal\",\n            field: \"column_name\"\n          }, {\n            type: \"ordinal\",\n            field: \"level_name\"\n          }, {\n            type: \"quantitative\",\n            field: \"m_probability\",\n            format: \".4f\"\n          }, {\n            type: \"quantitative\",\n            field: \"bayes_factor\",\n            format: \".4f\"\n          }, {\n            type: \"nominal\",\n            field: \"level_proportion\",\n            title: \"Percentage of record comparisons in this level\",\n            format: \".2%\"\n          }, {\n            type: \"quantitative\",\n            field: \"log2_bayes_factor\",\n            format: \".4f\"\n          }],\n          color: {\n            value: \"green\"\n          }\n        },\n        resolve: {\n          scale: {\n            y: \"independent\"\n          }\n        },\n        transform: [{\n          filter: \"(datum.bayes_factor != 'unnecessary filter due to vega lite issue 4680')\"\n        }],\n        // width: width / 2,\n        height: 50\n      }],\n      data: {\n        values: null\n      },\n      transform: [],\n      title: {\n        text: \"Probability distributions of non-matches and matches \",\n        subtitle: \"Estimated proportion of matches Î» = \"\n      },\n      $schema: \"https://vega.github.io/schema/vega-lite/v4.json\"\n    };\n  });\n  main.variable(observer(\"base_spec_bayes_factors\")).define(\"base_spec_bayes_factors\", [\"width\"], function (width) {\n    return {\n      config: {\n        view: {\n          width: width / 1.5,\n          height: 300\n        },\n        mark: {\n          tooltip: null\n        },\n        title: {\n          anchor: \"middle\"\n        },\n        header: {\n          title: null\n        }\n      },\n      data: {\n        values: null\n      },\n      mark: {\n        type: \"bar\",\n        clip: true\n      },\n      selection: {\n        selector076: {\n          type: \"interval\",\n          bind: \"scales\",\n          encodings: [\"x\"]\n        }\n      },\n      encoding: {\n        color: {\n          type: \"quantitative\",\n          field: \"log2_bayes_factor\",\n          scale: {\n            range: [\"red\", \"orange\", \"green\"],\n            domain: [-10, 0, 10]\n          }\n        },\n        row: {\n          type: \"nominal\",\n          field: \"column_name\",\n          sort: {\n            field: \"gamma_index\"\n          },\n          header: {\n            labelAngle: 0,\n            labelAnchor: \"middle\",\n            labelAlign: \"left\"\n          }\n        },\n        tooltip: [{\n          type: \"nominal\",\n          field: \"column_name\"\n        }, {\n          type: \"ordinal\",\n          field: \"level_name\"\n        }, {\n          type: \"quantitative\",\n          field: \"m_probability\",\n          format: \".4f\"\n        }, {\n          type: \"quantitative\",\n          field: \"bayes_factor\",\n          format: \".4f\"\n        }, {\n          type: \"nominal\",\n          field: \"level_proportion\",\n          title: \"Percentage of record comparisons in this level\",\n          format: \".2%\"\n        }, {\n          type: \"quantitative\",\n          field: \"log2_bayes_factor\",\n          title: \"log2(Bayes factor, K = m/u)\",\n          format: \".4f\"\n        }],\n        x: {\n          type: \"quantitative\",\n          axis: {\n            title: \"log2(Bayes factor, K = m/u)\",\n            values: [-10, -5, 0, 5, 10]\n          },\n          field: \"log2_bayes_factor\",\n          scale: {\n            domain: [-10, 10]\n          }\n        },\n        y: {\n          type: \"nominal\",\n          field: \"level_name\",\n          axis: {\n            title: null\n          }\n        }\n      },\n      height: 50,\n      resolve: {\n        scale: {\n          y: \"independent\"\n        }\n      },\n      title: {\n        text: \"Influence of comparison vector values on match probability\",\n        subtitle: \"Use mousewheeel to zoom\"\n      },\n      $schema: \"https://vega.github.io/schema/vega-lite/v4.json\"\n    };\n  });\n  main.variable(observer(\"settings_example\")).define(\"settings_example\", [\"default_splink_settings\"], function (default_splink_settings) {\n    return JSON.parse(default_splink_settings);\n  });\n  main.variable(observer(\"chart_data_from_splink_settings\")).define(\"chart_data_from_splink_settings\", [\"get_chart_row\"], function (get_chart_row) {\n    return function chart_data_from_splink_settings(splink_settings) {\n      var chart_data = [];\n\n      var zip = function zip(a, b) {\n        return a.map(function (k, i) {\n          return [k, b[i]];\n        });\n      };\n\n      splink_settings.comparison_columns.forEach(function (cc) {\n        var zipped = zip(cc[\"m_probabilities\"], cc[\"u_probabilities\"]);\n        zipped.forEach(function (m_u_pair, index) {\n          var row = get_chart_row(m_u_pair, cc, index);\n          chart_data.push(row);\n        });\n      });\n      return chart_data;\n    };\n  });\n  main.variable(observer(\"get_m_u_chart\")).define(\"get_m_u_chart\", [\"base_spec_m_u\", \"chart_data_from_splink_settings\", \"embed\"], function (base_spec_m_u, chart_data_from_splink_settings, embed) {\n    return function get_m_u_chart(splink_setttings) {\n      var base_spec = JSON.parse(JSON.stringify(base_spec_m_u));\n      var lam = splink_setttings.proportion_of_matches;\n      base_spec.data.values = chart_data_from_splink_settings(splink_setttings);\n      base_spec.title.subtitle = \"Estimated proportion of matches \\u03BB = \".concat(lam);\n      return embed(base_spec);\n    };\n  });\n  main.variable(observer()).define([\"get_m_u_chart\", \"settings_example\"], function (get_m_u_chart, settings_example) {\n    return get_m_u_chart(settings_example);\n  });\n  main.variable(observer(\"get_bayes_factor_chart\")).define(\"get_bayes_factor_chart\", [\"base_spec_bayes_factors\", \"chart_data_from_splink_settings\", \"embed\"], function (base_spec_bayes_factors, chart_data_from_splink_settings, embed) {\n    return function get_bayes_factor_chart(splink_setttings) {\n      var base_spec = JSON.parse(JSON.stringify(base_spec_bayes_factors));\n      var lam = splink_setttings.proportion_of_matches;\n      base_spec.data.values = chart_data_from_splink_settings(splink_setttings);\n      base_spec.title.subtitle = \"Estimated proportion of matches \\u03BB = \".concat(lam.toPrecision(4));\n      return embed(base_spec);\n    };\n  });\n  main.variable(observer()).define([\"get_bayes_factor_chart\", \"settings_example\"], function (get_bayes_factor_chart, settings_example) {\n    return get_bayes_factor_chart(settings_example);\n  });\n  main.variable(observer(\"get_chart_row\")).define(\"get_chart_row\", function () {\n    return function get_chart_row(m_u_pair, comparison_column, index) {\n      var row = {};\n      var cc = comparison_column;\n      row[\"m_probability\"] = m_u_pair[0];\n      row[\"u_probability\"] = m_u_pair[1];\n      row[\"bayes_factor\"] = m_u_pair[0] / m_u_pair[1];\n      row[\"column_name\"] = cc[\"col_name\"];\n      row[\"log2_bayes_factor\"] = Math.log2(row[\"bayes_factor\"]);\n      row[\"gamma_index\"] = index;\n      row[\"gamma_column_name\"] = \"gamma_\" + cc[\"col_name\"];\n      row[\"level_name\"] = \"level_\" + index;\n      row[\"max_gamma_index\"] = cc.m_probabilities.length - 1;\n      row[\"num_levels\"] = cc.m_probabilities.length;\n      return row;\n    };\n  });\n  main.variable(observer(\"default_splink_settings\")).define(\"default_splink_settings\", function () {\n    return \"{\\n    \\\"proportion_of_matches\\\": 0.001,\\n    \\\"comparison_columns\\\": [\\n      {\\n        \\\"col_name\\\": \\\"fname\\\",\\n        \\\"u_probabilities\\\": [0.8, 0.2],\\n        \\\"m_probabilities\\\": [0.2, 0.8]\\n      },\\n      {\\n        \\\"col_name\\\": \\\"sname\\\",\\n        \\\"u_probabilities\\\": [0.9, 0.1],\\n        \\\"m_probabilities\\\": [0.2, 0.8]\\n      },\\n      {\\n        \\\"col_name\\\": \\\"dob\\\",\\n        \\\"u_probabilities\\\": [0.99, 0.01],\\n        \\\"m_probabilities\\\": [0.2, 0.8]\\n      },\\n      {\\n        \\\"col_name\\\": \\\"town\\\",\\n        \\\"u_probabilities\\\": [0.7, 0.3],\\n        \\\"m_probabilities\\\": [0.3, 0.7]\\n      }\\n    ]\\n  \\n  }\";\n  });\n  main.variable(observer(\"embed\")).define(\"embed\", [\"require\"], function (require) {\n    return require(\"vega-embed@6\");\n  });\n  return main;\n}","import _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5;\n\nimport define1 from \"./817db6818ab226c0@104.js\";\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Resizable areas\"])));\n  });\n  main.variable(observer(\"viewof num_levels\")).define(\"viewof num_levels\", [\"inputs\"], function (inputs) {\n    return inputs.range([2, 6], {\n      label: 'num levels',\n      step: 1,\n      value: 3\n    });\n  });\n  main.variable(observer(\"num_levels\")).define(\"num_levels\", [\"Generators\", \"viewof num_levels\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"## Drag within the bars to resize\\n\\nNote that if you change the number of levels of the axis squishiness, values will reset\"])));\n  });\n  main.variable(observer(\"viewof thing\")).define(\"viewof thing\", [\"m_u_input_control\", \"width\", \"height\", \"starting_data\"], function (m_u_input_control, width, height, starting_data) {\n    return m_u_input_control(width, height, starting_data, 0, true, 0);\n  });\n  main.variable(observer(\"thing\")).define(\"thing\", [\"Generators\", \"viewof thing\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"gen_y_scale\")).define(\"gen_y_scale\", [\"d3\"], function (d3) {\n    return function (axis_stretch_at_extremes, height, internal_height) {\n      //https://www.wolframalpha.com/input/?i=solve+y%3D+log_b%28%28x%2Bc%29%2F%28c-x%29%29\n      if (axis_stretch_at_extremes == 0) {\n        return d3.scaleLinear().domain([0, 1]).range([internal_height, 0]);\n      }\n\n      var squash = axis_stretch_at_extremes;\n      var my_fn;\n\n      if (squash >= 0) {\n        my_fn = function my_fn(x) {\n          return Math.pow(5, x) / (Math.pow(5, x) + 1);\n        };\n      } else {\n        my_fn = function my_fn(x) {\n          return -1 * Math.log((x + 8.01) / (8.01 - x));\n        };\n\n        var root = 1 / 3;\n        var multiple = 8 / Math.pow(8, root);\n        squash = -Math.pow(-squash, root) * multiple;\n      }\n\n      var offset_scale = d3.scaleLinear().domain([0, 1]).range([-squash, squash]);\n      var num_points = 50;\n      var in_values_not_normalised = d3.range(num_points + 1).map(function (d) {\n        return d / num_points;\n      }).map(offset_scale).map(my_fn);\n      var ext = d3.extent(in_values_not_normalised);\n      var normalise_scale = d3.scaleLinear().domain(ext).range([0, 1]);\n      var domain = in_values_not_normalised.map(normalise_scale);\n      var range = d3.range(num_points + 1).map(function (d) {\n        return internal_height * (num_points - d) / num_points;\n      });\n      return d3.scaleLinear().domain(domain).range(range);\n    };\n  });\n  main.variable(observer(\"m_u_input_control\")).define(\"m_u_input_control\", [\"DOM\", \"d3\", \"margin\", \"splink_data_to_unstacked_data\", \"unstacked_data_to_stacked\", \"num_levels_to_level_keys\", \"get_level_colours_scale\", \"inputs\", \"gen_x_scale\", \"gen_y_scale\", \"html\", \"get_tick_vals\", \"redraw\"], function (DOM, d3, margin, splink_data_to_unstacked_data, unstacked_data_to_stacked, num_levels_to_level_keys, get_level_colours_scale, inputs, gen_x_scale, gen_y_scale, html, get_tick_vals, redraw) {\n    return function (width, height, splink_settings) {\n      var comparison_column_index = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      var axis_compression_slider = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n      var axis_compression_start_value = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;\n      // Lots of vars created in this funcion that need to be passed to other functinos like redraw\n      // Put them all in 'enclosed data'\n      var comparison_col = splink_settings.comparison_columns[comparison_column_index];\n      var num_levels = comparison_col.u_probabilities.length;\n      var node = DOM.svg(width, height);\n      var svg_outer = d3.select(node); // svg_outer.style(\"border\", \"1px solid black \");\n\n      var svg = svg_outer.append(\"g\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\").attr(\"class\", \"outer_group\");\n      var unstacked_data = splink_data_to_unstacked_data(splink_settings, comparison_column_index);\n      var stacked_data = unstacked_data_to_stacked(unstacked_data);\n      var plot_data = stacked_data.m_u;\n      var level_keys = num_levels_to_level_keys(num_levels);\n      var level_names = num_levels_to_level_keys(num_levels);\n\n      if ('level_names' in splink_settings) {\n        level_names = splink_settings.level_names;\n      }\n\n      var level_colours = get_level_colours_scale(stacked_data);\n      var internal_width = width - margin.left - margin.right;\n      var internal_height = height - margin.top - margin.bottom;\n      var axis_slider = inputs.range([-8, 8], {\n        step: 0.1,\n        label: 'Axis compression',\n        value: axis_compression_start_value\n      });\n\n      if (!axis_compression_slider) {\n        axis_slider.style.display = 'none';\n      }\n\n      var x = gen_x_scale(axis_slider.value, width, internal_width);\n      var y = gen_y_scale(axis_slider.value, height, internal_height);\n      var final_output = html(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\\n\\n  \", \"\\n  \", \"\\n  \"])), axis_slider, svg_outer.node());\n      var enclosed_data = {\n        x: x,\n        y: y,\n        svg: svg,\n        svg_outer: svg_outer,\n        unstacked_data: unstacked_data,\n        stacked_data: stacked_data,\n        level_keys: level_keys,\n        level_names: level_names,\n        level_colours: level_colours,\n        final_output: final_output,\n        axis_slider: axis_slider,\n        internal_height: internal_height,\n        internal_width: internal_width,\n        width: width,\n        height: height\n      };\n      svg.on(\".drag\", null);\n      var inner = svg.selectAll(\"g\").data(plot_data).join(\"g\").attr(\"fill\", function (d) {\n        return level_colours(d.key);\n      }).attr(\"class\", function (d) {\n        return d.key;\n      }).classed(\"inner_group\", \"true\");\n      inner.selectAll(\"rect\").data(function (d) {\n        return d;\n      }).join(\"rect\").attr(\"stroke\", \"white\").attr(\"stroke-width\", \"2px\").classed(\"m_u_areas\", \"true\");\n      inner.selectAll(\"text\").data(function (d) {\n        return d;\n      }).join(\"text\").attr(\"text-anchor\", \"middle\").attr(\"dy\", \"0.5em\").style(\"font-size\", \"0.8em\").attr(\"pointer-events\", \"none\").style(\"font-family\", \"sans-serif\").classed(\"m_u_labels\", \"true\");\n      var tickVals = get_tick_vals(axis_slider.value);\n      svg.append('g').attr(\"class\", \"x_axis_group\");\n      svg.append('g').attr(\"class\", \"y_axis_group\");\n      inner.selectAll(\"text.chart_title\").remove();\n      inner.append(\"text\").text(\"Distribution of m and u values\").attr(\"y\", -60).attr(\"x\", internal_width / 2).attr(\"class\", \"chart_title\").attr(\"text-anchor\", \"middle\").attr(\"dy\", \"0.5em\").style(\"font-size\", \"1em\").style(\"font-weight\", \"bold\").attr(\"pointer-events\", \"none\").style('fill', 'black').style(\"font-family\", \"sans-serif\");\n      inner.append(\"text\").text(\"â¨ Drag within rectangles to change values â¨\").attr(\"y\", -20).attr(\"x\", internal_width / 2).attr(\"class\", \"chart_title\").attr(\"text-anchor\", \"middle\").attr(\"dy\", \"0.5em\").style(\"font-size\", \"0.8em\").attr(\"pointer-events\", \"none\").style('fill', 'red').style(\"font-family\", \"sans-serif\");\n      inner.append(\"text\").text(\"The area represents all record comparisons, split into levels by match status\").attr(\"y\", -40).attr(\"x\", internal_width / 2).attr(\"class\", \"chart_title\").attr(\"text-anchor\", \"middle\").attr(\"dy\", \"0.5em\").style(\"font-size\", \"0.8em\").attr(\"pointer-events\", \"none\").style('fill', 'black').style(\"font-family\", \"sans-serif\");\n      redraw(enclosed_data);\n      d3.select(axis_slider).on('input', function (d) {\n        redraw(enclosed_data);\n      });\n      final_output.value = unstacked_data;\n      return final_output;\n    };\n  });\n  main.variable(observer()).define([\"thing\"], function (thing) {\n    return thing;\n  });\n  main.variable(observer(\"redraw\")).define(\"redraw\", [\"gen_x_scale\", \"gen_y_scale\", \"get_scale\", \"get_drag\", \"get_label\", \"get_tick_vals\", \"d3\", \"format_tick\"], function (gen_x_scale, gen_y_scale, get_scale, get_drag, get_label, get_tick_vals, d3, format_tick) {\n    return function redraw(enclosed_data) {\n      var e = enclosed_data;\n      var unstacked_data = e.unstacked_data;\n      var svg = e.svg;\n      var svg_outer = e.svg_outer;\n      var stacked_data = e.stacked_data;\n      var plot_data = stacked_data.m_u;\n      var level_keys = e.level_keys;\n      var level_names = e.level_names;\n      var slider = e.axis_slider;\n      var axis_stretch = slider.value;\n      var internal_height = e.internal_height;\n      var internal_width = e.internal_width;\n      var width = e.width;\n      var height = e.height;\n      e.x = gen_x_scale(axis_stretch, width, internal_width);\n      e.y = gen_y_scale(axis_stretch, height, internal_height);\n      var inner = svg.selectAll(\".inner_group\").data(plot_data).join(\"g\").attr(\"fill\", function (d) {\n        return e.level_colours(d.key);\n      });\n      inner.selectAll(\"rect.m_u_areas\").data(function (d) {\n        return d;\n      }).join(\"rect\").attr(\"x\", function (d) {\n        return get_scale(d.data.match_status, e.stacked_data.lam, e.x)(d.data.match_status);\n      }).attr(\"y\", function (d) {\n        return e.y(d[1]);\n      }).attr(\"height\", function (d) {\n        return e.y(d[0]) - e.y(d[1]);\n      }).attr(\"width\", function (d) {\n        return get_scale(d.data.match_status, unstacked_data.lam, e.x).bandwidth();\n      }).call(get_drag(enclosed_data, redraw));\n      inner.selectAll(\"text.m_u_labels\").data(function (d) {\n        return d;\n      }).join(\"text\").attr(\"x\", function (d) {\n        return get_scale(d.data.match_status, stacked_data.lam, e.x)(d.data.match_status) + get_scale(d.data.match_status, stacked_data.lam, e.x).bandwidth() / 2;\n      }).attr(\"y\", function (d) {\n        return (e.y(d[1]) + e.y(d[0])) / 2;\n      }).text(function (d) {\n        return get_label(d, level_keys, level_names);\n      }).style('fill', 'black');\n      inner.selectAll(\"text.axis_match_label\").remove();\n      inner.selectAll(\"text.axis_match_label\").data([{\n        text: \"Record comparisons which are non-matches\",\n        x: [0, 1 - unstacked_data.lam]\n      }, {\n        text: \"Record comparisons which are matches\",\n        x: [1 - unstacked_data.lam, 1]\n      }]).join(\"text\").text(function (d) {\n        return d.text;\n      }).attr(\"y\", e.y(0) + 40).attr(\"x\", function (d) {\n        return (e.x(d.x[0]) + e.x(d.x[1])) / 2;\n      }).attr(\"class\", \"axis_match_label\").attr(\"text-anchor\", \"middle\").attr(\"dy\", \"0.5em\").style(\"font-size\", \"0.8em\").attr(\"pointer-events\", \"none\").style('fill', 'black').style(\"font-family\", \"sans-serif\");\n      var tickVals = get_tick_vals(slider.value);\n      svg.selectAll(\".x_axis_group\").attr(\"transform\", \"translate(\" + 0 + \",\" + internal_height + \")\").call(d3.axisBottom(e.x).tickValues(tickVals).tickFormat(format_tick));\n      svg.selectAll(\".y_axis_group\").call(d3.axisLeft(e.y).tickValues(tickVals).tickFormat(format_tick));\n    };\n  });\n  main.variable(observer(\"starting_data\")).define(\"starting_data\", [\"normalise\", \"d3\", \"num_levels\"], function (normalise, d3, num_levels) {\n    return {\n      proportion_of_matches: 0.3,\n      comparison_columns: [{\n        col_name: \"my column\",\n        m_probabilities: normalise(d3.range(1, num_levels + 1, 1)),\n        u_probabilities: normalise(d3.range(num_levels, 0, -1))\n      }]\n    };\n  });\n  main.variable(observer(\"splink_data_to_unstacked_data\")).define(\"splink_data_to_unstacked_data\", function () {\n    return function (splink_settings) {\n      var comparison_column_index = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var data = {\n        lam: splink_settings.proportion_of_matches\n      };\n      data.m_u = [null, null];\n      var u_probs = splink_settings.comparison_columns[comparison_column_index].u_probabilities;\n      data.m_u[0] = {\n        match_status: \"non-match\",\n        match_index: 0\n      };\n      u_probs.forEach(function (p, i) {\n        return data.m_u[0][\"level_\" + i] = p;\n      });\n      var m_probs = splink_settings.comparison_columns[comparison_column_index].m_probabilities;\n      data.m_u[1] = {\n        match_status: \"match\",\n        match_index: 1\n      };\n      m_probs.forEach(function (p, i) {\n        return data.m_u[1][\"level_\" + i] = p;\n      });\n      return data;\n    };\n  });\n  main.variable(observer(\"get_tick_vals\")).define(\"get_tick_vals\", function () {\n    return function (axis_stretch_at_extremes) {\n      var vals = [1e-10, 1e-9, 1e-8, 1e-7, 1e-6, 1e-5, 1e-4, 1e-3, 1e-2, 1e-1, 0.5, 1 - 1e-1, 1 - 1e-2, 1 - 1e-3, 1 - 1e-4, 1 - 1e-5, 1 - 1e-6, 1 - 1e-7, 1 - 1e-8, 1 - 1e-9, 1 - 1e-10];\n      var index_offset = Math.floor(axis_stretch_at_extremes * 0.65);\n      var middle_index = vals.indexOf(0.5);\n      var start_index = middle_index - index_offset;\n      var end_index = middle_index + index_offset;\n\n      if (axis_stretch_at_extremes > 2.5) {\n        return [0].concat(vals.slice(start_index, end_index + 1)).concat([1]);\n      } else {\n        return null;\n      }\n    };\n  });\n  main.variable(observer(\"get_label\")).define(\"get_label\", [\"d3\"], function (d3) {\n    return function (d, level_keys, level_names) {\n      var lev_name = d.key;\n      var lev_index = level_keys.indexOf(lev_name);\n      var this_name = level_names[lev_index];\n      var ms = d.data.match_status;\n      var level_prop = d3.format(\",.2%\")(d.data[d.key]);\n      this_name = this_name.replace(\"_\", \" \");\n      this_name = this_name.charAt(0).toUpperCase() + this_name.slice(1);\n      return \"\".concat(this_name, \": \").concat(level_prop, \" of \").concat(ms, \"es\");\n    };\n  });\n  main.variable(observer(\"gen_x_scale\")).define(\"gen_x_scale\", [\"d3\"], function (d3) {\n    return function (axis_stretch_at_extremes, width, internal_width) {\n      //https://www.wolframalpha.com/input/?i=solve+y%3D+log_b%28%28x%2Bc%29%2F%28c-x%29%29\n      if (axis_stretch_at_extremes == 0) {\n        return d3.scaleLinear().domain([0, 1]).range([0, internal_width]);\n      }\n\n      var squash = axis_stretch_at_extremes;\n      var my_fn;\n\n      if (squash >= 0) {\n        my_fn = function my_fn(x) {\n          return Math.pow(5, x) / (Math.pow(5, x) + 1);\n        };\n      } else {\n        my_fn = function my_fn(x) {\n          return -1 * Math.log((x + 8.01) / (8.01 - x));\n        };\n\n        var root = 1 / 3;\n        var multiple = 8 / Math.pow(8, root);\n        squash = -Math.pow(-squash, root) * multiple;\n      }\n\n      var offset_scale = d3.scaleLinear().domain([0, 1]).range([-squash, squash]);\n      var num_points = 50;\n      var in_values_not_normalised = d3.range(num_points + 1).map(function (d) {\n        return d / num_points;\n      }).map(offset_scale).map(my_fn);\n      var ext = d3.extent(in_values_not_normalised);\n      var normalise_scale = d3.scaleLinear().domain(ext).range([0, 1]);\n      var domain = in_values_not_normalised.map(normalise_scale);\n      var range = d3.range(num_points + 1).map(function (d) {\n        return internal_width * d / num_points;\n      });\n      return d3.scaleLinear().domain(domain).range(range);\n    };\n  });\n  main.variable(observer(\"get_level_colours_scale\")).define(\"get_level_colours_scale\", [\"d3\"], function (d3) {\n    return function (stacked_data) {\n      var scheme = d3.schemeGnBu;\n      scheme[2] = [scheme[3][0], scheme[3][2]];\n      return d3.scaleOrdinal().domain(stacked_data[\"m_u\"].map(function (d) {\n        return d.key;\n      })).range(scheme[stacked_data[\"m_u\"].length]);\n    };\n  });\n  main.variable(observer(\"get_drag\")).define(\"get_drag\", [\"d3\", \"get_lam\", \"get_m_u\", \"unstacked_data_to_stacked\", \"Event\"], function (d3, get_lam, get_m_u, unstacked_data_to_stacked, Event) {\n    return function (enclosed_data, redraw) {\n      // By passing data and redraw and then defining a function\n      // we create a closure over data and redraw, making them\n      // available to the drag function\n      return d3.drag().on(\"drag\", function (e) {\n        // Lam\n        enclosed_data.unstacked_data.lam = get_lam(e, enclosed_data); // Now reallocate between bins\n\n        enclosed_data.unstacked_data.m_u = get_m_u(e, enclosed_data);\n        var plot_data = unstacked_data_to_stacked(enclosed_data.unstacked_data);\n        enclosed_data.stacked_data = plot_data;\n        enclosed_data.final_output.value = enclosed_data.unstacked_data;\n        redraw(enclosed_data);\n        enclosed_data.final_output.dispatchEvent(new Event(\"input\"));\n      });\n    };\n  });\n  main.variable(observer(\"get_lam\")).define(\"get_lam\", function () {\n    return function get_lam(e, enclosed_data) {\n      var x = enclosed_data.x;\n      var start_lam = enclosed_data.unstacked_data.lam;\n      var start_lam_x = x(start_lam);\n      var new_lam = x.invert(start_lam_x - e.dx);\n      new_lam = Math.min(new_lam, 1);\n      new_lam = Math.max(new_lam, 0);\n      return new_lam;\n    };\n  });\n  main.variable(observer(\"get_m_u\")).define(\"get_m_u\", function () {\n    return function get_m_u(e, enclosed_data) {\n      //Note that e.subject, the datum associated with the rectangle, is fixed\n      // so for instance, the proportions contained in this data will not change\n      // during the course of an individual drag event\n      // m_u is being updated though, so it's actually m_u which contains the\n      // most up-to-date data associated with the diagram and hence this should be used\n      // for geometric calculations\n      var level_keys = enclosed_data.level_keys;\n      var stacked_data = enclosed_data.stacked_data;\n      var y = enclosed_data.y;\n      var m_u = enclosed_data.unstacked_data.m_u; //   Get proportions associated with dragged rect\n\n      var this_level_name = e.subject.key;\n      var level_index = level_keys.indexOf(this_level_name);\n      var match_index = e.subject.data.match_index;\n      var dragged_cum_proportions = stacked_data.m_u[level_index][match_index]; //Get target level\n\n      var start_of_this_level_prop = dragged_cum_proportions[0];\n      var end_of_this_level_prop = dragged_cum_proportions[1];\n      var start_level_y = y(start_of_this_level_prop);\n      var end_level_y = y(end_of_this_level_prop); // let midpoint_y = (y(e.subject[0]) + y(e.subject[1])) / 2;\n\n      var midpoint_y = (start_level_y + end_level_y) / 2;\n      var in_top_half;\n\n      if (e.y < midpoint_y) {\n        in_top_half = true;\n      } else {\n        in_top_half = false;\n      }\n\n      var target_level_index;\n      var dragging_from_bottom;\n\n      if (in_top_half) {\n        target_level_index = level_index + 1;\n        dragging_from_bottom = false;\n      } else {\n        target_level_index = level_index + -1;\n        dragging_from_bottom = true;\n      }\n\n      if (level_index == 0) {\n        target_level_index = 1;\n        dragging_from_bottom = false;\n      }\n\n      if (level_index == level_keys.length - 1) {\n        target_level_index = level_keys.length - 2;\n        dragging_from_bottom = true;\n      } // Get y location we're starting the drag from\n\n\n      var cum_proportion_drag_start;\n\n      if (dragging_from_bottom) {\n        cum_proportion_drag_start = start_of_this_level_prop;\n      } else {\n        cum_proportion_drag_start = end_of_this_level_prop;\n      }\n\n      var change_from_start_prop;\n      var y_start = y(cum_proportion_drag_start);\n      var y_start_with_delta = y_start + e.dy;\n      var prop_start = y.invert(y_start);\n      var prop_end = y.invert(y_start_with_delta); //   Update data\n\n      var change_in_prop = prop_end - prop_start;\n\n      if (!dragging_from_bottom) {\n        change_in_prop = -change_in_prop;\n      }\n\n      var target_level = level_keys[target_level_index];\n      var new_val_this_lev = m_u[match_index][this_level_name] - change_in_prop;\n      var new_val_target_lev = m_u[match_index][target_level] + change_in_prop;\n\n      function isBetween(n, a, b) {\n        return (n - a) * (n - b) <= 0;\n      }\n\n      if (isBetween(new_val_this_lev, 0, 1) && isBetween(new_val_target_lev, 0, 1)) {\n        m_u[match_index][this_level_name] = new_val_this_lev;\n        m_u[match_index][target_level] = new_val_target_lev;\n      }\n\n      return m_u;\n    };\n  });\n  main.variable(observer(\"margin\")).define(\"margin\", function () {\n    var m_size = 60;\n    return {\n      top: 80,\n      right: m_size,\n      bottom: m_size,\n      left: m_size\n    };\n  });\n  main.variable(observer(\"get_scale\")).define(\"get_scale\", [\"d3\"], function (d3) {\n    return function (match_status, lam, x) {\n      var padding = 0.000;\n      var s1 = d3.scaleBand().domain(['match']).range([x(1 - lam), x(1)]).padding(padding);\n      var s2 = d3.scaleBand().domain(['non-match']).range([x(0), x(1 - lam)]).padding(padding);\n\n      if (match_status == 'match') {\n        return s1;\n      } else {\n        return s2;\n      }\n    };\n  });\n  main.variable(observer(\"input_control\")).define(\"input_control\", [\"num_levels_to_level_keys\"], function (num_levels_to_level_keys) {\n    return function input_control(widget_data) {\n      var num_levels = widget_data.m_u[0].length;\n      var levels = num_levels_to_level_keys(num_levels);\n      var m = levels.map(function (lev) {\n        return widget_data.m_u[1][lev];\n      });\n      var u = levels.map(function (lev) {\n        return widget_data.m_u[0][lev];\n      });\n      return {\n        proportion_of_matches: widget_data.lam,\n        comparison_columns: [{\n          col_name: 'my column',\n          m_probabilities: m,\n          u_probabilities: u,\n          num_levels: levels.length\n        }]\n      };\n    };\n  });\n  main.variable(observer(\"height\")).define(\"height\", function () {\n    return 500;\n  });\n  main.variable(observer(\"unstacked_data_to_stacked\")).define(\"unstacked_data_to_stacked\", [\"level_keys_from_unstacked_data\", \"d3\"], function (level_keys_from_unstacked_data, d3) {\n    return function (unstacked_data) {\n      var level_keys = level_keys_from_unstacked_data(unstacked_data);\n      var stack = d3.stack().keys(level_keys).order(d3.stackOrderNone).offset(d3.stackOffsetNone);\n      var stacked = stack(unstacked_data[\"m_u\"]);\n      stacked = stacked.map(function (d) {\n        return d.forEach(function (v) {\n          return v.key = d.key;\n        }), d;\n      });\n      return {\n        lam: unstacked_data.lam,\n        m_u: stacked\n      };\n    };\n  });\n  main.variable(observer(\"level_keys_from_unstacked_data\")).define(\"level_keys_from_unstacked_data\", function () {\n    return function (unstacked_data) {\n      return Object.keys(unstacked_data.m_u[0]).filter(function (d) {\n        return d.includes('level_');\n      });\n    };\n  });\n  main.variable(observer(\"input_control_data_to_splink_settings\")).define(\"input_control_data_to_splink_settings\", [\"level_keys_from_unstacked_data\", \"num_levels_to_level_keys\"], function (level_keys_from_unstacked_data, num_levels_to_level_keys) {\n    return function input_control_data_to_splink_settings(input_control_data) {\n      var num_levels = level_keys_from_unstacked_data(input_control_data).length;\n      var levels = num_levels_to_level_keys(num_levels);\n      var m = levels.map(function (lev) {\n        return input_control_data.m_u[1][lev];\n      });\n      var u = levels.map(function (lev) {\n        return input_control_data.m_u[0][lev];\n      });\n      return {\n        proportion_of_matches: input_control_data.lam,\n        comparison_columns: [{\n          col_name: ' ',\n          m_probabilities: m,\n          u_probabilities: u,\n          num_levels: levels.length\n        }]\n      };\n    };\n  });\n  main.variable(observer(\"num_levels_to_level_keys\")).define(\"num_levels_to_level_keys\", [\"d3\"], function (d3) {\n    return function (num_levels) {\n      return d3.range(num_levels).map(function (d) {\n        return \"level_\" + d;\n      });\n    };\n  });\n  main.variable(observer(\"format_tick\")).define(\"format_tick\", function () {\n    return function (d) {\n      return d.toString();\n    };\n  });\n  main.variable(observer(\"normalise\")).define(\"normalise\", function () {\n    return function normalise(arr) {\n      var sum = arr.reduce(function (a, b) {\n        return a + b;\n      }, 0);\n      return arr.map(function (d) {\n        return d / sum;\n      });\n    };\n  });\n  main.variable(observer(\"gen_starting_data\")).define(\"gen_starting_data\", [\"num_levels_to_level_keys\", \"d3\", \"normalise\"], function (num_levels_to_level_keys, d3, normalise) {\n    return function (num_levels) {\n      var level_keys = num_levels_to_level_keys(num_levels);\n      var settings = {\n        proportion_of_matches: 0.3,\n        comparison_columns: [{\n          col_name: \" \",\n          m_probabilities: null,\n          u_probabilities: null\n        }]\n      };\n      var norm = d3.range(1, num_levels + 1).reduce(function (d, acc) {\n        return d + acc;\n      }, 0);\n      var m_probs = d3.range(1, num_levels + 1, 1).map(function (d) {\n        return Math.pow(d, 2);\n      });\n      m_probs = normalise(m_probs);\n      var u_probs = d3.range(num_levels, 0, -1).map(function (d) {\n        return Math.pow(d, 2);\n      });\n      u_probs = normalise(u_probs);\n      settings.comparison_columns[0].m_probabilities = m_probs;\n      settings.comparison_columns[0].u_probabilities = u_probs;\n      return settings;\n    };\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"#### External fns\"])));\n  });\n  var child1 = runtime.module(define1);\n  main.import(\"get_m_u_chart\", child1);\n  main.import(\"get_bayes_factor_chart\", child1);\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"#### External libs\"])));\n  });\n  main.variable(observer(\"inputs\")).define(\"inputs\", [\"require\"], function (require) {\n    return require(\"@observablehq/inputs\");\n  });\n  main.variable(observer(\"d3\")).define(\"d3\", [\"require\"], function (require) {\n    return require(\"d3@6\");\n  });\n  return main;\n}","import _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6, _templateObject7, _templateObject8, _templateObject9, _templateObject10;\n\n// https://observablehq.com/@robinl/dependencies-between-match-weights@158\nimport define1 from \"./34fd4ef09fb0509a@2296.js\";\nimport define2 from \"./817db6818ab226c0@104.js\";\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer(\"title\")).define(\"title\", [\"md\"], function (md) {\n    return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Dependencies between match weights\"])));\n  });\n  main.variable(observer()).define([\"md\"], function (md) {\n    return md(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"*A final version of this notebook can be viewed on my blog [here](https://www.robinlinacre.com/match_weight_dependencies/).*\"])));\n  });\n  main.variable(observer(\"para_1\")).define(\"para_1\", [\"md\"], function (md) {\n    return md(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"The values of a column's match weights are interdependent:  Only certain combinations of values are possible.  \\n\\nSome types of data also result in maximum and minimum match weights.\\n\\nUnderstanding why these constraints occur can help you build better models, because it can help you find ways to extract more information from your comparison columns.\\n\\nThis article tries to build an intuition for why these constraints occur and why they matter.\\n\"])));\n  });\n  main.variable(observer(\"para_2\")).define(\"para_2\", [\"md\", \"tex\"], function (md, tex) {\n    return md(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"## Example of a maximum match weight:  Gender\\nConsider a column for gender, and let's assume there's an equal split of males and females in our data.\\n\\nA match on gender does not provide strong evidence in favour of a match because it's common to observe a match on gender amongst non-matching records.\\n\\nThis suggests there is an upper bound on the Bayes Factor for gender.  It turns out that, for this data, the maximum Bayes Factor is 2.0.\\n\\n Let's explore what this looks like visually, which will reveal the constraint.  Note that:\\n\\n- Amongst non-matching records, the gender field is just as likely to match as to mismatch, i.e.  \", \" and \", \".\\n\\n-  \\u2728You can drag within the rectangles of the following diagram to see the effect of different m and u values on match weights\\u2728\\n\"])), tex(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"u_\\text{gender, level 0} = 0.5\"], [\"u_\\\\text{gender, level 0} = 0.5\"]))), tex(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"u_\\text{gender, level 1} = 0.5\"], [\"u_\\\\text{gender, level 1} = 0.5\"]))));\n  });\n  main.variable(observer(\"viewof gen\")).define(\"viewof gen\", [\"reset_gender\", \"m_u_input_control\", \"width\", \"settings_gender\"], function (reset_gender, m_u_input_control, width, settings_gender) {\n    reset_gender;\n    return m_u_input_control(width, 400, settings_gender, 0, 1);\n  });\n  main.variable(observer(\"gen\")).define(\"gen\", [\"Generators\", \"viewof gen\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"viewof reset_gender\")).define(\"viewof reset_gender\", [\"inputs\"], function (inputs) {\n    return inputs.button(\"Reset gender values\");\n  });\n  main.variable(observer(\"reset_gender\")).define(\"reset_gender\", [\"Generators\", \"viewof reset_gender\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"bf_chart_gender\")).define(\"bf_chart_gender\", [\"get_bayes_factor_chart\", \"input_control_data_to_splink_settings\", \"gen\"], function (get_bayes_factor_chart, input_control_data_to_splink_settings, gen) {\n    return get_bayes_factor_chart(input_control_data_to_splink_settings(gen));\n  });\n  main.variable(observer(\"para_3\")).define(\"para_3\", [\"md\"], function (md) {\n    return md(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"### Observations\\n\\nTwo important findings emerge from this example:\\n\\n- There is a maximum bound of 2 on the match weight associated with a match on gender.  This is intuitive:  a match weight of two means that, if we observe a match on gender, it's now twice as likely that the records are a match - reflecting the equal split of genders.\\n\\n- There is no minimum bound of the match weight associated with a mismatch on gender.  This is also intuitive.  If gender is recorded with very high accuracy, then a mismatch on gender represents very strong evidence against a match.\\n\"])));\n  });\n  main.variable(observer(\"para_4\")).define(\"para_4\", [\"md\"], function (md) {\n    return md(_templateObject8 || (_templateObject8 = _taggedTemplateLiteral([\"## Example of a minimum match weights:  Forename\\n\\nConsider a forename column.  Let's assume that nicknames, diminutives are common in this dataset.  For example, it may be common for someone called 'Jonathan' to appear variously as 'Jonathan', 'John' or 'Jonny'.  As such, it will be common that, amongst matches, the forename does not exactly match.\\n\\nConsider the following chart, which models this column with two comparison levels:\\n- Level 1: Forename matches exactly\\n- Level 0: Forname mismatches \\n\\nIn this scenario, the observation of a mismatch on forename does not provide strong evidence against a match, because it is so common to observe a mismatch amongst matching records.  \\n\"])));\n  });\n  main.variable(observer(\"viewof fn1\")).define(\"viewof fn1\", [\"reset_fn1\", \"m_u_input_control\", \"width\", \"settings_forename_1\"], function (reset_fn1, m_u_input_control, width, settings_forename_1) {\n    reset_fn1;\n    return m_u_input_control(width, 400, settings_forename_1, 0, 3);\n  });\n  main.variable(observer(\"fn1\")).define(\"fn1\", [\"Generators\", \"viewof fn1\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"viewof reset_fn1\")).define(\"viewof reset_fn1\", [\"inputs\"], function (inputs) {\n    return inputs.button(\"Reset forename values\");\n  });\n  main.variable(observer(\"reset_fn1\")).define(\"reset_fn1\", [\"Generators\", \"viewof reset_fn1\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"bf_chart_fn_1\")).define(\"bf_chart_fn_1\", [\"get_bayes_factor_chart\", \"input_control_data_to_splink_settings\", \"fn1\"], function (get_bayes_factor_chart, input_control_data_to_splink_settings, fn1) {\n    return get_bayes_factor_chart(input_control_data_to_splink_settings(fn1));\n  });\n  main.variable(observer(\"para_5\")).define(\"para_5\", [\"md\"], function (md) {\n    return md(_templateObject9 || (_templateObject9 = _taggedTemplateLiteral([\"Using a more sophisticted modelling approach, we can do better.\\n\\nLet's assume that we can capture the vast majority of nicknames and diminutives using a fuzzy matching function.  This allows us to draw a distinction between two scenarios:\\n- Values do not match, but are similar\\n- Values do not match, and are completely different.\\n\\nWe now set up our levels as follows:\\n- Level 2: Exact match on forename\\n- Level 1: Fuzzy match on forename\\n- Level 0: Forename mismatches\\n\\n\\n\"])));\n  });\n  main.variable(observer(\"viewof fn2\")).define(\"viewof fn2\", [\"reset_fn2\", \"m_u_input_control\", \"width\", \"settings_forename_2\"], function (reset_fn2, m_u_input_control, width, settings_forename_2) {\n    reset_fn2;\n    return m_u_input_control(width, 400, settings_forename_2, 0, 3);\n  });\n  main.variable(observer(\"fn2\")).define(\"fn2\", [\"Generators\", \"viewof fn2\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"viewof reset_fn2\")).define(\"viewof reset_fn2\", [\"inputs\"], function (inputs) {\n    return inputs.button(\"Reset forename values\");\n  });\n  main.variable(observer(\"reset_fn2\")).define(\"reset_fn2\", [\"Generators\", \"viewof reset_fn2\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"bf_chart_fn_2\")).define(\"bf_chart_fn_2\", [\"get_bayes_factor_chart\", \"input_control_data_to_splink_settings\", \"fn2\"], function (get_bayes_factor_chart, input_control_data_to_splink_settings, fn2) {\n    return get_bayes_factor_chart(input_control_data_to_splink_settings(fn2));\n  });\n  main.variable(observer(\"para_6\")).define(\"para_6\", [\"md\"], function (md) {\n    return md(_templateObject10 || (_templateObject10 = _taggedTemplateLiteral([\"## Observations\\n\\n- When we modelled two levels, two names that fuzzy matched (John vs Jonny) would have been assigned the same negative match weight as two names which were completely different (John vs Robin).  We therefore lost information\\n- When we model three levels, a much stronger negative weight on a mismatch is possible.  This is because the lowest level (level_0) now contains only names which are completely different, rather than being a mix of fuzzy matching names, and names which are competely different.\\n\\nModelling three levels thereby allows us to extract substantially more information from the data.\\n\"])));\n  });\n  main.variable(observer(\"settings_gender\")).define(\"settings_gender\", function () {\n    return {\n      proportion_of_matches: 0.3,\n      comparison_columns: [{\n        col_name: \"gender\",\n        m_probabilities: [0.1, 0.9],\n        u_probabilities: [0.5, 0.5]\n      }],\n      level_names: [\"Gender mismatches\", \"Gender matches\"]\n    };\n  });\n  main.variable(observer(\"settings_forename_1\")).define(\"settings_forename_1\", function () {\n    return {\n      proportion_of_matches: 0.3,\n      comparison_columns: [{\n        col_name: \"gender\",\n        m_probabilities: [0.3, 0.7],\n        u_probabilities: [0.9, 0.1]\n      }],\n      level_names: [\"Forname mismatches\", \"Forename matches exactly\"]\n    };\n  });\n  main.variable(observer(\"settings_forename_2\")).define(\"settings_forename_2\", function () {\n    return {\n      proportion_of_matches: 0.3,\n      comparison_columns: [{\n        col_name: \"gender\",\n        m_probabilities: [0.05, 0.25, 0.7],\n        u_probabilities: [0.75, 0.15, 0.1]\n      }],\n      level_names: [\"Forname mismatches\", \"Forename fuzzy matches\", \"Forename matches\"]\n    };\n  });\n  main.variable(observer(\"inputs\")).define(\"inputs\", [\"require\"], function (require) {\n    return require(\"@observablehq/inputs\");\n  });\n  var child1 = runtime.module(define1);\n  main.import(\"m_u_input_control\", child1);\n  main.import(\"input_control_data_to_splink_settings\", child1);\n  var child2 = runtime.module(define2);\n  main.import(\"get_m_u_chart\", child2);\n  main.import(\"get_bayes_factor_chart\", child2);\n  return main;\n}","import React from 'react'\nimport define from \"@robinl/dependencies-between-match-weights\"\nimport ProbLinkagePage from \"../components/prob_linkage_page\"\nimport { css } from \"@emotion/core\"\n\nexport const frontmatter = {\n    title: \"Dependencies between match weights\",\n    post_date: \"2021-06-10\",\n    code_url: \"https://observablehq.com/@robinl/dependencies-between-match-weights\",\n    post_type: \"obs\",\n    post_category: \"probabilistic_linkage\",\n    description: \"An set of interactive, explorable explanations of the Fellegi Sunter model of probabilistic record linkage.  The dependencies between match weights\"\n}\n\nlet output_order = [\n    \"title\",\n    \"para_1\",\n    \"para_2\",\n    \"viewof gen\",\n    \"viewof reset_gender\",\n    \"bf_chart_gender\",\n    \"para_3\",\n    \"para_4\",\n    \"viewof fn1\",\n    \"viewof reset_fn1\",\n    \"bf_chart_fn_1\",\n    \"para_5\",\n    \"viewof fn2\",\n    \"viewof reset_fn2\",\n    \"bf_chart_fn_2\",\n    \"para_6\",\n\n\n\n\n\n]\n\nconst css_override = css`\nmargin-left: auto;\nmargin-right: auto;\nwidth: 90%;\nmax-width: 800px;\ntable {font-size: 0.8rem;\n line-height: 1rem;}\nrem;\n`\n\nexport default (props) => {\n\n    return (<ProbLinkagePage\n        define={define}\n        output_order={output_order}\n        post_frontmatter={frontmatter}\n        css={css_override}\n        current_path={props.path}\n    />)\n\n\n}"],"sourceRoot":""}